<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Factory - Build Your Planet</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 30%, rgba(72, 191, 145, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(100, 149, 237, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(186, 85, 211, 0.1) 0%, transparent 50%);
            animation: bgPulse 15s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes bgPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.05); }
        }

        .header {
            background: linear-gradient(135deg, rgba(72, 191, 145, 0.2), rgba(100, 149, 237, 0.2));
            backdrop-filter: blur(10px);
            border-bottom: 2px solid rgba(72, 191, 145, 0.3);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            background: linear-gradient(135deg, #48bf91, #6495ed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(72, 191, 145, 0.5);
        }

        .planet-icon {
            font-size: 2em;
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .era-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3em;
            padding: 10px 20px;
            background: linear-gradient(135deg, rgba(186, 85, 211, 0.3), rgba(147, 51, 234, 0.3));
            border: 2px solid rgba(186, 85, 211, 0.5);
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .resources-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .resource-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .resource-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--glow-color), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
        }

        .resource-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .resource-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9em;
            color: rgba(255,255,255,0.7);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .resource-amount {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--glow-color);
            text-shadow: 0 0 10px var(--glow-color);
        }

        .resource-rate {
            font-size: 0.9em;
            color: rgba(255,255,255,0.6);
            margin-top: 5px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .buildings-section {
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
        }

        .section-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #48bf91;
            text-transform: uppercase;
            border-bottom: 2px solid rgba(72, 191, 145, 0.3);
            padding-bottom: 10px;
        }

        .buildings-grid {
            display: grid;
            gap: 15px;
        }

        .building-card {
            background: linear-gradient(135deg, rgba(100, 149, 237, 0.1), rgba(72, 191, 145, 0.05));
            border: 2px solid rgba(100, 149, 237, 0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }

        .building-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(100, 149, 237, 0.3);
            border-color: rgba(100, 149, 237, 0.6);
        }

        .building-card.locked {
            opacity: 0.5;
            filter: grayscale(0.7);
        }

        .building-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .building-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.3em;
            font-weight: 600;
            color: #6495ed;
        }

        .building-icon {
            font-size: 2em;
        }

        .building-count {
            font-size: 1.5em;
            font-weight: 700;
            color: #48bf91;
            margin-bottom: 10px;
        }

        .building-production {
            font-size: 0.95em;
            color: rgba(255,255,255,0.7);
            margin-bottom: 8px;
        }

        .building-cost {
            font-size: 0.9em;
            color: rgba(255,255,255,0.6);
            margin-bottom: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #48bf91, #37a578);
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(72, 191, 145, 0.3);
            touch-action: manipulation;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(72, 191, 145, 0.5);
        }

        .btn:disabled {
            background: linear-gradient(135deg, #555, #444);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .panel-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 25px;
        }

        .planet-visual {
            width: 100%;
            height: 200px;
            border-radius: 15px;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8em;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .planet-visual::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), transparent 50%);
            animation: planetGlow 3s ease-in-out infinite;
        }

        @keyframes planetGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .progress-bar {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            height: 25px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bf91, #6495ed);
            border-radius: 10px;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85em;
            font-weight: 700;
        }

        .event-log {
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.9em;
        }

        .event-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(100, 149, 237, 0.1);
            border-left: 3px solid #6495ed;
            border-radius: 5px;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .prestige-section {
            background: linear-gradient(135deg, rgba(186, 85, 211, 0.2), rgba(147, 51, 234, 0.1));
            border: 2px solid rgba(186, 85, 211, 0.4);
        }

        .prestige-btn {
            background: linear-gradient(135deg, #ba55d3, #9333ea);
            box-shadow: 0 5px 15px rgba(186, 85, 211, 0.3);
        }

        .prestige-btn:hover {
            box-shadow: 0 8px 20px rgba(186, 85, 211, 0.5);
        }

        .essence-display {
            font-size: 1.5em;
            text-align: center;
            color: #ba55d3;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .bottom-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            padding-bottom: 20px;
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #48bf91, #6495ed);
            border-radius: 5px;
        }

        .locked-message {
            text-align: center;
            color: rgba(255,255,255,0.5);
            font-style: italic;
            margin-top: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            max-width: 900px;
            margin: 50px auto;
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.95), rgba(26, 26, 46, 0.95));
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #48bf91;
            box-shadow: 0 0 50px rgba(72, 191, 145, 0.3);
        }

        .modal-content h1 {
            margin-bottom: 30px;
            color: #48bf91;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
        }

        .modal-content h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #6495ed;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
        }

        .modal-content p {
            line-height: 1.8;
            margin-bottom: 15px;
            color: #e0e0e0;
        }

        .modal-content ul {
            margin-left: 30px;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .modal-content li {
            margin-bottom: 10px;
            color: #e0e0e0;
        }

        .modal-content strong {
            color: #48bf91;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <span class="planet-icon">üåç</span>
            <h1 class="title">WORLD FACTORY</h1>
        </div>
        <div class="header-info">
            <div class="era-display" id="eraDisplay">√àre Primitive</div>
            <a href="index.html" class="btn" style="text-decoration: none; background: linear-gradient(135deg, #6495ed, #4169e1);">üè† MENU</a>
        </div>
    </div>

    <div class="container">
        <!-- Resources Panel -->
        <div class="resources-panel">
            <div class="resource-card" style="--glow-color: #a0826d;">
                <div class="resource-icon">ü™®</div>
                <div class="resource-name">Pierre</div>
                <div class="resource-amount" id="stoneAmount">0</div>
                <div class="resource-rate" id="stoneRate">+0/s</div>
            </div>
            <div class="resource-card" style="--glow-color: #8b8b8b;">
                <div class="resource-icon">‚öôÔ∏è</div>
                <div class="resource-name">Fer</div>
                <div class="resource-amount" id="ironAmount">0</div>
                <div class="resource-rate" id="ironRate">+0/s</div>
            </div>
            <div class="resource-card" style="--glow-color: #ffd700;">
                <div class="resource-icon">‚ö°</div>
                <div class="resource-name">√ânergie</div>
                <div class="resource-amount" id="energyAmount">0</div>
                <div class="resource-rate" id="energyRate">+0/s</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Buildings Section -->
            <div class="buildings-section">
                <h2 class="section-title">üèóÔ∏è Constructions</h2>
                <div class="buildings-grid" id="buildingsGrid"></div>
            </div>

            <!-- Side Panel -->
            <div class="side-panel">
                <!-- Planet Status -->
                <div class="panel-card">
                    <h3 class="section-title" style="font-size: 1.3em;">Votre Plan√®te</h3>
                    <div class="planet-visual" id="planetVisual">üåç</div>
                    <div style="text-align: center; font-size: 1.1em; margin-bottom: 10px;">
                        Population: <span style="color: #48bf91; font-weight: 700;" id="population">0</span>
                    </div>
                    <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Progression vers l'√®re suivante:</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="eraProgress" style="width: 0%;">0%</div>
                    </div>
                </div>

                <!-- Prestige Section -->
                <div class="panel-card prestige-section">
                    <h3 class="section-title" style="color: #ba55d3;">‚ú® Terraformage</h3>
                    <div class="essence-display">üíé Essence Cosmique: <span id="essenceAmount">0</span></div>
                    <div style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.8);">
                        Bonus actuel: +<span id="essenceBonus">0</span>% production
                    </div>
                    <div style="margin-bottom: 15px; font-size: 0.9em; text-align: center;">
                        Gain estim√©: <span style="color: #ba55d3; font-weight: 700;" id="essenceGain">0</span> essence
                    </div>
                    <button class="btn prestige-btn" id="prestigeBtn" style="width: 100%;">üåü TERRAFORMER</button>
                </div>

                <!-- Events Log -->
                <div class="panel-card">
                    <h3 class="section-title" style="font-size: 1.3em;">üì∞ √âv√©nements</h3>
                    <div class="event-log" id="eventLog">
                        <div class="event-item">üéÆ Bienvenue dans World Factory !</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Controls -->
        <div class="bottom-controls">
            <button class="btn" id="tutorialBtn">üìñ TUTORIEL</button>
            <button class="btn" id="resetBtn" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">üîÑ RESET</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <h1>üìñ WORLD FACTORY - TUTORIEL COMPLET</h1>

            <h2>üéØ OBJECTIF DU JEU</h2>
            <p>D√©veloppez votre plan√®te √† travers 3 √®res distinctes de l'√©volution civilisationnelle ! Construisez des b√¢timents, g√©rez vos ressources et devenez ma√Ætre de votre monde.</p>

            <h2>üìä SYST√àME DE RESSOURCES</h2>
            <ul>
                <li><strong>ü™® Pierre:</strong> Ressource de base, n√©cessaire pour la plupart des constructions primitives</li>
                <li><strong>‚öôÔ∏è Fer:</strong> Ressource interm√©diaire, essentielle pour l'industrialisation</li>
                <li><strong>‚ö° √ânergie:</strong> Ressource avanc√©e, cruciale pour les technologies de pointe</li>
            </ul>
            <p>Toutes les ressources se g√©n√®rent automatiquement au fil du temps gr√¢ce √† vos b√¢timents.</p>

            <h2>üèóÔ∏è CONSTRUCTIONS ET PROGRESSION</h2>
            <p>Chaque b√¢timent produit des ressources automatiquement. Plus vous en construisez, plus ils deviennent chers (syst√®me de co√ªt croissant).</p>

            <h3>üìç √àre Primitive (D√©part)</h3>
            <ul>
                <li><strong>ü™® Cueilleur de Pierre:</strong> Premi√®re source de pierre (1/s)</li>
                <li><strong>ü™µ Collecteur de Bois:</strong> Production am√©lior√©e de pierre (2/s)</li>
                <li><strong>‚õèÔ∏è Mine Basique:</strong> Commence √† extraire du fer (0.5/s)</li>
                <li><strong>üå¨Ô∏è Moulin √† Vent:</strong> Premi√®re source d'√©nergie (0.3/s)</li>
            </ul>

            <h3>üè≠ √àre Industrielle (1,000 production totale)</h3>
            <ul>
                <li><strong>üèóÔ∏è Carri√®re:</strong> Production massive de pierre (10/s)</li>
                <li><strong>üî• Fonderie:</strong> Forge industrielle de fer (5/s)</li>
                <li><strong>üí® Centrale Vapeur:</strong> √ânergie √† grande √©chelle (3/s)</li>
                <li><strong>üè≠ Usine:</strong> Production multiple (pierre + fer)</li>
            </ul>

            <h3>üöÄ √àre Spatiale (100,000 production totale)</h3>
            <ul>
                <li><strong>‚òÑÔ∏è Mineur d'Ast√©ro√Ødes:</strong> Extraction spatiale massive</li>
                <li><strong>üî¨ Nano-Forge:</strong> Fabrication mol√©culaire de fer (200/s)</li>
                <li><strong>‚ò¢Ô∏è R√©acteur √† Fusion:</strong> √ânergie quasi-illimit√©e (100/s)</li>
                <li><strong>üöÄ Ascenseur Spatial:</strong> Production ultime de toutes les ressources!</li>
            </ul>

            <h2>‚ú® TERRAFORMAGE (PRESTIGE)</h2>
            <p>Quand vous atteignez un niveau de production suffisant, vous pouvez "terraformer" votre plan√®te:</p>
            <ul>
                <li><strong>Condition:</strong> Production totale √©lev√©e (visible dans le gain estim√© d'essence)</li>
                <li><strong>Effet:</strong> R√©initialise TOUTE votre progression (b√¢timents, ressources, √®re)</li>
                <li><strong>R√©compense:</strong> Essence Cosmique (üíé)</li>
                <li><strong>Bonus Permanent:</strong> Chaque Essence = +10% de production pour TOUS vos b√¢timents!</li>
            </ul>
            <p><strong>Exemple:</strong> 5 Essence = +50% de production permanente, m√™me apr√®s reset!</p>

            <h2>üåç PROGRESSION DES √àRES</h2>
            <p>Pour d√©bloquer une nouvelle √®re:</p>
            <ol>
                <li>Construisez des b√¢timents pour augmenter votre production</li>
                <li>La barre de progression se remplit automatiquement</li>
                <li>Atteignez le seuil requis pour d√©bloquer de nouveaux b√¢timents</li>
                <li>Votre plan√®te √©volue visuellement (üåç ‚Üí üè≠ ‚Üí üöÄ)</li>
            </ol>

            <h2>üë• POPULATION</h2>
            <p>Votre population augmente avec chaque b√¢timent construit (1 b√¢timent = 10 habitants). C'est un indicateur de votre r√©ussite!</p>

            <h2>üì∞ √âV√âNEMENTS AL√âATOIRES</h2>
            <p>Tous les 30 secondes, des √©v√©nements cosmiques peuvent se produire:</p>
            <ul>
                <li>‚òÑÔ∏è Passage d'ast√©ro√Øde ‚Üí bonus de pierre</li>
                <li>üåü Filon min√©ral ‚Üí bonus de fer</li>
                <li>‚ö° Temp√™te d'√©nergie ‚Üí bonus d'√©nergie</li>
                <li>üî¨ Perc√©e technologique ‚Üí bonus de ressources</li>
            </ul>

            <h2>üí° STRAT√âGIES ET ASTUCES</h2>
            <ul>
                <li><strong>D√©but de partie:</strong> Concentrez-vous sur les Cueilleurs de Pierre pour d√©marrer</li>
                <li><strong>Diversification:</strong> √âquilibrez vos b√¢timents entre pierre, fer et √©nergie</li>
                <li><strong>Unlock rapide:</strong> Construisez beaucoup pour d√©bloquer les √®res plus vite</li>
                <li><strong>Patience:</strong> Les b√¢timents tardifs co√ªtent cher mais rapportent √©norm√©ment</li>
                <li><strong>Prestige timing:</strong> Terraformez quand vous gagnez au moins 5-10 Essence</li>
                <li><strong>Post-Prestige:</strong> Avec l'Essence, vous progresserez beaucoup plus vite!</li>
                <li><strong>Sauvegarde auto:</strong> Le jeu se sauvegarde automatiquement toutes les 10 secondes</li>
            </ul>

            <h2>üéÆ CONSEILS DE JEU</h2>
            <ul>
                <li>Surveillez vos ratios de ressources dans les onglets du haut</li>
                <li>Les b√¢timents gris√©s sont verrouill√©s jusqu'√† la prochaine √®re</li>
                <li>Le co√ªt augmente exponentiellement - planifiez vos achats</li>
                <li>La barre de progression d'√®re se remplit en fonction de votre production totale</li>
                <li>Plus vous avez d'Essence, plus le jeu devient facile et rapide</li>
            </ul>

            <div class="modal-buttons">
                <button class="btn" onclick="closeTutorial()">COMMENCER L'AVENTURE ! üöÄ</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const game = {
            resources: {
                stone: 0,
                iron: 0,
                energy: 0
            },
            buildings: {
                // Primitive Era
                stoneGatherer: 0,
                woodCollector: 0,
                basicMine: 0,
                windmill: 0,
                // Industrial Era
                quarry: 0,
                ironFoundry: 0,
                steamPlant: 0,
                factory: 0,
                // Spatial Era
                asteroidMiner: 0,
                nanoForge: 0,
                fusionReactor: 0,
                spaceElevator: 0
            },
            era: 0, // 0: Primitive, 1: Industrial, 2: Spatial
            essence: 0,
            totalProduction: 0,
            population: 0
        };

        // Building Definitions
        const buildingData = {
            // ERA 0: PRIMITIVE
            stoneGatherer: {
                name: 'Cueilleur de Pierre',
                icon: 'ü™®',
                era: 0,
                baseCost: { stone: 10 },
                production: { stone: 1 },
                costMultiplier: 1.15
            },
            woodCollector: {
                name: 'Collecteur de Bois',
                icon: 'ü™µ',
                era: 0,
                baseCost: { stone: 25 },
                production: { stone: 2 },
                costMultiplier: 1.18
            },
            basicMine: {
                name: 'Mine Basique',
                icon: '‚õèÔ∏è',
                era: 0,
                baseCost: { stone: 100 },
                production: { iron: 0.5 },
                costMultiplier: 1.2
            },
            windmill: {
                name: 'Moulin √† Vent',
                icon: 'üå¨Ô∏è',
                era: 0,
                baseCost: { stone: 200, iron: 50 },
                production: { energy: 0.3 },
                costMultiplier: 1.25
            },

            // ERA 1: INDUSTRIAL
            quarry: {
                name: 'Carri√®re',
                icon: 'üèóÔ∏è',
                era: 1,
                baseCost: { stone: 1000, iron: 500 },
                production: { stone: 10 },
                costMultiplier: 1.15
            },
            ironFoundry: {
                name: 'Fonderie',
                icon: 'üî•',
                era: 1,
                baseCost: { stone: 2000, iron: 1000 },
                production: { iron: 5 },
                costMultiplier: 1.18
            },
            steamPlant: {
                name: 'Centrale Vapeur',
                icon: 'üí®',
                era: 1,
                baseCost: { stone: 5000, iron: 3000 },
                production: { energy: 3 },
                costMultiplier: 1.2
            },
            factory: {
                name: 'Usine',
                icon: 'üè≠',
                era: 1,
                baseCost: { stone: 10000, iron: 5000, energy: 1000 },
                production: { stone: 15, iron: 8 },
                costMultiplier: 1.22
            },

            // ERA 2: SPATIAL
            asteroidMiner: {
                name: 'Mineur d\'Ast√©ro√Ødes',
                icon: '‚òÑÔ∏è',
                era: 2,
                baseCost: { stone: 50000, iron: 25000, energy: 10000 },
                production: { stone: 100, iron: 50 },
                costMultiplier: 1.15
            },
            nanoForge: {
                name: 'Nano-Forge',
                icon: 'üî¨',
                era: 2,
                baseCost: { iron: 100000, energy: 50000 },
                production: { iron: 200 },
                costMultiplier: 1.18
            },
            fusionReactor: {
                name: 'R√©acteur √† Fusion',
                icon: '‚ò¢Ô∏è',
                era: 2,
                baseCost: { iron: 200000, energy: 100000 },
                production: { energy: 100 },
                costMultiplier: 1.2
            },
            spaceElevator: {
                name: 'Ascenseur Spatial',
                icon: 'üöÄ',
                era: 2,
                baseCost: { stone: 500000, iron: 300000, energy: 200000 },
                production: { stone: 200, iron: 150, energy: 100 },
                costMultiplier: 1.25
            }
        };

        // Era names and icons
        const eras = [
            { name: '√àre Primitive', icon: 'üåç', threshold: 1000 },
            { name: '√àre Industrielle', icon: 'üè≠', threshold: 100000 },
            { name: '√àre Spatiale', icon: 'üöÄ', threshold: Infinity }
        ];

        // Calculate current building cost
        function getBuildingCost(buildingId) {
            const data = buildingData[buildingId];
            const count = game.buildings[buildingId];
            const cost = {};

            for (const [resource, baseAmount] of Object.entries(data.baseCost)) {
                cost[resource] = Math.floor(baseAmount * Math.pow(data.costMultiplier, count));
            }

            return cost;
        }

        // Check if can afford building
        function canAfford(cost) {
            for (const [resource, amount] of Object.entries(cost)) {
                if (game.resources[resource] < amount) return false;
            }
            return true;
        }

        // Buy building
        function buyBuilding(buildingId) {
            const cost = getBuildingCost(buildingId);

            if (!canAfford(cost)) return;

            // Deduct resources
            for (const [resource, amount] of Object.entries(cost)) {
                game.resources[resource] -= amount;
            }

            game.buildings[buildingId]++;
            addEvent(`‚úÖ Construit: ${buildingData[buildingId].name}`);
            updateUI();
            saveGame();
        }

        // Calculate production rates
        function calculateProduction() {
            const rates = { stone: 0, iron: 0, energy: 0 };
            const bonus = 1 + (game.essence * 0.1); // 10% per essence

            for (const [buildingId, count] of Object.entries(game.buildings)) {
                if (count > 0) {
                    const data = buildingData[buildingId];
                    for (const [resource, amount] of Object.entries(data.production)) {
                        rates[resource] += amount * count * bonus;
                    }
                }
            }

            return rates;
        }

        // Production tick (every 100ms)
        function productionTick() {
            const rates = calculateProduction();
            const tickAmount = 0.1; // 100ms = 0.1 seconds

            for (const [resource, rate] of Object.entries(rates)) {
                game.resources[resource] += rate * tickAmount;
            }

            // Update total production for era progression
            game.totalProduction = game.resources.stone + game.resources.iron * 10 + game.resources.energy * 20;

            // Calculate population (sum of all buildings)
            game.population = Object.values(game.buildings).reduce((a, b) => a + b, 0) * 10;

            // Check for era advancement
            checkEraAdvancement();

            updateUI();
        }

        // Check and advance era
        function checkEraAdvancement() {
            if (game.era < 2) {
                const threshold = eras[game.era].threshold;
                if (game.totalProduction >= threshold) {
                    game.era++;
                    addEvent(`üéâ NOUVELLE √àRE D√âBLOQU√âE: ${eras[game.era].name} !`);
                    updateUI();
                }
            }
        }

        // Calculate essence gain for prestige
        function calculateEssenceGain() {
            const baseGain = Math.floor(game.totalProduction / 10000);
            const eraBonus = game.era;
            return Math.max(0, baseGain + eraBonus);
        }

        // Prestige (Terraformage)
        function prestige() {
            const essenceGain = calculateEssenceGain();

            if (essenceGain === 0) {
                addEvent('‚ùå Production insuffisante pour terraformer !');
                return;
            }

            if (!confirm(`Terraformer la plan√®te?\n\n‚ú® Gain: ${essenceGain} Essence Cosmique\n‚ö†Ô∏è Tous les progr√®s seront r√©initialis√©s\nüíé Bonus permanent: +${(essenceGain * 10)}% production`)) {
                return;
            }

            game.essence += essenceGain;

            // Reset everything except essence
            game.resources = { stone: 0, iron: 0, energy: 0 };
            game.buildings = {
                stoneGatherer: 0, woodCollector: 0, basicMine: 0, windmill: 0,
                quarry: 0, ironFoundry: 0, steamPlant: 0, factory: 0,
                asteroidMiner: 0, nanoForge: 0, fusionReactor: 0, spaceElevator: 0
            };
            game.era = 0;
            game.totalProduction = 0;
            game.population = 0;

            addEvent(`‚ú® TERRAFORMAGE R√âUSSI ! +${essenceGain} Essence Cosmique !`);
            updateUI();
            saveGame();
        }

        // Render buildings
        function renderBuildings() {
            const grid = document.getElementById('buildingsGrid');
            grid.innerHTML = '';

            for (const [buildingId, data] of Object.entries(buildingData)) {
                const isLocked = data.era > game.era;
                const count = game.buildings[buildingId];
                const cost = getBuildingCost(buildingId);
                const affordable = canAfford(cost);

                const card = document.createElement('div');
                card.className = 'building-card' + (isLocked ? ' locked' : '');

                // Build cost string
                let costStr = '';
                for (const [resource, amount] of Object.entries(cost)) {
                    const icon = resource === 'stone' ? 'ü™®' : resource === 'iron' ? '‚öôÔ∏è' : '‚ö°';
                    const color = game.resources[resource] >= amount ? '#48bf91' : '#e74c3c';
                    costStr += `${icon} <span style="color: ${color}">${formatNumber(amount)}</span>  `;
                }

                // Build production string
                let prodStr = '';
                for (const [resource, amount] of Object.entries(data.production)) {
                    const icon = resource === 'stone' ? 'ü™®' : resource === 'iron' ? '‚öôÔ∏è' : '‚ö°';
                    const bonus = 1 + (game.essence * 0.1);
                    prodStr += `${icon} +${formatNumber(amount * bonus)}/s  `;
                }

                card.innerHTML = `
                    <div class="building-header">
                        <div>
                            <div class="building-name">${data.name}</div>
                            <div class="building-count">Quantit√©: ${count}</div>
                        </div>
                        <div class="building-icon">${data.icon}</div>
                    </div>
                    <div class="building-production">Production: ${prodStr}</div>
                    <div class="building-cost">Co√ªt: ${costStr}</div>
                    ${isLocked ?
                        `<div class="locked-message">üîí D√©bloqu√© √† ${eras[data.era].name}</div>` :
                        `<button class="btn" onclick="buyBuilding('${buildingId}')" ${!affordable ? 'disabled' : ''}>
                            CONSTRUIRE
                        </button>`
                    }
                `;

                grid.appendChild(card);
            }
        }

        // Update UI
        function updateUI() {
            // Resources
            const rates = calculateProduction();
            document.getElementById('stoneAmount').textContent = formatNumber(game.resources.stone);
            document.getElementById('ironAmount').textContent = formatNumber(game.resources.iron);
            document.getElementById('energyAmount').textContent = formatNumber(game.resources.energy);
            document.getElementById('stoneRate').textContent = `+${formatNumber(rates.stone)}/s`;
            document.getElementById('ironRate').textContent = `+${formatNumber(rates.iron)}/s`;
            document.getElementById('energyRate').textContent = `+${formatNumber(rates.energy)}/s`;

            // Era
            document.getElementById('eraDisplay').textContent = eras[game.era].name;
            document.getElementById('planetVisual').textContent = eras[game.era].icon;

            // Population
            document.getElementById('population').textContent = formatNumber(game.population);

            // Era Progress
            if (game.era < 2) {
                const threshold = eras[game.era].threshold;
                const progress = Math.min(100, (game.totalProduction / threshold) * 100);
                document.getElementById('eraProgress').style.width = progress + '%';
                document.getElementById('eraProgress').textContent = Math.floor(progress) + '%';
            } else {
                document.getElementById('eraProgress').style.width = '100%';
                document.getElementById('eraProgress').textContent = 'MAX';
            }

            // Essence
            document.getElementById('essenceAmount').textContent = game.essence;
            document.getElementById('essenceBonus').textContent = (game.essence * 10).toFixed(0);
            const essenceGain = calculateEssenceGain();
            document.getElementById('essenceGain').textContent = essenceGain;
            document.getElementById('prestigeBtn').disabled = essenceGain === 0;

            // Rebuild buildings list
            renderBuildings();
        }

        // Format large numbers
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num).toString();
            if (num < 1000000) return (num / 1000).toFixed(1) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(1) + 'M';
            return (num / 1000000000).toFixed(1) + 'B';
        }

        // Add event to log
        function addEvent(message) {
            const log = document.getElementById('eventLog');
            const item = document.createElement('div');
            item.className = 'event-item';
            item.textContent = message;
            log.insertBefore(item, log.firstChild);

            // Keep only last 20 events
            while (log.children.length > 20) {
                log.removeChild(log.lastChild);
            }
        }

        // Random events
        const randomEvents = [
            { msg: '‚òÑÔ∏è Un ast√©ro√Øde passe pr√®s de votre plan√®te !', effect: () => { game.resources.stone += 100; } },
            { msg: 'üåü D√©couverte d\'un filon min√©ral !', effect: () => { game.resources.iron += 50; } },
            { msg: '‚ö° Temp√™te d\'√©nergie cosmique !', effect: () => { game.resources.energy += 30; } },
            { msg: 'üå± Croissance acc√©l√©r√©e de la population !', effect: () => { game.population += 100; } },
            { msg: 'üî¨ Perc√©e technologique mineure !', effect: () => { game.resources.iron += 200; } }
        ];

        function triggerRandomEvent() {
            if (Math.random() < 0.1) { // 10% chance every check
                const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
                event.effect();
                addEvent(event.msg);
            }
        }

        // Save/Load
        function saveGame() {
            localStorage.setItem('worldFactory_save', JSON.stringify(game));
        }

        function loadGame() {
            const saved = localStorage.getItem('worldFactory_save');
            if (saved) {
                Object.assign(game, JSON.parse(saved));
                addEvent('üíæ Partie charg√©e !');
            }
        }

        // Reset game
        function resetGame() {
            if (confirm('‚ö†Ô∏è Effacer TOUTE votre progression?\n\nCela inclut votre Essence Cosmique !')) {
                localStorage.removeItem('worldFactory_save');
                location.reload();
            }
        }

        // Tutorial
        function showTutorial() {
            document.getElementById('tutorialModal').style.display = 'block';
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').style.display = 'none';
        }

        // Event Listeners
        document.getElementById('prestigeBtn').addEventListener('click', prestige);
        document.getElementById('tutorialBtn').addEventListener('click', showTutorial);
        document.getElementById('resetBtn').addEventListener('click', resetGame);

        // Initialize
        loadGame();
        updateUI();

        // Game loops
        setInterval(productionTick, 100); // Production every 100ms
        setInterval(saveGame, 10000); // Auto-save every 10s
        setInterval(triggerRandomEvent, 30000); // Random events every 30s

        // Close modals on click outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
