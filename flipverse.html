<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flipverse - Trading Interdimensionnel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Share+Tech+Mono&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background: #0a0e27;
            color: #00ff41;
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        /* CRT Effect */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
            z-index: 9999;
        }

        /* Neon glow animation */
        @keyframes neonPulse {
            0%, 100% { text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41; }
            50% { text-shadow: 0 0 20px #00ff41, 0 0 40px #00ff41, 0 0 60px #00ff41; }
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, rgba(0, 255, 65, 0.1), rgba(0, 217, 255, 0.1));
            border: 2px solid #00ff41;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.3);
            position: relative;
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em;
            font-weight: 900;
            color: #00ff41;
            text-align: center;
            animation: neonPulse 2s infinite;
            letter-spacing: 3px;
        }

        .subtitle {
            text-align: center;
            color: #00d9ff;
            margin-top: 10px;
            font-size: 1.1em;
        }

        .header-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: 2px solid #00ff41;
            background: rgba(0, 255, 65, 0.1);
            color: #00ff41;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            touch-action: manipulation;
        }

        .btn:hover {
            background: rgba(0, 255, 65, 0.3);
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.5);
            transform: scale(1.05);
        }

        .btn-danger {
            border-color: #ff0055;
            color: #ff0055;
            background: rgba(255, 0, 85, 0.1);
        }

        .btn-danger:hover {
            background: rgba(255, 0, 85, 0.3);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
        }

        /* Stats Bar */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.6);
            border: 2px solid #00d9ff;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
        }

        .stat-label {
            color: #00d9ff;
            font-size: 0.9em;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            color: #00ff41;
        }

        /* Main Grid */
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
        }

        .panel h2 {
            font-family: 'Orbitron', sans-serif;
            color: #00ff41;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.3);
            font-size: 1.5em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Trading Items */
        .item-card {
            background: linear-gradient(135deg, rgba(0, 255, 65, 0.05), rgba(0, 217, 255, 0.05));
            border: 1px solid rgba(0, 255, 65, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .item-card:hover {
            border-color: #00ff41;
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
            transform: translateX(5px);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .item-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #00ff41;
            font-family: 'Orbitron', sans-serif;
        }

        .rarity {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            text-transform: uppercase;
        }

        .rarity-common { background: rgba(150, 150, 150, 0.3); color: #aaa; border: 1px solid #888; }
        .rarity-rare { background: rgba(0, 150, 255, 0.3); color: #00d9ff; border: 1px solid #00d9ff; }
        .rarity-legendary { background: rgba(255, 215, 0, 0.3); color: #ffd700; border: 1px solid #ffd700; }
        .rarity-mythic { background: rgba(255, 0, 255, 0.3); color: #ff00ff; border: 1px solid #ff00ff; }

        .item-price {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .price-current {
            color: #00d9ff;
            font-weight: 700;
        }

        .price-change {
            font-weight: 700;
        }

        .price-up { color: #00ff41; }
        .price-down { color: #ff0055; }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .quantity-input {
            width: 80px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff41;
            color: #00ff41;
            border-radius: 6px;
            font-family: 'Share Tech Mono', monospace;
            text-align: center;
        }

        .btn-buy {
            flex: 1;
            padding: 10px;
            background: rgba(0, 255, 65, 0.2);
            border: 2px solid #00ff41;
            color: #00ff41;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .btn-buy:hover {
            background: rgba(0, 255, 65, 0.4);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
        }

        .btn-sell {
            flex: 1;
            padding: 10px;
            background: rgba(255, 0, 85, 0.2);
            border: 2px solid #ff0055;
            color: #ff0055;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            touch-action: manipulation;
        }

        .btn-sell:hover {
            background: rgba(255, 0, 85, 0.4);
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.5);
        }

        .btn-sell:disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }

        /* Portfolio */
        .portfolio-empty {
            text-align: center;
            padding: 40px;
            color: rgba(0, 217, 255, 0.5);
            font-style: italic;
        }

        .portfolio-item {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .portfolio-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .profit-positive { color: #00ff41; }
        .profit-negative { color: #ff0055; }

        /* News Feed */
        .news-feed {
            max-height: 300px;
            overflow-y: auto;
        }

        .news-feed::-webkit-scrollbar {
            width: 8px;
        }

        .news-feed::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.5);
        }

        .news-feed::-webkit-scrollbar-thumb {
            background: #00ff41;
            border-radius: 10px;
        }

        .news-item {
            background: rgba(0, 255, 65, 0.1);
            border-left: 3px solid #00ff41;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 5px;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .news-item.event {
            border-left-color: #ff0055;
            background: rgba(255, 0, 85, 0.1);
        }

        .news-item.success {
            border-left-color: #00ff41;
        }

        /* Agents */
        .agent-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.05));
            border: 2px solid rgba(255, 215, 0, 0.5);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .agent-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #ffd700;
            margin-bottom: 8px;
        }

        .agent-desc {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 10px;
            font-size: 0.95em;
        }

        .agent-cost {
            color: #00d9ff;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .agent-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 700;
            display: inline-block;
        }

        .agent-active {
            background: rgba(0, 255, 65, 0.3);
            color: #00ff41;
            border: 1px solid #00ff41;
        }

        .agent-inactive {
            background: rgba(150, 150, 150, 0.3);
            color: #aaa;
            border: 1px solid #888;
        }

        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .stats-bar {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }

        .terminal-text {
            color: #00ff41;
            text-shadow: 0 0 5px #00ff41;
        }

        /* Dimension Badge */
        .dimension-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ff00ff, #00d9ff);
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 700;
            font-family: 'Orbitron', sans-serif;
            margin-left: 15px;
            font-size: 0.5em;
            animation: neonPulse 2s infinite;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            padding: 20px;
            overflow-y: auto;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            max-width: 900px;
            margin: 50px auto;
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.95), rgba(26, 26, 46, 0.95));
            padding: 40px;
            border-radius: 20px;
            border: 2px solid #00ff41;
            box-shadow: 0 0 50px rgba(0, 255, 65, 0.3);
        }

        .modal-content h1 {
            margin-bottom: 30px;
            color: #00ff41;
            text-align: center;
            font-family: 'Orbitron', sans-serif;
        }

        .modal-content h2 {
            margin-top: 30px;
            margin-bottom: 15px;
            color: #00d9ff;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5em;
        }

        .modal-content p {
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .modal-content ul {
            margin-left: 30px;
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .modal-content li {
            margin-bottom: 10px;
        }

        .modal-content strong {
            color: #00ff41;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>
                âš¡ FLIPVERSE <span class="dimension-badge" id="dimensionBadge">DIM-Î±</span>
            </h1>
            <p class="subtitle">// INTERDIMENSIONAL TRADING SYSTEM v5.0 - LIVING MARKET //</p>
            <div class="header-buttons">
                <button class="btn" onclick="window.location.href='index.html'">ğŸ  MENU</button>
                <button class="btn" onclick="showTutorial()">ğŸ“– TUTORIEL</button>
                <button class="btn" onclick="showAIStats()" style="background: linear-gradient(135deg, #ff00ff, #00d9ff); border: 2px solid #ff00ff;">ğŸ¤– AI STATS</button>
                <button class="btn" id="botToggleBtn" onclick="toggleBot()" style="background: linear-gradient(135deg, #00ff00, #00aa00); border: 2px solid #00ff00;">ğŸ¤– BOT: ON</button>
                <button class="btn" onclick="showChangelog()">ğŸ“ CHANGELOG</button>
                <button class="btn" onclick="switchDimension()">ğŸŒ€ PRESTIGE</button>
                <button class="btn-danger" onclick="confirmReset()">âš ï¸ RESET</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-box">
                <div class="stat-label">ğŸ’° CAPITAL</div>
                <div class="stat-value terminal-text" id="money">10000 Â¢</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ğŸ“Š PORTFOLIO</div>
                <div class="stat-value terminal-text" id="portfolioValue">10000 Â¢</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ğŸ’¹ PROFIT</div>
                <div class="stat-value terminal-text" id="totalProfit">0 Â¢</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">ğŸ”„ TRADES</div>
                <div class="stat-value terminal-text" id="totalTrades">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">âœ¨ ESSENCE</div>
                <div class="stat-value terminal-text" id="essence">0</div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Market -->
            <div class="panel">
                <h2>ğŸ“ˆ MARKET</h2>
                <div id="market"></div>
            </div>

            <!-- Portfolio -->
            <div class="panel">
                <h2>ğŸ’¼ PORTFOLIO</h2>
                <div id="portfolio">
                    <div class="portfolio-empty">[ PORTFOLIO EMPTY ]</div>
                </div>
            </div>

            <!-- Agents -->
            <div class="panel">
                <h2>ğŸ¤– AGENTS</h2>
                <div id="agents"></div>
            </div>

            <!-- News -->
            <div class="panel">
                <h2>ğŸ“¡ NEWS FEED</h2>
                <div class="news-feed" id="news">
                    <div class="news-item">
                        > SYSTEM INITIALIZED<br>
                        > WELCOME TO FLIPVERSE<br>
                        > DIMENSION: ALPHA<br>
                        > TRADING ENABLED
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="modal">
        <div class="modal-content">
            <h1>ğŸ“– FLIPVERSE - TUTORIEL</h1>

            <h2>ğŸ¯ OBJECTIF</h2>
            <p>Deviens riche en faisant du trading d'objets interdimensionnels Ã  travers le multivers ! AchÃ¨te bas, vends haut, et maÃ®trise les marchÃ©s volatils.</p>

            <h2>ğŸ’° COMMENT JOUER</h2>
            <ul>
                <li><strong>ğŸ“ˆ Surveille le MarchÃ© :</strong> Les prix fluctuent toutes les 5 secondes. L'indicateur % montre les tendances du marchÃ©.</li>
                <li><strong>ğŸ’µ AchÃ¨te Malin :</strong> AchÃ¨te les objets quand les prix sont bas ou en baisse (indicateur rouge).</li>
                <li><strong>ğŸ“Š Vends Haut :</strong> Attends que les prix montent (indicateur vert), puis revends pour faire du profit !</li>
                <li><strong>ğŸ’¼ Gestion de Portfolio :</strong> Ton portfolio affiche en temps rÃ©el les profits/pertes pour chaque objet.</li>
                <li><strong>ğŸ² RaretÃ© des Objets :</strong> Plus c'est rare = plus de volatilitÃ© et de profits potentiels !</li>
            </ul>

            <h2>ğŸ’ SYSTÃˆME DE RARETÃ‰</h2>
            <ul>
                <li><strong style="color: #aaa;">Commun :</strong> Faible volatilitÃ© (15-18%), sÃ»r mais rendements faibles</li>
                <li><strong style="color: #00d9ff;">Rare :</strong> VolatilitÃ© moyenne (22-25%), risque/rÃ©compense Ã©quilibrÃ©</li>
                <li><strong style="color: #ffd700;">LÃ©gendaire :</strong> Haute volatilitÃ© (35-40%), risquÃ© mais rentable</li>
                <li><strong style="color: #ff00ff;">Mythique :</strong> VolatilitÃ© extrÃªme (50-55%), risque et gains massifs !</li>
            </ul>

            <h2>ğŸ¤– AGENTS - TOUS FONCTIONNELS !</h2>
            <ul>
                <li><strong>ğŸ¤– ANALYST-7 EXPERT v5.1 (10 000Â¢) :</strong> ğŸ”¥ Ton analyste professionnel !
                    <ul style="margin-top: 8px; margin-left: 20px; font-size: 0.95em;">
                        <li>ğŸ§  <strong>Analyse Technique AvancÃ©e :</strong> Utilise RSI, EMA, Bollinger Bands, Momentum</li>
                        <li>ğŸ“Š <strong>Supply/Demand :</strong> Combine indicateurs techniques avec niveaux de stock</li>
                        <li>ğŸš¨ <strong>Alertes Critiques :</strong> RSI extrÃªmes, Bollinger breakouts, zones dangereuses</li>
                        <li>ğŸ’ <strong>OpportunitÃ©s Majeures :</strong> DÃ©tecte les combos parfaits (RSI + Stock + Momentum)</li>
                        <li>ğŸ“ˆ <strong>Analyse de Tendances :</strong> Momentum fort, reversals, confirmations</li>
                        <li>ğŸ’¼ <strong>Conseils Portfolio :</strong> Analyse tes positions avec profit/perte + signaux de sortie</li>
                        <li>ğŸ¯ <strong>Timing PrÃ©cis :</strong> Te dit exactement QUAND acheter/vendre avec justification</li>
                        <li>âœ… Messages dÃ©taillÃ©s avec mÃ©triques (RSI, momentum, profit %, etc.)</li>
                    </ul>
                </li>
                <li><strong>ğŸ’¼ TRADER-X ULTRA v5.2 (5 000Â¢) :</strong> ğŸ”¥ IA de trading professionnelle avec SMART EXIT !
                    <ul style="margin-top: 8px; margin-left: 20px; font-size: 0.95em;">
                        <li>ğŸ§  <strong>Indicateurs Techniques :</strong> RSI, EMA, MACD, Bollinger Bands, Momentum, Support/Resistance, Supply/Demand</li>
                        <li>ğŸ“Š <strong>Score Multi-Facteurs :</strong> Analyse 8+ indicateurs pour donner un score 0-100</li>
                        <li>ğŸ¤– <strong>Machine Learning :</strong> MÃ©morise les patterns gagnants et ajuste ses seuils automatiquement</li>
                        <li>ğŸ’° <strong>Position Sizing Intelligent :</strong> Taille des positions adaptÃ©e Ã  la confiance (60-100%)</li>
                        <li>âš¡ <strong>SMART EXIT v5.2 :</strong> 5 conditions de sortie intelligentes:
                            <ul style="margin-left: 15px; margin-top: 5px;">
                                <li>ğŸ¯ High Sell Score (â‰¥70 + profit â‰¥6%)</li>
                                <li>ğŸ”’ Peak Lock (profit +12%+ puis -2% drop)</li>
                                <li>ğŸ“Š Dynamic Targets (Scalp 2-4%, Swing 5-8%, Hold 10-15%)</li>
                                <li>ğŸ›¡ï¸ Trailing Stop (-10% depuis pic)</li>
                                <li>âœ… Break-Even Stop (+5% â†’ +1%)</li>
                            </ul>
                        </li>
                        <li>ğŸš€ <strong>Trades 2-3x Plus Rapides :</strong> Lock les profits avant qu'ils redescendent</li>
                        <li>ğŸ’ <strong>RÃ©serve de Cash :</strong> Garde 25% en sÃ©curitÃ©</li>
                        <li>ğŸ“° <strong>Messages DÃ©taillÃ©s :</strong> Score, RSI, Confidence + raison de vente exacte</li>
                        <li>ğŸ“Š <strong>Dashboard AI :</strong> Clique sur "ğŸ¤– AI STATS" pour voir toutes les statistiques !</li>
                    </ul>
                </li>
                <li><strong>ğŸ›¡ï¸ GUARDIAN (25 000Â¢) :</strong> ğŸ”¥ ProtÃ¨ge ton portfolio !
                    <ul style="margin-top: 8px; margin-left: 20px; font-size: 0.95em;">
                        <li>âœ… Vend automatiquement si tu es Ã  -20% de perte (stop-loss)</li>
                        <li>âœ… Protection contre les crashes de marchÃ©</li>
                        <li>âœ… Limite les dÃ©gÃ¢ts en vendant TOUT l'objet en perte</li>
                        <li>âœ… Messages prÃ©fixÃ©s par "ğŸ›¡ï¸ GUARDIAN"</li>
                    </ul>
                </li>
                <li><strong>ğŸ”® PROPHET (50 000Â¢) :</strong> ğŸ”¥ PrÃ©dit l'avenir !
                    <ul style="margin-top: 8px; margin-left: 20px; font-size: 0.95em;">
                        <li>âœ… Analyse les tendances des 4 derniers prix</li>
                        <li>âœ… PrÃ©dit si un objet va continuer Ã  monter ou baisser</li>
                        <li>âœ… DÃ©tecte les rebonds potentiels (reversals)</li>
                        <li>âœ… Messages prÃ©fixÃ©s par "ğŸ”® PROPHET"</li>
                    </ul>
                </li>
            </ul>
            <p style="margin-top: 15px; color: #00ff41;"><strong>ğŸ’¡ ASTUCE :</strong> Active tous les agents pour une expÃ©rience de trading automatisÃ©e complÃ¨te !</p>

            <h2>âœ¨ PRESTIGE : SAUT DIMENSIONNEL</h2>
            <ul>
                <li><strong>Condition :</strong> 50 000Â¢ de valeur totale (argent + portfolio)</li>
                <li><strong>Effet :</strong> RÃ©initialise toute ta progression mais gagne de l'Essence Cosmique</li>
                <li><strong>Bonus :</strong> Chaque Essence donne +10% de bonus de production permanent</li>
                <li><strong>StratÃ©gie :</strong> Plus ta valeur totale est Ã©levÃ©e, plus tu gagnes d'Essence !</li>
            </ul>

            <h2>ğŸŒŠ SUPPLY & DEMAND (Offre & Demande) - NOUVEAU v5.0 !</h2>
            <ul>
                <li><strong>ğŸ“¦ Stock LimitÃ© :</strong> Chaque crypto a un stock maximum disponible sur le marchÃ©</li>
                <li><strong>ğŸ“Š Affichage en Temps RÃ©el :</strong> Voir le stock disponible avec barre de progression</li>
                <li><strong>ğŸ”´ğŸŸ¡ğŸŸ¢ Indicateur de RaretÃ© :</strong>
                    <ul style="margin-left: 20px; font-size: 0.95em;">
                        <li>ğŸ”´ RARE (< 30% stock) = Prix trÃ¨s Ã©levÃ©</li>
                        <li>ğŸŸ¡ MOYEN (30-70% stock) = Prix normal</li>
                        <li>ğŸŸ¢ ABONDANT (> 70% stock) = Prix bas</li>
                    </ul>
                </li>
                <li><strong>ğŸ’° Prix Dynamiques :</strong>
                    <ul style="margin-left: 20px; font-size: 0.95em;">
                        <li>Stock bas â†’ Prix monte automatiquement (jusqu'Ã  Ã—2.5)</li>
                        <li>Stock Ã©levÃ© â†’ Prix baisse automatiquement (jusqu'Ã  Ã—0.6)</li>
                    </ul>
                </li>
                <li><strong>ğŸ”„ Impact de Tes Actions :</strong>
                    <ul style="margin-left: 20px; font-size: 0.95em;">
                        <li>Tu achÃ¨tes â†’ Stock diminue â†’ Prix augmente</li>
                        <li>Tu vends â†’ Stock augmente â†’ Prix diminue</li>
                    </ul>
                </li>
                <li><strong>ğŸ¤– Traders Virtuels :</strong> D'autres traders achÃ¨tent/vendent automatiquement, le marchÃ© bouge mÃªme sans toi !</li>
                <li><strong>ğŸ¯ StratÃ©gie :</strong> AchÃ¨te en masse quand ğŸŸ¢ ABONDANT (prix bas), vends quand ğŸ”´ RARE (prix Ã©levÃ©) !</li>
            </ul>

            <h2>ğŸ’¡ ASTUCES PRO</h2>
            <ul>
                <li>Commence avec les objets Communs pour apprendre le marchÃ© en sÃ©curitÃ©</li>
                <li>Diversifie ton portfolio sur plusieurs objets diffÃ©rents</li>
                <li>Profit vert dans le portfolio = bon moment pour vendre</li>
                <li>Perte rouge dans le portfolio = attends la remontÃ©e ou coupe tes pertes</li>
                <li>Regarde l'indicateur % pour voir l'Ã©lan du marchÃ©</li>
                <li>Les objets Mythiques peuvent doubler ou perdre la moitiÃ© de leur valeur rapidement !</li>
                <li><strong>ğŸ†• Surveille le stock :</strong> AchÃ¨te quand abondant (pas cher), vends quand rare (cher) !</li>
                <li>Ta progression est sauvegardÃ©e automatiquement toutes les 10 secondes</li>
            </ul>

            <div class="modal-buttons">
                <button class="btn" onclick="closeTutorial()" style="background: rgba(0, 255, 65, 0.3); border: 2px solid #00ff41;">COMMENCER Ã€ TRADER ! ğŸš€</button>
            </div>
        </div>
    </div>

    <!-- Changelog Modal -->
    <div id="changelogModal" class="modal">
        <div class="modal-content">
            <h1>ğŸ“ FLIPVERSE - CHANGELOG</h1>

            <div style="background: linear-gradient(135deg, rgba(0, 255, 65, 0.4), rgba(0, 217, 255, 0.3)); padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #00ff41; box-shadow: 0 0 40px rgba(0, 255, 65, 0.4);">
                <h3 style="color: #00ff41; margin-bottom: 10px; font-size: 1.6em;">ğŸŒŠ Version 5.0 - MARCHÃ‰ VIVANT (Supply & Demand) ! ğŸ“ŠğŸ’¹</h3>
                <p style="color: rgba(255,255,255,0.95); margin-bottom: 15px;"><strong>Date:</strong> Novembre 2024 - RÃ‰VOLUTION Ã‰CONOMIQUE</p>

                <h4 style="color: #00d9ff; margin-top: 20px; margin-bottom: 10px;">ğŸ“¦ SYSTÃˆME DE STOCK RÃ‰ALISTE</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸª <strong>Stock LimitÃ© :</strong> Chaque crypto a un stock max (150-2000 unitÃ©s selon raretÃ©)</li>
                    <li>ğŸ“Š <strong>Stock Visible :</strong> Barre de progression + nombre disponible en temps rÃ©el</li>
                    <li>ğŸ”´ğŸŸ¡ğŸŸ¢ <strong>Indicateur de RaretÃ© :</strong> RARE / MOYEN / ABONDANT</li>
                    <li>ğŸš« <strong>Limite d'Achat :</strong> Tu ne peux pas acheter plus que le stock disponible</li>
                    <li>ğŸ’¾ <strong>Persistance :</strong> Les niveaux de stock sont sauvegardÃ©s</li>
                </ul>

                <h4 style="color: #ffd700; margin-top: 20px; margin-bottom: 10px;">ğŸ’° PRIX DYNAMIQUES (Offre & Demande)</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ“ˆ <strong>RaretÃ© = Prix Ã‰levÃ© :</strong> Stock bas (30%) â†’ Prix Ã— 2.5 (trÃ¨s cher !)</li>
                    <li>ğŸ“‰ <strong>Abondance = Prix Bas :</strong> Stock Ã©levÃ© (90%) â†’ Prix Ã— 0.6 (bon marchÃ© !)</li>
                    <li>âš–ï¸ <strong>Ã‰quilibre :</strong> Stock moyen (50%) â†’ Prix normal Ã— 1.0</li>
                    <li>ğŸ”„ <strong>Impact de Tes Actions :</strong>
                        <ul style="margin-left: 20px;">
                            <li>Tu achÃ¨tes â†’ Stock baisse â†’ Prix monte</li>
                            <li>Tu vends â†’ Stock monte â†’ Prix baisse</li>
                        </ul>
                    </li>
                </ul>

                <h4 style="color: #ff00ff; margin-top: 20px; margin-bottom: 10px;">ğŸ¤– TRADERS VIRTUELS (MarchÃ© Vivant)</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ‘¥ <strong>MarchÃ© Actif 24/7 :</strong> Des traders virtuels achÃ¨tent/vendent automatiquement</li>
                    <li>ğŸ“Š <strong>ActivitÃ© Toutes les 5 sec :</strong> 0-5 traders par crypto par cycle</li>
                    <li>ğŸ§  <strong>Comportement Intelligent :</strong>
                        <ul style="margin-left: 20px;">
                            <li>Stock bas â†’ Plus de pression d'achat (traders veulent profiter)</li>
                            <li>Stock Ã©levÃ© â†’ Plus de pression de vente (traders se dÃ©barrassent)</li>
                        </ul>
                    </li>
                    <li>ğŸŒŠ <strong>MarchÃ© Vivant :</strong> Les prix bougent mÃªme si tu ne fais rien !</li>
                    <li>ğŸ“ˆ <strong>Volumes Variables :</strong> BasÃ©s sur la volatilitÃ© de chaque crypto</li>
                </ul>

                <h4 style="color: #00ff41; margin-top: 20px; margin-bottom: 10px;">ğŸ¤– AI ULTRA AMÃ‰LIORÃ‰E</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ“Š <strong>Nouvel Indicateur Supply :</strong> L'AI analyse maintenant le stock disponible</li>
                    <li>ğŸ’¡ <strong>DÃ©cisions Plus Intelligentes :</strong>
                        <ul style="margin-left: 20px;">
                            <li>AchÃ¨te quand stock Ã©levÃ© = prix bas = bonne affaire</li>
                            <li>Vend quand stock bas = prix Ã©levÃ© = max profit</li>
                        </ul>
                    </li>
                    <li>âš–ï¸ <strong>Poids Supply :</strong> 14% dans le score total (important !)</li>
                    <li>ğŸ“ˆ <strong>Score Supply :</strong> 90/100 si conditions idÃ©ales, 20/100 si mauvaises</li>
                </ul>

                <h4 style="color: #ff6b6b; margin-top: 20px; margin-bottom: 10px;">ğŸ® IMPACT SUR LE GAMEPLAY</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ¯ <strong>StratÃ©gie Plus Profonde :</strong> Timing d'achat/vente critique</li>
                    <li>ğŸ’ <strong>OpportunitÃ©s :</strong> AchÃ¨te en masse quand stock Ã©levÃ© + prix bas</li>
                    <li>ğŸš€ <strong>Profit Maximum :</strong> Attends la raretÃ© pour vendre cher</li>
                    <li>âš ï¸ <strong>Risques :</strong> Stock peut s'Ã©puiser, achÃ¨te vite les bonnes affaires</li>
                    <li>ğŸŒŠ <strong>Dynamique :</strong> Le marchÃ© ne t'attend pas, il bouge tout seul !</li>
                </ul>

                <h4 style="color: #00d9ff; margin-top: 20px; margin-bottom: 10px;">ğŸ“Š EXEMPLE CONCRET</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ’ <strong>Bitcoin au dÃ©part :</strong> 1200/2000 stock (60%), Prix 100Â¢</li>
                    <li>ğŸ“‰ <strong>Traders virtuels vendent :</strong> 1650/2000 (82%), Prix baisse Ã  75Â¢</li>
                    <li>ğŸ’° <strong>TU achÃ¨tes 100 unitÃ©s :</strong> 1550/2000 (77%), Prix monte Ã  78Â¢</li>
                    <li>â° <strong>Traders achÃ¨tent massivement :</strong> 800/2000 (40%), Prix monte Ã  115Â¢</li>
                    <li>ğŸš€ <strong>TU vends Ã  profit :</strong> Prix 115Â¢ vs achetÃ© 75Â¢ = +53% profit !</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 100, 50, 0.4), rgba(255, 150, 0, 0.3)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ff6432; box-shadow: 0 0 30px rgba(255, 100, 50, 0.4);">
                <h3 style="color: #ff6432; margin-bottom: 10px; font-size: 1.5em;">ğŸš€ Version 5.2 - SMART EXIT System ! âš¡ğŸ’°</h3>
                <p style="color: rgba(255,255,255,0.95); margin-bottom: 15px;"><strong>Date:</strong> Novembre 2024 - TRADES RAPIDES</p>

                <h4 style="color: #00ff41; margin-top: 15px; margin-bottom: 10px;">âš¡ SMART EXIT - SYSTÃˆME DE SORTIE INTELLIGENT</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ¯ <strong>5 Conditions de Sortie Intelligentes :</strong> Le bot vend automatiquement dÃ¨s qu'UNE condition est remplie</li>
                    <li>ğŸ’° <strong>Trades 2-3x Plus Rapides :</strong> Prend les profits plus tÃ´t avec des conditions flexibles</li>
                    <li>ğŸ›¡ï¸ <strong>Protections AmÃ©liorÃ©es :</strong> Lock les gains avant qu'ils redescendent</li>
                </ul>

                <h4 style="color: #ffd700; margin-top: 15px; margin-bottom: 10px;">ğŸ¯ LES 5 CONDITIONS DE VENTE:</h4>
                <ul style="margin-top: 10px;">
                    <li><strong>1ï¸âƒ£ High Sell Score:</strong> Score vente â‰¥ 70/100 + Profit â‰¥ +6%
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Vend quand l'AI dÃ©tecte que c'est le moment optimal</li>
                            <li>MÃªme si pas encore Ã  la target complÃ¨te</li>
                            <li>Exemple: "Smart Exit: High Sell Score (74/100 at +8.2%)"</li>
                        </ul>
                    </li>
                    <li><strong>2ï¸âƒ£ Peak Lock:</strong> Profit atteint +12%+ puis redescend de -2%
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Lock automatiquement les gros profits</li>
                            <li>Ne laisse pas tout le profit s'Ã©vaporer</li>
                            <li>Exemple: "Peak Lock (Peak: +14.3% â†’ Now: +12.1%, -2.2% drop)"</li>
                        </ul>
                    </li>
                    <li><strong>3ï¸âƒ£ Dynamic Targets:</strong> Fourchettes flexibles selon score
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>ğŸ“ˆ <strong>Scalp:</strong> 2-4% (vend Ã  +2% si score â‰¥65, sinon +4%)</li>
                            <li>ğŸ“Š <strong>Swing:</strong> 5-8% (vend Ã  +5% si score â‰¥70, sinon +8%)</li>
                            <li>ğŸ’ <strong>Hold:</strong> 10-15% (vend Ã  +10% si score â‰¥75, sinon +15%)</li>
                            <li>Plus besoin d'attendre 15% si conditions parfaites Ã  10%!</li>
                        </ul>
                    </li>
                    <li><strong>4ï¸âƒ£ Trailing Stop:</strong> -10% depuis prix pic (Protection)
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>InchangÃ© - protÃ¨ge contre les grosses baisses</li>
                        </ul>
                    </li>
                    <li><strong>5ï¸âƒ£ Break-Even Stop:</strong> ProtÃ¨ge si +5% redescend Ã  +1%
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>InchangÃ© - empÃªche de reperdre les gains</li>
                        </ul>
                    </li>
                </ul>

                <h4 style="color: #00d9ff; margin-top: 15px; margin-bottom: 10px;">ğŸ“Š EXEMPLE CONCRET:</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ’¼ <strong>Avant v5.2 (problÃ¨me):</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>AchÃ¨te @ 100Â¢, stratÃ©gie HOLD</li>
                            <li>Prix monte Ã  114Â¢ â†’ +14% profit âŒ Attend 15%</li>
                            <li>Prix baisse Ã  108Â¢ â†’ +8% profit âŒ Toujours attend 15%</li>
                            <li>Frustration: Profit redescend sans vendre!</li>
                        </ul>
                    </li>
                    <li>ğŸš€ <strong>Maintenant v5.2 (solution):</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>AchÃ¨te @ 100Â¢, stratÃ©gie HOLD</li>
                            <li>Prix monte Ã  114Â¢ â†’ +14% profit (Peak Lock activÃ©!)</li>
                            <li>Prix baisse Ã  112Â¢ â†’ +12% profit (-2% drop)</li>
                            <li>âœ… <strong>VEND!</strong> "Peak Lock (Peak: +14.0% â†’ Now: +12.0%, -2.0% drop)"</li>
                            <li>Profit lockÃ©de 12% au lieu de voir redescendre!</li>
                        </ul>
                    </li>
                </ul>

                <h4 style="color: #ff00ff; margin-top: 15px; margin-bottom: 10px;">âš¡ IMPACT:</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸš€ <strong>Trades 2-3x plus rapides:</strong> Scalp Ã  +2-4% au lieu de +3% fixe</li>
                    <li>ğŸ’° <strong>Lock les profits:</strong> Peak Lock empÃªche de tout reperdre</li>
                    <li>ğŸ¯ <strong>Timing optimal:</strong> Vend quand score Ã©levÃ© mÃªme avant target</li>
                    <li>ğŸ“ˆ <strong>Plus de profits:</strong> Profite des pics avant qu'ils redescendent</li>
                    <li>ğŸ˜Š <strong>Plus satisfaisant:</strong> Ne regarde plus un profit de +14% redescendre Ã  +8%</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(75, 0, 130, 0.2)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #8a2be2; box-shadow: 0 0 25px rgba(138, 43, 226, 0.3);">
                <h3 style="color: #8a2be2; margin-bottom: 10px; font-size: 1.4em;">âš¡ Version 5.1 - ANALYST-7 EXPERT & Prix RÃ©ajustÃ©s ! ğŸ§ ğŸ’°</h3>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;"><strong>Date:</strong> Novembre 2024 - RÃ‰Ã‰QUILIBRAGE</p>

                <h4 style="color: #00ff41; margin-top: 15px; margin-bottom: 10px;">ğŸ¤– ANALYST-7 EXPERT - UPGRADE MAJEUR</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ§  <strong>Analyse Technique Professionnelle :</strong> Utilise maintenant RSI, EMA, Bollinger Bands, Momentum</li>
                    <li>ğŸ“Š <strong>IntÃ©gration Supply/Demand :</strong> Combine indicateurs techniques avec niveaux de stock</li>
                    <li>ğŸš¨ <strong>Alertes Critiques Intelligentes :</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>RSI extrÃªmes (< 25 survendu, > 75 surachat) + contexte stock</li>
                            <li>Bollinger Bands breakouts (prix touche bandes)</li>
                            <li>Zones dangereuses (Bollinger supÃ©rieur + RSI Ã©levÃ©)</li>
                        </ul>
                    </li>
                    <li>ğŸ’ <strong>DÃ©tection d'OpportunitÃ©s Majeures :</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Combos parfaits: RSI bas + Stock abondant + Prix sous EMA</li>
                            <li>Moments optimaux de vente: Stock rare + RSI Ã©levÃ© + profit actuel</li>
                        </ul>
                    </li>
                    <li>ğŸ“ˆ <strong>Analyse de Tendances :</strong> Momentum fort, reversals potentiels, confirmations</li>
                    <li>ğŸ’¼ <strong>Conseils Portfolio PersonnalisÃ©s :</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>Analyse profit/perte de tes positions</li>
                            <li>Signaux de prise de profit (profit > 20% + momentum faiblit)</li>
                            <li>Signaux de patience (perte mais reprise probable)</li>
                        </ul>
                    </li>
                    <li>ğŸ¯ <strong>Messages Ultra-DÃ©taillÃ©s :</strong> RSI exact, momentum, % profit, justifications complÃ¨tes</li>
                    <li>ğŸ“Š <strong>Contexte Complet :</strong> Chaque conseil inclut toutes les mÃ©triques pertinentes</li>
                </ul>

                <h4 style="color: #ffd700; margin-top: 15px; margin-bottom: 10px;">ğŸ’° RÃ‰Ã‰QUILIBRAGE DES PRIX</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ¤– <strong>ANALYST-7 EXPERT:</strong> 5,000Â¢ â†’ <strong>10,000Â¢</strong> (Ã—2) - JustifiÃ© par les capacitÃ©s professionnelles</li>
                    <li>ğŸ’¼ <strong>TRADER-X ULTRA:</strong> 15,000Â¢ â†’ <strong>5,000Â¢</strong> (Ã·3) - Plus accessible dÃ¨s le dÃ©but</li>
                    <li>ğŸ¯ <strong>Progression OptimisÃ©e :</strong>
                        <ul style="margin-left: 20px; font-size: 0.95em;">
                            <li>1. TRADER-X (5k) - Automatisation de base</li>
                            <li>2. ANALYST-7 (10k) - Conseils experts</li>
                            <li>3. GUARDIAN (25k) - Protection</li>
                            <li>4. PROPHET (50k) - PrÃ©dictions</li>
                        </ul>
                    </li>
                </ul>

                <h4 style="color: #00d9ff; margin-top: 15px; margin-bottom: 10px;">ğŸ® IMPACT</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ“š ANALYST-7 devient un vrai mentor expert qui t'apprend le trading pro</li>
                    <li>ğŸš€ TRADER-X accessible plus tÃ´t = automatisation rapide</li>
                    <li>ğŸ’¡ Combo TRADER-X + ANALYST-7 = Automatisation + Conseils = Progression optimale</li>
                    <li>ğŸ§  Apprends les stratÃ©gies pro grÃ¢ce aux conseils dÃ©taillÃ©s d'ANALYST-7</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 0, 255, 0.3), rgba(0, 217, 255, 0.2)); padding: 25px; border-radius: 15px; margin-bottom: 20px; border-left: 5px solid #ff00ff; box-shadow: 0 0 30px rgba(255, 0, 255, 0.3);">
                <h3 style="color: #ff00ff; margin-bottom: 10px; font-size: 1.5em;">ğŸš€ Version 4.0 - TRADER-X ULTRA AI ! ğŸ¤–ğŸ”¥</h3>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;"><strong>Date:</strong> Novembre 2024 - MISE Ã€ JOUR MAJEURE</p>

                <h4 style="color: #00ff41; margin-top: 20px; margin-bottom: 10px;">ğŸ§  INDICATEURS TECHNIQUES PROFESSIONNELS</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ“Š <strong>RSI (Relative Strength Index) :</strong> DÃ©tecte les zones de surachat/survente</li>
                    <li>ğŸ“ˆ <strong>EMA (Exponential Moving Average) :</strong> Suit les tendances court/moyen terme</li>
                    <li>ğŸ“‰ <strong>MACD :</strong> DÃ©tecte les changements de momentum</li>
                    <li>ğŸ“Š <strong>Bollinger Bands :</strong> Mesure la volatilitÃ© et les breakouts</li>
                    <li>âš¡ <strong>Momentum :</strong> Force et direction du mouvement de prix</li>
                    <li>ğŸ¯ <strong>Support/Resistance :</strong> Niveaux clÃ©s de prix</li>
                    <li>ğŸ’¹ <strong>Volatility Index :</strong> Calcul de la volatilitÃ© rÃ©elle</li>
                </ul>

                <h4 style="color: #00d9ff; margin-top: 20px; margin-bottom: 10px;">ğŸ¯ SYSTÃˆME DE SCORING MULTI-FACTEURS</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ”¢ <strong>Score 0-100 :</strong> Combine tous les indicateurs avec pondÃ©ration optimale</li>
                    <li>ğŸ’¯ <strong>Confidence Score :</strong> Mesure l'accord entre les signaux</li>
                    <li>ğŸ² <strong>DÃ©cision Intelligente :</strong> Trade uniquement sur signaux forts (70+ score, 60% confidence)</li>
                    <li>ğŸ“ <strong>Messages DÃ©taillÃ©s :</strong> Affiche Score, RSI, Confidence Ã  chaque trade</li>
                </ul>

                <h4 style="color: #ffd700; margin-top: 20px; margin-bottom: 10px;">ğŸ¤– MACHINE LEARNING ADAPTATIF</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ§  <strong>MÃ©morisation :</strong> Garde en mÃ©moire jusqu'Ã  100 trades rÃ©ussis/Ã©chouÃ©s</li>
                    <li>ğŸ“ˆ <strong>Apprentissage :</strong> Ajuste automatiquement les seuils d'achat basÃ©s sur le succÃ¨s</li>
                    <li>ğŸ’ <strong>Performance par Objet :</strong> Track le win rate et profit de chaque item</li>
                    <li>ğŸ¯ <strong>Confidence Dynamique :</strong> Augmente/diminue selon les rÃ©sultats</li>
                    <li>âš™ï¸ <strong>Auto-Optimisation :</strong> Le bot devient meilleur avec le temps !</li>
                </ul>

                <h4 style="color: #0f0; margin-top: 20px; margin-bottom: 10px;">ğŸ’° GESTION DE CAPITAL PROFESSIONNELLE</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ¦ <strong>RÃ©serve de Cash :</strong> Garde toujours 25% en sÃ©curitÃ©</li>
                    <li>ğŸ“Š <strong>Position Sizing :</strong> Taille adaptÃ©e Ã  la confidence (60-100%)</li>
                    <li>ğŸ¯ <strong>Position Max :</strong> Maximum 15% du capital par position</li>
                    <li>âš–ï¸ <strong>Diversification :</strong> RÃ©partit intelligemment sur plusieurs objets</li>
                    <li>ğŸ’¹ <strong>Trade Size :</strong> 1-3 unitÃ©s selon confidence et capital</li>
                </ul>

                <h4 style="color: #f0f; margin-top: 20px; margin-bottom: 10px;">ğŸ›¡ï¸ PROTECTIONS AVANCÃ‰ES</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ“‰ <strong>Trailing Stop :</strong> Vend si baisse de 10% depuis le plus haut</li>
                    <li>âœ… <strong>Break-Even Stop :</strong> ProtÃ¨ge le capital dÃ¨s +5% de profit</li>
                    <li>ğŸ¯ <strong>StratÃ©gies Adaptatives :</strong> Scalp (+3%), Swing (+8%), Hold (+15%)</li>
                    <li>ğŸ² <strong>SÃ©lection Auto :</strong> Choisit la stratÃ©gie selon le score d'achat</li>
                </ul>

                <h4 style="color: #ff00ff; margin-top: 20px; margin-bottom: 10px;">ğŸ“Š DASHBOARD AI COMPLET</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ–¥ï¸ <strong>Bouton "ğŸ¤– AI STATS" :</strong> AccÃ¨s direct aux statistiques</li>
                    <li>ğŸ“ˆ <strong>Performance Globale :</strong> Total trades, Win Rate, Profit, Biggest Win</li>
                    <li>ğŸ§  <strong>Machine Learning Stats :</strong> Seuils adaptatifs, patterns mÃ©morisÃ©s</li>
                    <li>ğŸ’ <strong>Performance par Objet :</strong> Stats dÃ©taillÃ©es pour chaque item</li>
                    <li>âš™ï¸ <strong>Configuration :</strong> Voir tous les paramÃ¨tres de l'AI</li>
                </ul>

                <h4 style="color: #00ff41; margin-top: 20px; margin-bottom: 10px;">ğŸ® EXPÃ‰RIENCE DE JEU</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ¤– Trading 100% automatisÃ© et intelligent</li>
                    <li>ğŸ“Š Transparence totale : tu vois pourquoi l'AI trade</li>
                    <li>ğŸ“ˆ AmÃ©lioration continue grÃ¢ce au machine learning</li>
                    <li>ğŸ† SystÃ¨me de trading niveau professionnel</li>
                    <li>ğŸ’° Maximise les profits tout en protÃ©geant le capital</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 165, 0, 0.3), rgba(255, 215, 0, 0.2)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ffa500; box-shadow: 0 0 20px rgba(255, 165, 0, 0.2);">
                <h3 style="color: #ffa500; margin-bottom: 10px; font-size: 1.3em;">âš¡ Version 4.1 - AI Persistence & Trading IllimitÃ© ! ğŸ§ ğŸ’°</h3>
                <p style="color: rgba(255,255,255,0.9); margin-bottom: 15px;"><strong>Date:</strong> Novembre 2024</p>

                <h4 style="color: #00ff41; margin-top: 15px; margin-bottom: 10px;">ğŸ§  MÃ‰MOIRE AI PERSISTANTE</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ’¾ <strong>Sauvegarde Automatique :</strong> L'AI sauvegarde toutes ses donnÃ©es d'apprentissage</li>
                    <li>ğŸ”„ <strong>Rechargement Intelligent :</strong> Garde en mÃ©moire tous les trades, patterns, et seuils optimaux</li>
                    <li>ğŸ“Š <strong>Stats PrÃ©servÃ©es :</strong> Win rate, profit factor, et performance par objet persistent</li>
                    <li>ğŸ¯ <strong>AmÃ©lioration Continue :</strong> L'AI devient vraiment plus intelligente avec le temps !</li>
                    <li>âœ… <strong>Message de Confirmation :</strong> "SAVE DATA + AI MEMORY LOADED" au chargement</li>
                </ul>

                <h4 style="color: #ffd700; margin-top: 15px; margin-bottom: 10px;">ğŸ’° TRADING SANS LIMITES</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸš€ <strong>Limite de 3 SupprimÃ©e :</strong> L'AI peut maintenant acheter autant qu'elle veut !</li>
                    <li>ğŸ“Š <strong>Position Sizing Intelligent :</strong> QuantitÃ© basÃ©e sur 15% du capital Ã— confidence</li>
                    <li>ğŸ’ <strong>Exemple :</strong> Si 10,000Â¢ capital + 85% confidence â†’ peut acheter 25+ unitÃ©s (au lieu de max 3)</li>
                    <li>âš–ï¸ <strong>Gestion de Risque :</strong> Toujours 25% de rÃ©serve + 15% max par position</li>
                    <li>ğŸ¯ <strong>Meilleure Utilisation du Capital :</strong> Profits maximisÃ©s sur les signaux forts</li>
                </ul>

                <h4 style="color: #00d9ff; margin-top: 15px; margin-bottom: 10px;">ğŸ® IMPACT</h4>
                <ul style="margin-top: 10px;">
                    <li>ğŸ§  Plus besoin de recommencer l'apprentissage Ã  chaque session</li>
                    <li>ğŸ’° Trading beaucoup plus agressif quand les conditions sont favorables</li>
                    <li>ğŸ“ˆ Profits exponentiels avec les grandes positions sur les bons signaux</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 255, 65, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00d9ff;">
                <h3 style="color: #00d9ff; margin-bottom: 10px;">Version 3.1 - TRADER-X Plus Actif ! âš¡</h3>
                <p style="color: rgba(255,255,255,0.8);"><strong>Date:</strong> Novembre 2024</p>
                <ul style="margin-top: 15px;">
                    <li>ğŸ”¥ <strong>TRADER-X OptimisÃ© :</strong> Maintenant achÃ¨te Ã  <strong>-5%</strong> (au lieu de -10%)</li>
                    <li>ğŸ’° <strong>Vente Plus Rapide :</strong> Vend <strong>dÃ¨s que c'est rentable</strong> (au lieu d'attendre +15%)</li>
                    <li>âš¡ <strong>Trading AccÃ©lÃ©rÃ© :</strong> Beaucoup plus de trades pour maximiser les profits !</li>
                    <li>ğŸ“ˆ <strong>ExpÃ©rience AmÃ©liorÃ©e :</strong> GÃ©nÃ¨re des profits plus rapidement</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 255, 65, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00d9ff;">
                <h3 style="color: #00d9ff; margin-bottom: 10px;">Version 3.0 - TOUS LES AGENTS OPÃ‰RATIONNELS ! ğŸ”¥ğŸ¤–</h3>
                <p style="color: rgba(255,255,255,0.8);"><strong>Date:</strong> Novembre 2024</p>
                <ul style="margin-top: 15px;">
                    <li>ğŸ‰ <strong>4 AGENTS COMPLETS :</strong> ANALYST-7, TRADER-X, GUARDIAN et PROPHET tous fonctionnels !</li>
                    <li>ğŸ¤– <strong>ANALYST-7 :</strong> Conseils et alertes sur les mouvements de marchÃ© importants</li>
                    <li>ğŸ’¼ <strong>TRADER-X :</strong> Auto-trading intelligent</li>
                    <li>ğŸ›¡ï¸ <strong>GUARDIAN :</strong> Stop-loss automatique Ã  -20% pour protÃ©ger ton capital</li>
                    <li>ğŸ”® <strong>PROPHET :</strong> PrÃ©dictions basÃ©es sur l'analyse des tendances</li>
                    <li>âš¡ <strong>Trading AutomatisÃ© :</strong> Laisse les agents travailler pour toi 24/7 !</li>
                    <li>ğŸ“° <strong>Fil d'ActualitÃ©s Enrichi :</strong> Vois toutes les actions des agents en temps rÃ©el</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 255, 65, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00d9ff;">
                <h3 style="color: #00d9ff; margin-bottom: 10px;">Version 2.1 - Mise Ã  Jour QoL ğŸ‰</h3>
                <p style="color: rgba(255,255,255,0.8);"><strong>Date:</strong> Novembre 2024</p>
                <ul style="margin-top: 15px;">
                    <li>âœ… <strong>Fix Zoom Mobile :</strong> Plus de zoom intempestif sur les clics rapides</li>
                    <li>âœ… <strong>Fix Bug QuantitÃ© :</strong> Les quantitÃ©s d'achat restent maintenant lors des fluctuations de prix</li>
                    <li>ğŸ“– <strong>Tutoriel Complet :</strong> Nouveau tutoriel dÃ©taillÃ© en franÃ§ais avec toutes les mÃ©caniques</li>
                    <li>ğŸ“ <strong>Changelog :</strong> Tu peux maintenant voir l'historique des mises Ã  jour !</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 255, 65, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00d9ff;">
                <h3 style="color: #00d9ff; margin-bottom: 10px;">Version 2.0 - Lancement Initial ğŸš€</h3>
                <p style="color: rgba(255,255,255,0.8);"><strong>Date:</strong> Novembre 2024</p>
                <ul style="margin-top: 15px;">
                    <li>ğŸ® <strong>SystÃ¨me de Trading :</strong> 8 objets interdimensionnels Ã  trader</li>
                    <li>ğŸ’ <strong>SystÃ¨me de RaretÃ© :</strong> Commun, Rare, LÃ©gendaire, Mythique</li>
                    <li>ğŸ“Š <strong>Portfolio Dynamique :</strong> Suivi en temps rÃ©el des profits/pertes</li>
                    <li>ğŸ¤– <strong>4 Agents :</strong> ANALYST-7, TRADER-X, GUARDIAN, PROPHET</li>
                    <li>âœ¨ <strong>SystÃ¨me de Prestige :</strong> Sauts dimensionnels avec Essence Cosmique</li>
                    <li>ğŸ“ˆ <strong>MarchÃ© Volatil :</strong> Prix fluctuent toutes les 5 secondes</li>
                    <li>ğŸ’¾ <strong>Sauvegarde Auto :</strong> Progression sauvegardÃ©e toutes les 10 secondes</li>
                    <li>ğŸ¨ <strong>Design Cyberpunk :</strong> Interface futuriste avec effets CRT</li>
                    <li>ğŸ“± <strong>Mobile Friendly :</strong> OptimisÃ© pour mobile et tablette</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 0, 255, 0.2), rgba(186, 85, 211, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ff00ff;">
                <h3 style="color: #ff00ff; margin-bottom: 10px;">Objets Disponibles ğŸ’</h3>
                <ul style="margin-top: 15px;">
                    <li>ğŸ’¾ <strong>Quantum Chip</strong> (Commun) - Prix de base: 100Â¢</li>
                    <li>âš¡ <strong>Plasma Cell</strong> (Commun) - Prix de base: 150Â¢</li>
                    <li>ğŸ’ <strong>Crystal Core</strong> (Rare) - Prix de base: 500Â¢</li>
                    <li>ğŸ§¬ <strong>Nano Fabric</strong> (Rare) - Prix de base: 400Â¢</li>
                    <li>ğŸŒŒ <strong>Void Essence</strong> (LÃ©gendaire) - Prix de base: 2 000Â¢</li>
                    <li>â³ <strong>Time Shard</strong> (LÃ©gendaire) - Prix de base: 3 000Â¢</li>
                    <li>ğŸ’  <strong>Infinity Stone</strong> (Mythique) - Prix de base: 10 000Â¢</li>
                    <li>âš›ï¸ <strong>God Particle</strong> (Mythique) - Prix de base: 15 000Â¢</li>
                </ul>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffd700; margin-bottom: 10px;">FonctionnalitÃ©s Futures ğŸ”®</h3>
                <ul style="margin-top: 15px;">
                    <li>ğŸŒ Nouveaux univers Ã  dÃ©bloquer</li>
                    <li>âš”ï¸ Mode compÃ©titif contre d'autres traders</li>
                    <li>ğŸ† SystÃ¨me d'achievements avancÃ©s</li>
                    <li>ğŸ“ˆ Graphiques de tendance dÃ©taillÃ©s</li>
                    <li>ğŸ¯ Missions quotidiennes</li>
                    <li>ğŸ’¼ StratÃ©gies d'investissement prÃ©-dÃ©finies</li>
                    <li>ğŸ”” Alertes de prix personnalisables</li>
                </ul>
            </div>

            <div class="modal-buttons">
                <button class="btn" onclick="closeChangelog()" style="background: rgba(0, 217, 255, 0.3); border: 2px solid #00d9ff;">FERMER</button>
            </div>
        </div>
    </div>

    <!-- AI Stats Modal -->
    <div id="aiStatsModal" class="modal">
        <div class="modal-content">
            <h1>ğŸ¤– TRADER-X ULTRA - AI STATISTICS</h1>

            <div style="background: linear-gradient(135deg, rgba(255, 0, 255, 0.2), rgba(0, 217, 255, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ff00ff;">
                <h3 style="color: #ff00ff; margin-bottom: 15px;">ğŸ“Š Performance Globale</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Total Trades</div>
                        <div style="color: #00ff41; font-size: 1.8em; font-weight: bold;" id="aiTotalTrades">0</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Win Rate</div>
                        <div style="color: #00d9ff; font-size: 1.8em; font-weight: bold;" id="aiWinRate">0%</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">AI Profit</div>
                        <div style="color: #ffd700; font-size: 1.8em; font-weight: bold;" id="aiTotalProfit">0Â¢</div>
                    </div>
                    <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 10px;">
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.9em;">Biggest Win</div>
                        <div style="color: #0f0; font-size: 1.8em; font-weight: bold;" id="aiBiggestWin">0Â¢</div>
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 255, 65, 0.2), rgba(0, 217, 255, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00ff41;">
                <h3 style="color: #00ff41; margin-bottom: 15px;">ğŸ§  Machine Learning</h3>
                <div style="margin-bottom: 15px;">
                    <div style="color: rgba(255,255,255,0.8); margin-bottom: 5px;">Seuil d'Achat Adaptatif:</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                        <span style="color: #00ff41; font-size: 1.3em; font-weight: bold;" id="aiBuyThreshold">70</span>/100
                        <span style="color: rgba(255,255,255,0.6); font-size: 0.9em; margin-left: 10px;">(s'ajuste automatiquement)</span>
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <div style="color: rgba(255,255,255,0.8); margin-bottom: 5px;">Trades RÃ©ussis MÃ©morisÃ©s:</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                        <span style="color: #0f0; font-size: 1.2em;" id="aiSuccessMemory">0</span> patterns gagnants
                    </div>
                </div>
                <div>
                    <div style="color: rgba(255,255,255,0.8); margin-bottom: 5px;">Trades Ã‰chouÃ©s MÃ©morisÃ©s:</div>
                    <div style="background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;">
                        <span style="color: #f00; font-size: 1.2em;" id="aiFailMemory">0</span> patterns Ã  Ã©viter
                    </div>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.2), rgba(0, 255, 65, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #00d9ff;">
                <h3 style="color: #00d9ff; margin-bottom: 15px;">ğŸ’ Performance par Objet</h3>
                <div id="aiItemPerformance" style="max-height: 300px; overflow-y: auto;"></div>
            </div>

            <div style="background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 165, 0, 0.1)); padding: 20px; border-radius: 15px; margin-bottom: 20px; border-left: 4px solid #ffd700;">
                <h3 style="color: #ffd700; margin-bottom: 15px;">âš™ï¸ Configuration AI</h3>
                <ul style="color: rgba(255,255,255,0.9); line-height: 1.8;">
                    <li>ğŸ’° <strong>Reserve de Cash:</strong> 25% gardÃ© en sÃ©curitÃ©</li>
                    <li>ğŸ“Š <strong>Position Max:</strong> 15% du capital par position</li>
                    <li>ğŸ¯ <strong>Position Sizing:</strong> AdaptÃ© Ã  la confiance (60-100%)</li>
                    <li>ğŸ›¡ï¸ <strong>Trailing Stop:</strong> -10% depuis le plus haut</li>
                    <li>âœ… <strong>Break-Even Stop:</strong> ProtÃ¨ge Ã  +5%</li>
                    <li>ğŸ“ˆ <strong>StratÃ©gies:</strong> Scalp (+3%), Swing (+8%), Hold (+15%)</li>
                    <li>ğŸ§  <strong>Indicateurs:</strong> RSI, EMA, MACD, Bollinger, Momentum, Support/Resistance</li>
                </ul>
            </div>

            <div class="modal-buttons">
                <button class="btn" onclick="closeAIStats()" style="background: linear-gradient(135deg, #ff00ff, #00d9ff); border: 2px solid #ff00ff;">FERMER</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const game = {
            money: 10000,
            portfolio: {},
            portfolioDetails: {},
            totalProfit: 0,
            totalTrades: 0,
            dimension: 1,
            essence: 0,
            botEnabled: true, // Toggle for TRADER-X auto-trading
            agents: {
                analyst: false,
                trader: false,
                guardian: false,
                prophet: false
            }
        };

        // Items Database
        const items = [
            { id: 'quantum_chip', name: 'Quantum Chip', rarity: 'common', basePrice: 100, volatility: 0.15, icon: 'ğŸ’¾', stockMax: 2000 },
            { id: 'plasma_cell', name: 'Plasma Cell', rarity: 'common', basePrice: 150, volatility: 0.18, icon: 'âš¡', stockMax: 1800 },
            { id: 'crystal_core', name: 'Crystal Core', rarity: 'rare', basePrice: 500, volatility: 0.25, icon: 'ğŸ’', stockMax: 1200 },
            { id: 'nano_fabric', name: 'Nano Fabric', rarity: 'rare', basePrice: 400, volatility: 0.22, icon: 'ğŸ§¬', stockMax: 1400 },
            { id: 'void_essence', name: 'Void Essence', rarity: 'legendary', basePrice: 2000, volatility: 0.35, icon: 'ğŸŒŒ', stockMax: 600 },
            { id: 'time_shard', name: 'Time Shard', rarity: 'legendary', basePrice: 3000, volatility: 0.40, icon: 'â³', stockMax: 500 },
            { id: 'infinity_stone', name: 'Infinity Stone', rarity: 'mythic', basePrice: 10000, volatility: 0.50, icon: 'ğŸ’ ', stockMax: 200 },
            { id: 'god_particle', name: 'God Particle', rarity: 'mythic', basePrice: 15000, volatility: 0.55, icon: 'âš›ï¸', stockMax: 150 }
        ];

        const marketPrices = {};
        const priceHistory = {};

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“Š SUPPLY & DEMAND SYSTEM (Offre & Demande)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const marketSupply = {};

        // Initialize stock levels (start at 50-70% of max)
        items.forEach(item => {
            const initialStockPercent = 0.5 + (Math.random() * 0.2); // 50-70%
            marketSupply[item.id] = {
                available: Math.floor(item.stockMax * initialStockPercent),
                max: item.stockMax,
                virtualTradeVolume: 0 // Track virtual trader activity
            };
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ¤– ULTRA ADVANCED AI TRADING SYSTEM v4.0
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        const tradingAI = {
            // Trading statistics
            stats: {
                totalBuys: 0,
                totalSells: 0,
                wins: 0,
                losses: 0,
                biggestWin: 0,
                biggestLoss: 0,
                winRate: 0,
                profitFactor: 0,
                totalProfitFromAI: 0,
                bestItem: null,
                worstItem: null,
                sharpeRatio: 0
            },

            // Machine Learning - remembers and learns
            learning: {
                itemPerformance: {}, // Tracks profit per item
                successfulBuyScores: [], // Scores that led to profits
                failedBuyScores: [], // Scores that led to losses
                optimalThresholds: { // Adaptive thresholds
                    buyScore: 70,
                    sellScore: 60,
                    riskTolerance: 0.1
                },
                patterns: {} // Recognized profitable patterns
            },

            // Position management with trailing stops
            positions: {}, // { itemId: { entry, quantity, highestPrice, stopLoss, takeProfit, strategy } }

            // Market sentiment analysis
            sentiment: {
                overall: 'neutral',
                itemSentiment: {},
                volatilityIndex: 0
            },

            // Capital management
            capital: {
                reservePercent: 0.25, // Keep 25% in cash
                maxPositionSize: 0.15, // Max 15% per position
                maxDrawdown: 0.20 // Max 20% total loss
            }
        };

        // Initialize AI data for each item
        items.forEach(item => {
            tradingAI.learning.itemPerformance[item.id] = {
                trades: 0,
                wins: 0,
                totalProfit: 0,
                avgHoldTime: 0,
                bestStrategy: 'swing',
                confidence: 0.5
            };
            tradingAI.sentiment.itemSentiment[item.id] = 'neutral';
            tradingAI.learning.patterns[item.id] = {
                support: item.basePrice * 0.5,
                resistance: item.basePrice * 1.5,
                trendDirection: 'neutral'
            };
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“Š TECHNICAL INDICATORS - Professional Trading Tools
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Calculate RSI (Relative Strength Index)
        function calculateRSI(itemId, period = 14) {
            const history = priceHistory[itemId];
            if (history.length < period + 1) return 50; // Neutral if not enough data

            let gains = 0, losses = 0;

            for (let i = history.length - period; i < history.length; i++) {
                const change = history[i] - history[i - 1];
                if (change > 0) gains += change;
                else losses += Math.abs(change);
            }

            const avgGain = gains / period;
            const avgLoss = losses / period;

            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        }

        // Calculate EMA (Exponential Moving Average)
        function calculateEMA(itemId, period = 12) {
            const history = priceHistory[itemId];
            if (history.length < period) return history[history.length - 1];

            const multiplier = 2 / (period + 1);
            let ema = history[history.length - period];

            for (let i = history.length - period + 1; i < history.length; i++) {
                ema = (history[i] - ema) * multiplier + ema;
            }

            return ema;
        }

        // Calculate MACD (Moving Average Convergence Divergence)
        function calculateMACD(itemId) {
            const ema12 = calculateEMA(itemId, 12);
            const ema26 = calculateEMA(itemId, 26);
            const macdLine = ema12 - ema26;

            // Simplified signal line (would need more history for true MACD)
            const signal = macdLine * 0.9; // Approximation

            return {
                macd: macdLine,
                signal: signal,
                histogram: macdLine - signal,
                trend: macdLine > signal ? 'bullish' : 'bearish'
            };
        }

        // Calculate Bollinger Bands
        function calculateBollingerBands(itemId, period = 20, stdDev = 2) {
            const history = priceHistory[itemId];
            if (history.length < period) {
                const current = history[history.length - 1];
                return { upper: current * 1.1, middle: current, lower: current * 0.9 };
            }

            const slice = history.slice(-period);
            const sma = slice.reduce((a, b) => a + b, 0) / period;

            const variance = slice.reduce((sum, price) => {
                return sum + Math.pow(price - sma, 2);
            }, 0) / period;

            const std = Math.sqrt(variance);

            return {
                upper: sma + (std * stdDev),
                middle: sma,
                lower: sma - (std * stdDev)
            };
        }

        // Calculate momentum
        function calculateMomentum(itemId, period = 10) {
            const history = priceHistory[itemId];
            if (history.length < period + 1) return 0;

            const current = history[history.length - 1];
            const past = history[history.length - period - 1];

            return ((current - past) / past) * 100;
        }

        // Calculate volatility
        function calculateVolatility(itemId, period = 20) {
            const history = priceHistory[itemId];
            if (history.length < period) return 0;

            const slice = history.slice(-period);
            const returns = [];

            for (let i = 1; i < slice.length; i++) {
                returns.push((slice[i] - slice[i-1]) / slice[i-1]);
            }

            const mean = returns.reduce((a, b) => a + b, 0) / returns.length;
            const variance = returns.reduce((sum, r) => sum + Math.pow(r - mean, 2), 0) / returns.length;

            return Math.sqrt(variance) * 100;
        }

        // Detect support and resistance levels
        function detectSupportResistance(itemId) {
            const history = priceHistory[itemId];
            if (history.length < 20) return { support: history[0] * 0.9, resistance: history[0] * 1.1 };

            const sorted = [...history].sort((a, b) => a - b);
            const support = sorted[Math.floor(sorted.length * 0.1)]; // 10th percentile
            const resistance = sorted[Math.floor(sorted.length * 0.9)]; // 90th percentile

            return { support, resistance };
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ§  AI SCORING SYSTEM - Multi-Factor Analysis
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function calculateTradingScore(itemId, action = 'buy') {
            const price = marketPrices[itemId];
            const history = priceHistory[itemId];
            const item = items.find(i => i.id === itemId);

            if (history.length < 5) return { score: 50, confidence: 0.3, signals: {} };

            // Calculate all indicators
            const rsi = calculateRSI(itemId);
            const ema12 = calculateEMA(itemId, 12);
            const ema26 = calculateEMA(itemId, 26);
            const macd = calculateMACD(itemId);
            const bb = calculateBollingerBands(itemId);
            const momentum = calculateMomentum(itemId);
            const volatility = calculateVolatility(itemId);
            const { support, resistance } = detectSupportResistance(itemId);

            // Supply/Demand Analysis
            const supply = marketSupply[itemId];
            const scarcityRatio = supply.available / supply.max;
            const scarcityMultiplier = getScarcityMultiplier(itemId);

            // Score components (0-100 each)
            let scores = {};

            if (action === 'buy') {
                // RSI Score: Oversold is good for buying
                scores.rsi = rsi < 30 ? 100 : rsi < 40 ? 80 : rsi < 50 ? 60 : 100 - rsi;

                // EMA Score: Price below EMA is good for buying
                scores.ema = price < ema12 ? 80 : price < ema26 ? 60 : 40;

                // MACD Score: Bullish divergence
                scores.macd = macd.trend === 'bullish' && macd.histogram > 0 ? 80 : 50;

                // Bollinger Score: Near lower band is good
                const bbPosition = (price - bb.lower) / (bb.upper - bb.lower);
                scores.bollinger = bbPosition < 0.2 ? 100 : bbPosition < 0.4 ? 70 : 50;

                // Momentum Score: Negative momentum creating opportunity
                scores.momentum = momentum < -10 ? 90 : momentum < 0 ? 70 : 40;

                // Support Score: Near support is good
                const distanceFromSupport = ((price - support) / support) * 100;
                scores.support = distanceFromSupport < 5 ? 90 : distanceFromSupport < 10 ? 70 : 50;

                // Volatility Score: Higher volatility = more opportunity
                scores.volatility = Math.min(100, volatility * 2);

                // Supply Score: High stock (abundant) is good for buying (cheaper)
                // Low stock (rare) is bad for buying (expensive)
                scores.supply = scarcityRatio > 0.7 ? 90 :   // Abundant = good to buy
                                scarcityRatio > 0.5 ? 70 :   // Medium
                                scarcityRatio > 0.3 ? 40 :   // Getting scarce
                                20;                           // Very rare = expensive

            } else { // sell
                // RSI Score: Overbought is good for selling
                scores.rsi = rsi > 70 ? 100 : rsi > 60 ? 80 : rsi;

                // EMA Score: Price above EMA is good for selling
                scores.ema = price > ema12 ? 80 : price > ema26 ? 60 : 40;

                // MACD Score: Bearish divergence
                scores.macd = macd.trend === 'bearish' && macd.histogram < 0 ? 80 : 50;

                // Bollinger Score: Near upper band is good
                const bbPosition = (price - bb.lower) / (bb.upper - bb.lower);
                scores.bollinger = bbPosition > 0.8 ? 100 : bbPosition > 0.6 ? 70 : 50;

                // Momentum Score: Positive momentum to ride
                scores.momentum = momentum > 10 ? 90 : momentum > 0 ? 70 : 40;

                // Resistance Score: Near resistance is good to sell
                const distanceFromResistance = ((resistance - price) / resistance) * 100;
                scores.resistance = distanceFromResistance < 5 ? 90 : distanceFromResistance < 10 ? 70 : 50;

                // Volatility Score: Lower volatility = safer exit
                scores.volatility = Math.max(0, 100 - volatility * 2);

                // Supply Score: Low stock (rare) is good for selling (higher price)
                // High stock (abundant) is bad for selling (lower price)
                scores.supply = scarcityRatio < 0.3 ? 90 :   // Very rare = high price to sell
                                scarcityRatio < 0.5 ? 70 :   // Medium
                                scarcityRatio < 0.7 ? 40 :   // Getting abundant
                                20;                           // Too abundant = low price
            }

            // Calculate weighted average score
            const weights = {
                rsi: 0.18,
                ema: 0.13,
                macd: 0.13,
                bollinger: 0.13,
                momentum: 0.13,
                support: action === 'buy' ? 0.08 : 0,
                resistance: action === 'sell' ? 0.08 : 0,
                volatility: 0.08,
                supply: 0.14  // Supply/Demand is important!
            };

            let totalScore = 0;
            let totalWeight = 0;

            for (const [key, score] of Object.entries(scores)) {
                if (weights[key]) {
                    totalScore += score * weights[key];
                    totalWeight += weights[key];
                }
            }

            const finalScore = totalScore / totalWeight;

            // Calculate confidence based on signal agreement
            const signalAgreement = Object.values(scores).filter(s => s > 60).length / Object.keys(scores).length;
            const confidence = signalAgreement;

            // Get AI learning adjustment
            const perfData = tradingAI.learning.itemPerformance[itemId];
            const learningBonus = perfData.confidence * 10; // +0-10 points based on past success

            return {
                score: Math.min(100, finalScore + learningBonus),
                confidence: confidence,
                signals: scores,
                indicators: { rsi, ema12, ema26, macd, bb, momentum, volatility, support, resistance, scarcityRatio, scarcityMultiplier }
            };
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ“Š SUPPLY & DEMAND PRICING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Calculate price multiplier based on scarcity
        function getScarcityMultiplier(itemId) {
            const supply = marketSupply[itemId];
            const scarcityRatio = supply.available / supply.max;

            // Price increases when stock is low, decreases when stock is high
            // scarcityRatio: 0.1 (10% stock) â†’ multiplier: ~2.5x (trÃ¨s cher)
            // scarcityRatio: 0.5 (50% stock) â†’ multiplier: 1.0x (normal)
            // scarcityRatio: 0.9 (90% stock) â†’ multiplier: ~0.6x (pas cher)

            const multiplier = Math.pow(2 - scarcityRatio, 1.5) * 0.8;
            return Math.max(0.4, Math.min(3, multiplier)); // Clamp between 0.4x and 3x
        }

        // Get rarity indicator for UI
        function getRarityIndicator(itemId) {
            const supply = marketSupply[itemId];
            const scarcityRatio = supply.available / supply.max;

            if (scarcityRatio < 0.3) return 'ğŸ”´ RARE';
            if (scarcityRatio < 0.7) return 'ğŸŸ¡ MOYEN';
            return 'ğŸŸ¢ ABONDANT';
        }

        // Initialize market
        function initMarket() {
            items.forEach(item => {
                // Calculate base price with initial scarcity
                const baseFluctuation = (1 + (Math.random() - 0.5) * item.volatility);
                const scarcityMult = getScarcityMultiplier(item.id);
                marketPrices[item.id] = Math.round(item.basePrice * baseFluctuation * scarcityMult);
                priceHistory[item.id] = [marketPrices[item.id]];
            });
        }

        // Fluctuate prices (with supply/demand impact)
        function fluctuatePrices() {
            items.forEach(item => {
                // Base volatility fluctuation
                const change = (Math.random() - 0.45) * item.volatility; // Slight upward bias
                const basePrice = item.basePrice * (1 + change);

                // Apply scarcity multiplier
                const scarcityMult = getScarcityMultiplier(item.id);
                let newPrice = Math.round(basePrice * scarcityMult);

                // Clamp to reasonable bounds
                const minPrice = Math.round(item.basePrice * 0.3);
                const maxPrice = Math.round(item.basePrice * 5); // Increased max for scarcity spikes
                newPrice = Math.max(minPrice, Math.min(maxPrice, newPrice));

                marketPrices[item.id] = newPrice;
                priceHistory[item.id].push(newPrice);

                // Keep only last 50 price points
                if (priceHistory[item.id].length > 50) {
                    priceHistory[item.id].shift();
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ¤– VIRTUAL TRADERS (Market Simulation)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function simulateVirtualTraders() {
            items.forEach(item => {
                const supply = marketSupply[item.id];
                const scarcityRatio = supply.available / supply.max;

                // Calculate trading pressure based on scarcity and volatility
                // Low stock â†’ more buying pressure
                // High stock â†’ more selling pressure
                const buyPressure = (1 - scarcityRatio) * item.volatility * 3; // x3 multiplier for MAXIMUM activity
                const sellPressure = scarcityRatio * item.volatility * 3;

                // LOTS of virtual traders! (0-25 per cycle)
                const numTraders = Math.floor(Math.random() * 26);

                for (let i = 0; i < numTraders; i++) {
                    const tradeProbability = Math.random();

                    if (tradeProbability < buyPressure && supply.available > 10) {
                        // Virtual trader BUYS (removes from available stock)
                        const buyQty = Math.floor(10 + Math.random() * 20); // 10-30 units for MORE movement
                        const actualBuy = Math.min(buyQty, supply.available);
                        supply.available -= actualBuy;
                        supply.virtualTradeVolume += actualBuy;
                    } else if (tradeProbability > (1 - sellPressure) && supply.available < supply.max) {
                        // Virtual trader SELLS (adds to available stock)
                        const sellQty = Math.floor(10 + Math.random() * 20); // 10-30 units for MORE movement
                        const actualSell = Math.min(sellQty, supply.max - supply.available);
                        supply.available += actualSell;
                        supply.virtualTradeVolume += actualSell;
                    }
                }

                // Clamp stock to valid range
                supply.available = Math.max(10, Math.min(supply.max, supply.available));
            });

            // DEBUG: Log virtual trader activity occasionally
            if (Math.random() < 0.05) { // 5% of the time
                const sampleItem = items[0];
                const sampleSupply = marketSupply[sampleItem.id];
                console.log(`ğŸ¤– Virtual Traders: ${sampleItem.name} stock ${sampleSupply.available}/${sampleSupply.max} (${(sampleSupply.available/sampleSupply.max*100).toFixed(0)}%)`);
            }
        }

        // Buy item
        function buyItem(itemId, quantity) {
            const item = items.find(i => i.id === itemId);
            const price = marketPrices[itemId];
            const supply = marketSupply[itemId];
            const totalCost = price * quantity;

            if (game.money < totalCost) {
                addNews(`> ERROR: Insufficient funds for ${item.name}`, 'error');
                return;
            }

            // Check if enough stock available
            if (supply.available < quantity) {
                addNews(`> ERROR: Only ${supply.available} ${item.name} available in market! ${getRarityIndicator(itemId)}`, 'error');
                return;
            }

            game.money -= totalCost;

            // Remove from market supply (increases scarcity â†’ price will rise)
            supply.available -= quantity;

            // Track purchase
            if (!game.portfolioDetails[itemId]) {
                game.portfolioDetails[itemId] = {
                    totalSpent: 0,
                    totalQuantity: 0
                };
            }

            game.portfolioDetails[itemId].totalSpent += totalCost;
            game.portfolioDetails[itemId].totalQuantity += quantity;

            game.portfolio[itemId] = (game.portfolio[itemId] || 0) + quantity;
            game.totalTrades += quantity;

            addNews(`> BOUGHT: ${quantity}x ${item.icon} ${item.name} @ ${price}Â¢`, 'success');
            updateUI();
        }

        // Sell item
        function sellItem(itemId, quantity) {
            const item = items.find(i => i.id === itemId);
            const price = marketPrices[itemId];
            const supply = marketSupply[itemId];

            if (!game.portfolio[itemId] || game.portfolio[itemId] < quantity) {
                addNews(`> ERROR: Insufficient ${item.name} in portfolio`, 'error');
                return;
            }

            const totalRevenue = price * quantity;

            // Add to market supply (decreases scarcity â†’ price will fall)
            supply.available = Math.min(supply.max, supply.available + quantity);

            // Calculate profit
            let profit = 0;
            if (game.portfolioDetails[itemId]) {
                const avgBuyPrice = game.portfolioDetails[itemId].totalSpent / game.portfolioDetails[itemId].totalQuantity;
                const costOfSold = avgBuyPrice * quantity;
                profit = totalRevenue - costOfSold;

                // Update details
                game.portfolioDetails[itemId].totalSpent -= costOfSold;
                game.portfolioDetails[itemId].totalQuantity -= quantity;

                if (game.portfolioDetails[itemId].totalQuantity <= 0) {
                    delete game.portfolioDetails[itemId];
                }
            }

            game.money += totalRevenue;
            game.portfolio[itemId] -= quantity;
            game.totalProfit += profit;
            game.totalTrades += quantity;

            if (game.portfolio[itemId] === 0) {
                delete game.portfolio[itemId];
            }

            const profitText = profit >= 0 ? `+${Math.round(profit)}Â¢` : `${Math.round(profit)}Â¢`;
            addNews(`> SOLD: ${quantity}x ${item.icon} ${item.name} @ ${price}Â¢ (${profitText})`, profit >= 0 ? 'success' : 'error');
            updateUI();
        }

        // Add news
        let newsCounter = 0;
        function addNews(message, type = '') {
            const newsDiv = document.getElementById('news');
            const newsItem = document.createElement('div');
            newsItem.className = `news-item ${type}`;
            newsItem.textContent = message;
            newsDiv.insertBefore(newsItem, newsDiv.firstChild);

            newsCounter++;
            if (newsCounter > 15) {
                newsDiv.removeChild(newsDiv.lastChild);
            }
        }

        // Render market
        function renderMarket() {
            const marketDiv = document.getElementById('market');

            // Save current input values before re-rendering
            const savedQuantities = {};
            items.forEach(item => {
                const input = document.getElementById(`qty-${item.id}`);
                if (input) {
                    savedQuantities[item.id] = input.value;
                }
            });

            marketDiv.innerHTML = '';

            items.forEach(item => {
                const price = marketPrices[item.id];
                const owned = game.portfolio[item.id] || 0;
                const supply = marketSupply[item.id];

                // Calculate price change
                const history = priceHistory[item.id];
                const priceChange = history.length > 1 ? ((price - history[history.length - 2]) / history[history.length - 2] * 100) : 0;
                const changeClass = priceChange >= 0 ? 'price-up' : 'price-down';
                const changeSign = priceChange >= 0 ? '+' : '';

                // Stock information
                const stockPercent = (supply.available / supply.max * 100);
                const rarityIndicator = getRarityIndicator(item.id);
                const stockBarWidth = Math.max(5, stockPercent); // Minimum 5% for visibility

                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-card';

                // Restore saved quantity or use default
                const savedQty = savedQuantities[item.id] || '1';

                itemDiv.innerHTML = `
                    <div class="item-header">
                        <span class="item-name">${item.icon} ${item.name}</span>
                        <span class="rarity rarity-${item.rarity}">${item.rarity}</span>
                    </div>
                    <div class="item-price">
                        <span class="price-current">${price} Â¢</span>
                        <span class="price-change ${changeClass}">${changeSign}${priceChange.toFixed(1)}%</span>
                    </div>
                    <div style="margin: 10px 0; font-size: 0.85em;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <span style="color: rgba(255,255,255,0.7);">ğŸ“¦ Stock: ${supply.available}/${supply.max}</span>
                            <span style="font-weight: bold;">${rarityIndicator}</span>
                        </div>
                        <div style="background: rgba(0,0,0,0.5); height: 8px; border-radius: 4px; overflow: hidden; border: 1px solid rgba(255,255,255,0.2);">
                            <div style="width: ${stockBarWidth}%; height: 100%; background: linear-gradient(90deg,
                                ${stockPercent < 30 ? '#ff0000, #ff6666' :
                                  stockPercent < 70 ? '#ffaa00, #ffdd00' :
                                  '#00ff41, #00ff88'}); transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    ${owned > 0 ? `<div style="color: #00d9ff; margin-bottom: 10px;">ğŸ’¼ Owned: ${owned}</div>` : ''}
                    <div class="item-actions">
                        <input type="number" class="quantity-input" id="qty-${item.id}" value="${savedQty}" min="1" max="${supply.available}">
                        <button class="btn-buy" onclick="buyItem('${item.id}', parseInt(document.getElementById('qty-${item.id}').value))">
                            BUY
                        </button>
                        <button class="btn-sell" onclick="sellItem('${item.id}', parseInt(document.getElementById('qty-${item.id}').value))" ${owned === 0 ? 'disabled' : ''}>
                            SELL
                        </button>
                    </div>
                `;
                marketDiv.appendChild(itemDiv);
            });
        }

        // Render portfolio
        function renderPortfolio() {
            const portfolioDiv = document.getElementById('portfolio');

            if (Object.keys(game.portfolio).length === 0) {
                portfolioDiv.innerHTML = '<div class="portfolio-empty">[ PORTFOLIO EMPTY ]</div>';
                return;
            }

            portfolioDiv.innerHTML = '';

            Object.entries(game.portfolio).forEach(([itemId, quantity]) => {
                const item = items.find(i => i.id === itemId);
                const currentPrice = marketPrices[itemId];
                const currentValue = currentPrice * quantity;

                let avgBuyPrice = currentPrice;
                let profit = 0;
                let profitPercent = 0;

                if (game.portfolioDetails[itemId]) {
                    avgBuyPrice = Math.round(game.portfolioDetails[itemId].totalSpent / game.portfolioDetails[itemId].totalQuantity);
                    const totalCost = Math.round(game.portfolioDetails[itemId].totalSpent);
                    profit = currentValue - totalCost;
                    profitPercent = ((profit / totalCost) * 100).toFixed(1);
                }

                const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';
                const profitSign = profit >= 0 ? '+' : '';

                const itemDiv = document.createElement('div');
                itemDiv.className = 'portfolio-item';
                itemDiv.innerHTML = `
                    <div class="portfolio-info">
                        <div>
                            <strong>${item.icon} ${item.name}</strong> x${quantity}<br>
                            <small style="color: rgba(255,255,255,0.6);">Avg Buy: ${avgBuyPrice}Â¢ | Current: ${currentPrice}Â¢</small>
                        </div>
                        <div style="text-align: right;">
                            <strong style="color: #00d9ff;">${currentValue}Â¢</strong><br>
                            <span class="${profitClass}">${profitSign}${Math.round(profit)}Â¢ (${profitSign}${profitPercent}%)</span>
                        </div>
                    </div>
                    <button class="btn-sell" onclick="sellItem('${itemId}', ${quantity})" style="width: 100%; margin-top: 10px;">
                        SELL ALL
                    </button>
                `;
                portfolioDiv.appendChild(itemDiv);
            });
        }

        // Render agents
        function renderAgents() {
            const agentsDiv = document.getElementById('agents');

            const agentsList = [
                { id: 'analyst', name: 'ğŸ¤– ANALYST-7', desc: 'Auto-analyzes market trends', cost: 10000 },
                { id: 'trader', name: 'ğŸ’¼ TRADER-X', desc: 'Auto-trades when profitable', cost: 5000 },
                { id: 'guardian', name: 'ğŸ›¡ï¸ GUARDIAN', desc: 'Protects against crashes', cost: 25000 },
                { id: 'prophet', name: 'ğŸ”® PROPHET', desc: 'Predicts market movements', cost: 50000 }
            ];

            agentsDiv.innerHTML = '';

            agentsList.forEach(agent => {
                if (game.agents[agent.id]) return; // Already owned

                const canAfford = game.money >= agent.cost;

                const agentDiv = document.createElement('div');
                agentDiv.className = 'agent-card';
                agentDiv.innerHTML = `
                    <div class="agent-name">${agent.name}</div>
                    <div class="agent-desc">${agent.desc}</div>
                    <div class="agent-cost">Cost: ${agent.cost}Â¢</div>
                    <button class="btn" onclick="buyAgent('${agent.id}')" ${!canAfford ? 'disabled style="opacity: 0.3; cursor: not-allowed;"' : ''}>
                        RECRUIT
                    </button>
                `;
                agentsDiv.appendChild(agentDiv);
            });

            if (agentsDiv.innerHTML === '') {
                agentsDiv.innerHTML = '<div class="portfolio-empty">[ ALL AGENTS RECRUITED ]</div>';
            }
        }

        function buyAgent(agentId) {
            const agentsList = {
                analyst: { cost: 10000, name: 'ANALYST-7' },
                trader: { cost: 5000, name: 'TRADER-X' },
                guardian: { cost: 25000, name: 'GUARDIAN' },
                prophet: { cost: 50000, name: 'PROPHET' }
            };

            const agent = agentsList[agentId];

            if (game.money < agent.cost) {
                addNews(`> ERROR: Insufficient funds for ${agent.name}`, 'error');
                return;
            }

            game.money -= agent.cost;
            game.agents[agentId] = true;

            addNews(`> RECRUITED: ${agent.name} is now active`, 'success');
            updateUI();
        }

        function toggleBot() {
            game.botEnabled = !game.botEnabled;
            const btn = document.getElementById('botToggleBtn');

            if (game.botEnabled) {
                btn.textContent = 'ğŸ¤– BOT: ON';
                btn.style.background = 'linear-gradient(135deg, #00ff00, #00aa00)';
                btn.style.border = '2px solid #00ff00';
                addNews('> ğŸ’¼ TRADER-X BOT: ACTIVÃ‰', 'success');
            } else {
                btn.textContent = 'ğŸ¤– BOT: OFF';
                btn.style.background = 'linear-gradient(135deg, #ff0000, #aa0000)';
                btn.style.border = '2px solid #ff0000';
                addNews('> ğŸ’¼ TRADER-X BOT: DÃ‰SACTIVÃ‰', 'error');
            }
        }

        function switchDimension() {
            const totalValue = game.money + calculatePortfolioValue();

            if (totalValue < 50000) {
                addNews('> ERROR: Need 50,000Â¢ total value to switch dimension', 'error');
                return;
            }

            if (!confirm(`DIMENSION SHIFT PROTOCOL\n\nYou will lose all items and currency.\nYou will gain ${Math.floor(totalValue / 1000)} Essence.\n\nEssence provides permanent bonuses.\n\nProceed?`)) {
                return;
            }

            const essenceGain = Math.floor(totalValue / 1000);

            game.money = 10000 * (1 + game.essence * 0.1);
            game.portfolio = {};
            game.portfolioDetails = {};
            game.dimension++;
            game.essence += essenceGain;

            const dimensions = ['Î±', 'Î²', 'Î³', 'Î´', 'Îµ', 'Î¶', 'Î·', 'Î¸'];
            document.getElementById('dimensionBadge').textContent = `DIM-${dimensions[Math.min(game.dimension - 1, dimensions.length - 1)]}`;

            addNews(`> DIMENSION SHIFTED TO ${dimensions[Math.min(game.dimension - 1, dimensions.length - 1)]}`, 'event');
            addNews(`> GAINED ${essenceGain} ESSENCE`, 'success');

            updateUI();
        }

        function calculatePortfolioValue() {
            let total = 0;
            Object.entries(game.portfolio).forEach(([itemId, quantity]) => {
                total += marketPrices[itemId] * quantity;
            });
            return total;
        }

        function updateUI() {
            document.getElementById('money').textContent = Math.floor(game.money) + ' Â¢';
            document.getElementById('portfolioValue').textContent = (Math.floor(game.money) + calculatePortfolioValue()) + ' Â¢';
            document.getElementById('totalProfit').textContent = Math.floor(game.totalProfit) + ' Â¢';
            document.getElementById('totalTrades').textContent = game.totalTrades;
            document.getElementById('essence').textContent = game.essence;

            renderMarket();
            renderPortfolio();
            renderAgents();
        }

        // ANALYST-7: Provides market analysis and tips
        function analystAdvice() {
            if (!game.agents.analyst) return;

            items.forEach(item => {
                const price = marketPrices[item.id];
                const history = priceHistory[item.id];

                if (history.length < 10) return; // Need history for analysis

                const priceChange = ((price - history[history.length - 2]) / history[history.length - 2] * 100);

                // Calculate technical indicators for advanced analysis
                const rsi = calculateRSI(item.id);
                const ema12 = calculateEMA(item.id, 12);
                const bb = calculateBollingerBands(item.id);
                const momentum = calculateMomentum(item.id);
                const supply = marketSupply[item.id];
                const scarcityRatio = supply.available / supply.max;
                const rarityIndicator = getRarityIndicator(item.id);

                // === CRITICAL ALERTS ===

                // RSI Extreme Oversold (Major Buy Opportunity)
                if (rsi < 25 && scarcityRatio > 0.6) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸš¨ OPPORTUNITÃ‰ MAJEURE ${item.icon} ${item.name} ! RSI ${rsi.toFixed(0)} (trÃ¨s survendu) + ${rarityIndicator} = ACHAT FORT recommandÃ©`, 'success');
                    return;
                }

                // RSI Extreme Overbought (Major Sell Opportunity)
                if (rsi > 75 && game.portfolio[item.id] && scarcityRatio < 0.4) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸš¨ VENDRE ${item.icon} ${item.name} MAINTENANT ! RSI ${rsi.toFixed(0)} (surachat extrÃªme) + ${rarityIndicator} = Prix au max`, 'success');
                    return;
                }

                // Bollinger Breakout (Price touching lower band + momentum turning)
                const bbPosition = (price - bb.lower) / (bb.upper - bb.lower);
                if (bbPosition < 0.1 && momentum < -5) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸ“Š ${item.icon} ${item.name} touche Bollinger infÃ©rieur ! Rebond probable imminent. RSI: ${rsi.toFixed(0)}`, 'event');
                    return;
                }

                // Upper Bollinger + High RSI = Danger Zone
                if (bbPosition > 0.9 && rsi > 65 && game.portfolio[item.id]) {
                    addNews(`> ğŸ¤– ANALYST-7: âš ï¸ ${item.icon} ${item.name} en ZONE DANGEREUSE (Bollinger supÃ©rieur + RSI ${rsi.toFixed(0)}) - Risque de correction`, 'error');
                    return;
                }

                // === SUPPLY/DEMAND ALERTS ===

                // Stock critique + price spike opportunity
                if (scarcityRatio < 0.25 && game.portfolio[item.id] > 5) {
                    const avgBuyPrice = game.portfolioDetails[item.id].totalSpent / game.portfolioDetails[item.id].totalQuantity;
                    const profitPercent = ((price - avgBuyPrice) / avgBuyPrice * 100);
                    if (profitPercent > 10) {
                        addNews(`> ğŸ¤– ANALYST-7: ğŸ’ ${item.icon} ${item.name} ${rarityIndicator} ! Stock critique = Prix pic. Profit actuel: +${profitPercent.toFixed(1)}% - EXCELLENTE vente !`, 'success');
                        return;
                    }
                }

                // Abundant stock + low RSI = Perfect buy
                if (scarcityRatio > 0.75 && rsi < 40 && price < ema12) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸ’° ${item.icon} ${item.name} ${rarityIndicator} + RSI ${rsi.toFixed(0)} + Prix sous EMA = COMBO PARFAIT d'achat !`, 'success');
                    return;
                }

                // === TREND ANALYSIS ===

                // Strong momentum with confirmation
                if (momentum > 15 && rsi > 55 && rsi < 70) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸš€ ${item.icon} ${item.name} en forte tendance haussiÃ¨re ! Momentum: +${momentum.toFixed(1)}, RSI: ${rsi.toFixed(0)} - Tendance confirmÃ©e`, 'event');
                    return;
                }

                // Negative momentum reversal opportunity
                if (momentum < -15 && rsi < 45 && scarcityRatio > 0.5) {
                    addNews(`> ğŸ¤– ANALYST-7: ğŸ”„ ${item.icon} ${item.name} momentum fortement nÃ©gatif (${momentum.toFixed(1)}) mais RSI ${rsi.toFixed(0)} = Potentiel de rebond`, 'event');
                    return;
                }

                // === PORTFOLIO SPECIFIC ADVICE ===

                if (game.portfolio[item.id]) {
                    const avgBuyPrice = game.portfolioDetails[item.id].totalSpent / game.portfolioDetails[item.id].totalQuantity;
                    const profitPercent = ((price - avgBuyPrice) / avgBuyPrice * 100);

                    // Good profit + weakening momentum = Take profit
                    if (profitPercent > 20 && momentum < 5 && rsi > 60) {
                        addNews(`> ğŸ¤– ANALYST-7: ğŸ’µ ${item.icon} ${item.name} en profit (+${profitPercent.toFixed(1)}%) mais momentum faiblit. Envisage de prendre tes profits !`, 'success');
                        return;
                    }

                    // Loss but good recovery signs
                    if (profitPercent < -10 && rsi < 35 && momentum > -5) {
                        addNews(`> ğŸ¤– ANALYST-7: ğŸ“ˆ ${item.icon} ${item.name} en perte (${profitPercent.toFixed(1)}%) MAIS RSI ${rsi.toFixed(0)} + momentum s'amÃ©liore = Patience, reprise possible`, 'event');
                        return;
                    }
                }

                // === GENERAL MARKET OBSERVATIONS ===

                // Neutral zone analysis
                if (rsi > 45 && rsi < 55 && Math.abs(momentum) < 5) {
                    // Don't spam with neutral info, only occasionally
                    if (Math.random() < 0.1) {
                        addNews(`> ğŸ¤– ANALYST-7: â„¹ï¸ ${item.icon} ${item.name} en zone neutre (RSI ${rsi.toFixed(0)}). Attends un signal plus clair.`, 'info');
                    }
                }
            });
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ğŸ’¼ TRADER-X ULTRA v4.0 - AI-Powered Auto-Trading
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        function autoTrade() {
            if (!game.agents.trader || !game.botEnabled) return; // Check if bot is enabled

            // DEBUG: Confirm bot is running
            if (Math.random() < 0.1) { // Log 10% of the time to avoid spam
                console.log('ğŸ¤– TRADER-X is running...');
            }

            // Capital management: Reserve cash for safety
            const totalCapital = game.money + calculatePortfolioValue();
            const availableCapital = game.money - (totalCapital * tradingAI.capital.reservePercent);

            if (availableCapital < 0) return; // Not enough capital

            items.forEach(item => {
                const price = marketPrices[item.id];
                const history = priceHistory[item.id];
                const owned = game.portfolio[item.id] || 0;

                if (history.length < 10) return; // Need enough data for indicators

                // === BUY LOGIC ===
                if (game.money >= price) {
                    const buyAnalysis = calculateTradingScore(item.id, 'buy');

                    // Dynamic threshold based on learning
                    const buyThreshold = tradingAI.learning.optimalThresholds.buyScore;

                    // Check if score is good enough AND we have confidence
                    if (buyAnalysis.score >= buyThreshold && buyAnalysis.confidence >= 0.6) {
                        // Position sizing based on confidence and volatility
                        const maxPositionValue = totalCapital * tradingAI.capital.maxPositionSize;
                        const confidenceMultiplier = buyAnalysis.confidence; // 0.6-1.0
                        const targetPositionValue = maxPositionValue * confidenceMultiplier;

                        // Calculate quantity based on position sizing (no hard limit)
                        let quantity = Math.floor(Math.min(
                            targetPositionValue / price,
                            availableCapital / price
                        ));

                        if (quantity < 1) quantity = 1;

                        const totalCost = price * quantity;

                        if (game.money >= totalCost && totalCost <= availableCapital) {
                            // Execute buy
                            game.money -= totalCost;

                            // Update market supply (bot removes from available stock)
                            const supply = marketSupply[item.id];
                            supply.available -= quantity;

                            if (!game.portfolioDetails[item.id]) {
                                game.portfolioDetails[item.id] = {
                                    totalSpent: 0,
                                    totalQuantity: 0
                                };
                            }

                            game.portfolioDetails[item.id].totalSpent += totalCost;
                            game.portfolioDetails[item.id].totalQuantity += quantity;
                            game.portfolio[item.id] = (game.portfolio[item.id] || 0) + quantity;
                            game.totalTrades += quantity;

                            // Create AI position tracking for trailing stop
                            if (!tradingAI.positions[item.id]) {
                                tradingAI.positions[item.id] = [];
                            }
                            tradingAI.positions[item.id].push({
                                entry: price,
                                quantity: quantity,
                                highestPrice: price,
                                peakProfit: 0, // Track highest profit reached for Peak Lock
                                timestamp: Date.now(),
                                strategy: buyAnalysis.score > 85 ? 'hold' : buyAnalysis.score > 75 ? 'swing' : 'scalp'
                            });

                            // Update AI stats
                            tradingAI.stats.totalBuys++;
                            tradingAI.learning.itemPerformance[item.id].trades++;

                            // Log with detailed info
                            const indicators = buyAnalysis.indicators;
                            addNews(`> ğŸ’¼ TRADER-X AI: Bought ${quantity}x ${item.icon} ${item.name} @ ${price}Â¢ [Score: ${Math.round(buyAnalysis.score)}/100, RSI: ${indicators.rsi.toFixed(0)}, Confidence: ${(buyAnalysis.confidence*100).toFixed(0)}%]`, 'success');
                        }
                    }
                }

                // === SELL LOGIC with SMART EXIT System v5.2 ===
                if (owned > 0 && game.portfolioDetails[item.id]) {
                    const sellAnalysis = calculateTradingScore(item.id, 'sell');
                    const avgBuyPrice = game.portfolioDetails[item.id].totalSpent / game.portfolioDetails[item.id].totalQuantity;
                    const profitPercent = ((price - avgBuyPrice) / avgBuyPrice * 100);

                    // DEBUG: Log sell analysis for items with large profit
                    if (profitPercent > 20) {
                        console.log(`ğŸ” DEBUG ${item.name}: Profit ${profitPercent.toFixed(1)}%, Owned: ${owned}, SellScore: ${sellAnalysis.score.toFixed(0)}`);
                    }

                    // Update highest price AND peak profit for tracking
                    if (tradingAI.positions[item.id]) {
                        tradingAI.positions[item.id].forEach(pos => {
                            if (price > pos.highestPrice) {
                                pos.highestPrice = price;
                            }
                            // Track peak profit reached
                            if (profitPercent > pos.peakProfit) {
                                pos.peakProfit = profitPercent;
                            }
                        });
                    }

                    let shouldSell = false;
                    let sellReason = '';

                    // Get strategy for this position
                    const strategy = tradingAI.positions[item.id] && tradingAI.positions[item.id].length > 0
                        ? tradingAI.positions[item.id][0].strategy
                        : 'swing';

                    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    // SMART EXIT SYSTEM v5.3 - ULTRA AGGRESSIVE MODE
                    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                    // ğŸš¨ REASON 1: LARGE PROFIT - ALWAYS SELL
                    // Highest priority - sell immediately if profit is large
                    if (profitPercent >= 8) { // LOWERED from 15% â†’ 8%
                        shouldSell = true;
                        sellReason = `Large Profit (+${profitPercent.toFixed(1)}%)`;
                    }

                    // ğŸ¯ REASON 2: GOOD PROFIT + ANY DECENT SIGNAL
                    // Sell if profit good and any indicator suggests selling
                    if (!shouldSell && profitPercent >= 5 && sellAnalysis.score >= 50) { // LOWERED from 8% + score 55
                        shouldSell = true;
                        sellReason = `Good Profit + Signal (${Math.round(sellAnalysis.score)}/100 at +${profitPercent.toFixed(1)}%)`;
                    }

                    // ğŸ’° REASON 3: MEDIUM PROFIT + STRONG SIGNAL
                    // Sell with lower profit if strong sell signal
                    if (!shouldSell && profitPercent >= 3 && sellAnalysis.score >= 60) { // LOWERED from 5% + score 65
                        shouldSell = true;
                        sellReason = `Strong Signal (${Math.round(sellAnalysis.score)}/100 at +${profitPercent.toFixed(1)}%)`;
                    }

                    // ğŸ”’ REASON 4: PEAK LOCK System
                    // Lock profits when they start decreasing from peak
                    if (!shouldSell && tradingAI.positions[item.id] && tradingAI.positions[item.id].length > 0) {
                        const peakProfit = tradingAI.positions[item.id][0].peakProfit;
                        const dropFromPeak = peakProfit - profitPercent;

                        // If reached +10% peak and now dropped 2%
                        if (peakProfit >= 10 && dropFromPeak >= 2) {
                            shouldSell = true;
                            sellReason = `Peak Lock (Peak: +${peakProfit.toFixed(1)}% â†’ Now: +${profitPercent.toFixed(1)}%)`;
                        }
                    }

                    // ğŸ“Š REASON 5: STRATEGY TARGETS (Ultra Aggressive)
                    // Lower targets for faster exits
                    if (!shouldSell) {
                        if (strategy === 'scalp' && profitPercent >= 2) { // LOWERED from 3%
                            shouldSell = true;
                            sellReason = `Scalp Target (+${profitPercent.toFixed(1)}%)`;
                        } else if (strategy === 'swing' && profitPercent >= 4) { // LOWERED from 6%
                            shouldSell = true;
                            sellReason = `Swing Target (+${profitPercent.toFixed(1)}%)`;
                        } else if (strategy === 'hold' && profitPercent >= 7) { // LOWERED from 10%
                            shouldSell = true;
                            sellReason = `Hold Target (+${profitPercent.toFixed(1)}%)`;
                        }
                    }

                    // ğŸ›¡ï¸ REASON 6: TRAILING STOP (Protection)
                    // Sell if price dropped significantly from peak
                    if (!shouldSell && tradingAI.positions[item.id] && tradingAI.positions[item.id].length > 0) {
                        const avgHighest = tradingAI.positions[item.id].reduce((sum, p) => sum + p.highestPrice, 0) / tradingAI.positions[item.id].length;
                        const dropFromHigh = ((avgHighest - price) / avgHighest) * 100;

                        if (dropFromHigh > 8 && profitPercent > 1) {
                            shouldSell = true;
                            sellReason = `Trailing Stop (-${dropFromHigh.toFixed(1)}% from peak)`;
                        }
                    }

                    // âœ… REASON 7: ANY PROFIT + VERY STRONG SIGNAL
                    // Sell at ANY profit if signal is very strong
                    if (!shouldSell && profitPercent >= 1.5 && sellAnalysis.score >= 70) { // LOWERED from 2% + score 75
                        shouldSell = true;
                        sellReason = `Very Strong Signal (${Math.round(sellAnalysis.score)}/100)`;
                    }

                    if (shouldSell) {
                        console.log(`ğŸ’° SELLING: ${item.name} - ${sellReason}, Profit: ${profitPercent.toFixed(1)}%`);
                        // SELL ALL UNITS AT ONCE for fast exit!
                        const quantity = owned;
                        const totalRevenue = price * quantity;
                        const costOfSold = avgBuyPrice * quantity;
                        const profit = totalRevenue - costOfSold;

                        // Update market supply (bot adds back to available stock)
                        const supply = marketSupply[item.id];
                        supply.available = Math.min(supply.max, supply.available + quantity);

                        game.portfolioDetails[item.id].totalSpent -= costOfSold;
                        game.portfolioDetails[item.id].totalQuantity -= quantity;

                        if (game.portfolioDetails[item.id].totalQuantity <= 0) {
                            delete game.portfolioDetails[item.id];
                        }

                        game.money += totalRevenue;
                        game.portfolio[item.id] -= quantity;
                        game.totalProfit += profit;
                        game.totalTrades += quantity;

                        if (game.portfolio[item.id] === 0) {
                            delete game.portfolio[item.id];
                        }

                        // Update AI position tracking
                        if (tradingAI.positions[item.id] && tradingAI.positions[item.id].length > 0) {
                            tradingAI.positions[item.id].shift(); // Remove first position
                        }

                        // Update AI stats and learning
                        tradingAI.stats.totalSells++;
                        tradingAI.stats.totalProfitFromAI += profit;

                        if (profit > 0) {
                            tradingAI.stats.wins++;
                            tradingAI.learning.itemPerformance[item.id].wins++;
                            tradingAI.learning.itemPerformance[item.id].totalProfit += profit;

                            // Track successful scores for learning
                            if (tradingAI.learning.successfulBuyScores.length < 100) {
                                tradingAI.learning.successfulBuyScores.push(sellAnalysis.score);
                            }

                            if (profit > tradingAI.stats.biggestWin) {
                                tradingAI.stats.biggestWin = profit;
                                tradingAI.stats.bestItem = item.name;
                            }
                        } else {
                            tradingAI.stats.losses++;

                            // Track failed scores
                            if (tradingAI.learning.failedBuyScores.length < 100) {
                                tradingAI.learning.failedBuyScores.push(sellAnalysis.score);
                            }

                            if (Math.abs(profit) > Math.abs(tradingAI.stats.biggestLoss)) {
                                tradingAI.stats.biggestLoss = profit;
                                tradingAI.stats.worstItem = item.name;
                            }
                        }

                        // Update win rate
                        tradingAI.stats.winRate = (tradingAI.stats.wins / (tradingAI.stats.wins + tradingAI.stats.losses)) * 100;

                        // Update item confidence based on performance
                        const itemPerf = tradingAI.learning.itemPerformance[item.id];
                        if (itemPerf.trades > 5) {
                            itemPerf.confidence = (itemPerf.wins / itemPerf.trades);
                        }

                        // Machine Learning: Adjust thresholds based on results
                        updateLearningThresholds();

                        const profitSign = profit >= 0 ? '+' : '';
                        addNews(`> ğŸ’¼ TRADER-X AI: Sold ${item.icon} ${item.name} @ ${price}Â¢ (${profitSign}${Math.round(profit)}Â¢, ${profitSign}${profitPercent.toFixed(1)}%) [${sellReason}]`, profit >= 0 ? 'success' : 'error');
                    }
                }
            });
        }

        // Machine Learning: Update thresholds based on success/failure
        function updateLearningThresholds() {
            const successScores = tradingAI.learning.successfulBuyScores;
            const failedScores = tradingAI.learning.failedBuyScores;

            if (successScores.length > 20 && failedScores.length > 10) {
                // Calculate average successful score
                const avgSuccess = successScores.reduce((a, b) => a + b, 0) / successScores.length;
                const avgFailed = failedScores.reduce((a, b) => a + b, 0) / failedScores.length;

                // Adjust buy threshold to be between failed and successful average
                const newBuyThreshold = (avgSuccess + avgFailed) / 2;

                // Gradual adjustment to avoid wild swings
                tradingAI.learning.optimalThresholds.buyScore =
                    tradingAI.learning.optimalThresholds.buyScore * 0.9 + newBuyThreshold * 0.1;
            }
        }

        // Helper: Calculate total portfolio value
        function calculatePortfolioValue() {
            let total = 0;
            Object.entries(game.portfolio).forEach(([itemId, quantity]) => {
                total += marketPrices[itemId] * quantity;
            });
            return total;
        }

        // GUARDIAN: Protects portfolio from heavy losses
        function guardianProtection() {
            if (!game.agents.guardian) return;

            Object.entries(game.portfolio).forEach(([itemId, quantity]) => {
                if (quantity === 0) return;

                const item = items.find(i => i.id === itemId);
                const price = marketPrices[itemId];

                if (!game.portfolioDetails[itemId]) return;

                const avgBuyPrice = game.portfolioDetails[itemId].totalSpent / game.portfolioDetails[itemId].totalQuantity;
                const lossPercent = ((price - avgBuyPrice) / avgBuyPrice * 100);

                // SELL ALL if loss is -20% or worse (stop-loss)
                if (lossPercent <= -20) {
                    const totalRevenue = price * quantity;
                    const totalCost = game.portfolioDetails[itemId].totalSpent;
                    const totalLoss = totalRevenue - totalCost;

                    game.money += totalRevenue;
                    game.totalProfit += totalLoss;
                    game.totalTrades += quantity;

                    delete game.portfolio[itemId];
                    delete game.portfolioDetails[itemId];

                    addNews(`> ğŸ›¡ï¸ GUARDIAN: Sold ALL ${item.icon} ${item.name} to limit losses (${lossPercent.toFixed(1)}% loss)`, 'error');
                }
            });
        }

        // PROPHET: Predicts future price movements
        function prophetPrediction() {
            if (!game.agents.prophet) return;

            items.forEach(item => {
                const history = priceHistory[item.id];
                if (history.length < 5) return;

                // Analyze trend over last 3 price changes
                const recent = history.slice(-4);
                let upCount = 0;
                let downCount = 0;

                for (let i = 1; i < recent.length; i++) {
                    if (recent[i] > recent[i-1]) upCount++;
                    else if (recent[i] < recent[i-1]) downCount++;
                }

                // Strong upward trend prediction
                if (upCount >= 2 && downCount === 0) {
                    addNews(`> ğŸ”® PROPHET: ğŸ“ˆ ${item.name} va continuer Ã  monter bientÃ´t !`, 'success');
                }
                // Strong downward trend prediction
                else if (downCount >= 2 && upCount === 0) {
                    addNews(`> ğŸ”® PROPHET: ğŸ“‰ ${item.name} va continuer Ã  baisser...`, 'error');
                }
                // Reversal prediction (was falling, might rise)
                else if (downCount >= 2 && recent[recent.length - 1] > recent[recent.length - 2]) {
                    addNews(`> ğŸ”® PROPHET: ğŸ”„ ${item.name} pourrait rebondir bientÃ´t !`, 'event');
                }
            });
        }

        function gameLoop() {
            // Market dynamics
            simulateVirtualTraders(); // Virtual traders change supply
            fluctuatePrices();         // Prices adjust based on supply/demand
            updateUI();

            // Agent systems (in order of priority)
            guardianProtection();  // First: protect from losses
            autoTrade();           // Second: execute trades

            // ANALYST advice (only 30% chance to avoid spam)
            if (Math.random() < 0.3) {
                analystAdvice();
            }

            // PROPHET predictions (only 20% chance to avoid spam)
            if (Math.random() < 0.2) {
                prophetPrediction();
            }

            // Random market events
            if (Math.random() < 0.1) {
                const item = items[Math.floor(Math.random() * items.length)];
                const events = [
                    `> ALERT: ${item.name} supply increased`,
                    `> ALERT: ${item.name} demand surging`,
                    `> WARNING: Market volatility detected`,
                    `> INFO: Interdimensional trade route opened`
                ];
                addNews(events[Math.floor(Math.random() * events.length)], 'event');
            }
        }

        function showTutorial() {
            document.getElementById('tutorialModal').style.display = 'block';
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').style.display = 'none';
        }

        function showChangelog() {
            document.getElementById('changelogModal').style.display = 'block';
        }

        function closeChangelog() {
            document.getElementById('changelogModal').style.display = 'none';
        }

        function showAIStats() {
            updateAIStatsDisplay();
            document.getElementById('aiStatsModal').style.display = 'block';
        }

        function closeAIStats() {
            document.getElementById('aiStatsModal').style.display = 'none';
        }

        function updateAIStatsDisplay() {
            // Update global stats
            document.getElementById('aiTotalTrades').textContent = tradingAI.stats.totalBuys + tradingAI.stats.totalSells;
            document.getElementById('aiWinRate').textContent = tradingAI.stats.winRate.toFixed(1) + '%';
            document.getElementById('aiTotalProfit').textContent = Math.round(tradingAI.stats.totalProfitFromAI) + 'Â¢';
            document.getElementById('aiBiggestWin').textContent = Math.round(tradingAI.stats.biggestWin) + 'Â¢';

            // Update learning stats
            document.getElementById('aiBuyThreshold').textContent = Math.round(tradingAI.learning.optimalThresholds.buyScore);
            document.getElementById('aiSuccessMemory').textContent = tradingAI.learning.successfulBuyScores.length;
            document.getElementById('aiFailMemory').textContent = tradingAI.learning.failedBuyScores.length;

            // Update item performance
            const perfDiv = document.getElementById('aiItemPerformance');
            perfDiv.innerHTML = '';

            items.forEach(item => {
                const perf = tradingAI.learning.itemPerformance[item.id];
                if (perf.trades > 0) {
                    const winRate = (perf.wins / perf.trades * 100).toFixed(1);
                    const confidence = (perf.confidence * 100).toFixed(0);

                    const itemDiv = document.createElement('div');
                    itemDiv.style.cssText = 'background: rgba(0,0,0,0.3); padding: 12px; margin-bottom: 10px; border-radius: 8px; border-left: 3px solid #00ff41;';
                    itemDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-size: 1.1em; font-weight: bold;">${item.icon} ${item.name}</span>
                            <span style="color: ${perf.totalProfit >= 0 ? '#0f0' : '#f00'}; font-weight: bold;">${perf.totalProfit >= 0 ? '+' : ''}${Math.round(perf.totalProfit)}Â¢</span>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 0.9em;">
                            <div><span style="color: rgba(255,255,255,0.6);">Trades:</span> <span style="color: #00d9ff;">${perf.trades}</span></div>
                            <div><span style="color: rgba(255,255,255,0.6);">Win Rate:</span> <span style="color: ${winRate >= 50 ? '#0f0' : '#f00'};">${winRate}%</span></div>
                            <div><span style="color: rgba(255,255,255,0.6);">Confidence:</span> <span style="color: #ffd700;">${confidence}%</span></div>
                        </div>
                    `;
                    perfDiv.appendChild(itemDiv);
                }
            });

            if (perfDiv.innerHTML === '') {
                perfDiv.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.5); padding: 20px;">Aucun trade effectuÃ© encore. Active TRADER-X pour voir des stats !</div>';
            }
        }

        function confirmReset() {
            if (confirm('âš ï¸ HARD RESET\n\nThis will delete ALL progress including Essence.\n\nAre you sure?')) {
                localStorage.removeItem('flipverse_save');
                location.reload();
            }
        }

        // Auto-save
        setInterval(() => {
            const saveData = {
                game: game,
                tradingAI: tradingAI,
                marketSupply: marketSupply
            };
            localStorage.setItem('flipverse_save', JSON.stringify(saveData));
        }, 10000);

        // Load save
        const save = localStorage.getItem('flipverse_save');
        if (save) {
            const loaded = JSON.parse(save);
            // Support both old and new save format
            if (loaded.game) {
                Object.assign(game, loaded.game);
                let hasAI = false, hasSupply = false;

                if (loaded.tradingAI) {
                    Object.assign(tradingAI, loaded.tradingAI);
                    hasAI = true;
                }

                if (loaded.marketSupply) {
                    Object.assign(marketSupply, loaded.marketSupply);
                    hasSupply = true;
                }

                if (hasAI && hasSupply) {
                    addNews('> SAVE DATA + AI MEMORY + MARKET STATE LOADED', 'success');
                } else if (hasAI) {
                    addNews('> SAVE DATA + AI MEMORY LOADED', 'success');
                } else {
                    addNews('> SAVE DATA LOADED', 'success');
                }
            } else {
                // Old save format (just game object)
                Object.assign(game, loaded);
                addNews('> SAVE DATA LOADED (OLD FORMAT)', 'success');
            }
        }

        // Initialize
        initMarket();
        updateUI();

        // Game loop (5 seconds)
        setInterval(gameLoop, 5000);

        // Close modals on click outside
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }
    </script>
</body>
</html>
