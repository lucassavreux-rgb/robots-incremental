<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‚ö° Infinite Clicker</title>
    <style>
        /* ========== RESET & BASE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        /* ========== HEADER ========== */
        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            padding: 15px;
            border-bottom: 2px solid #334155;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .coins-display {
            font-size: 28px;
            font-weight: 700;
            color: #fbbf24;
            text-align: center;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(251, 191, 36, 0.5);
        }

        .stats-row {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 12px;
            color: #94a3b8;
        }

        .stat {
            background: rgba(51, 65, 85, 0.5);
            padding: 4px 10px;
            border-radius: 12px;
        }

        .stat strong {
            color: #e2e8f0;
        }

        /* ========== NAVIGATION ========== */
        .nav {
            display: flex;
            background: #1e293b;
            border-bottom: 2px solid #334155;
            overflow-x: auto;
        }

        .nav-btn {
            flex: 1;
            min-width: 80px;
            padding: 12px;
            background: transparent;
            border: none;
            color: #94a3b8;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            touch-action: manipulation;
            user-select: none;
            pointer-events: auto;
        }

        .nav-btn.active {
            color: #60a5fa;
            border-bottom-color: #60a5fa;
            background: rgba(96, 165, 250, 0.1);
        }

        /* ========== MAIN CONTENT ========== */
        .main {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ========== CLICK SECTION ========== */
        .click-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .click-btn {
            width: 180px;
            height: 180px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            border: 4px solid #60a5fa;
            color: white;
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            margin: 20px auto;
            touch-action: manipulation;
            user-select: none;
            pointer-events: auto;
        }

        .click-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.6);
        }

        .click-info {
            font-size: 14px;
            color: #94a3b8;
            margin-top: 10px;
        }

        /* ========== CARD SYSTEM ========== */
        .card {
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .card-count {
            background: #334155;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 13px;
            color: #60a5fa;
        }

        .card-info {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .locked-msg {
            color: #f59e0b;
            font-style: italic;
            font-size: 13px;
        }

        /* ========== BUTTONS ========== */
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
            user-select: none;
            pointer-events: auto;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn:disabled {
            background: #374151;
            color: #6b7280;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 8px;
            font-size: 12px;
        }

        /* ========== PRESTIGE/REBIRTH SECTIONS ========== */
        .prestige-box {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .rebirth-box {
            background: rgba(168, 85, 247, 0.1);
            border: 2px solid #a855f7;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .big-number {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
        }

        .green { color: #10b981; }
        .purple { color: #a855f7; }
        .yellow { color: #fbbf24; }
        .blue { color: #60a5fa; }

        /* ========== UPGRADE GRID ========== */
        .upgrade-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .upgrade-card {
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .upgrade-card h4 {
            font-size: 13px;
            margin-bottom: 5px;
            color: #e2e8f0;
        }

        .upgrade-card p {
            font-size: 11px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        /* ========== STATS GRID ========== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background: rgba(51, 65, 85, 0.6);
            border: 1px solid #475569;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .stat-card-label {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 5px;
        }

        .stat-card-value {
            font-size: 18px;
            font-weight: 700;
            color: #60a5fa;
        }

        /* ========== SECTION HEADERS ========== */
        .section-header {
            font-size: 18px;
            font-weight: 700;
            color: #e2e8f0;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #334155;
        }

        /* ========== MOBILE OPTIMIZATIONS ========== */
        @media (max-width: 400px) {
            .coins-display {
                font-size: 24px;
            }
            .click-btn {
                width: 150px;
                height: 150px;
                font-size: 20px;
            }
            .nav-btn {
                font-size: 12px;
                padding: 10px 5px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="coins-display" id="coins-display">0 Coins</div>
        <div class="stats-row">
            <div class="stat">CPS: <strong id="cps-display">0.0</strong></div>
            <div class="stat">Click: <strong id="click-mult-display">x1</strong></div>
            <div class="stat">Prestige: <strong id="prestige-mult-display">x1</strong></div>
            <div class="stat">Rebirth: <strong id="rebirth-mult-display">x1</strong></div>
        </div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav">
        <button class="nav-btn active" data-tab="shop">üõí Shop</button>
        <button class="nav-btn" data-tab="prestige">‚ú® Prestige</button>
        <button class="nav-btn" data-tab="rebirth">üåü Rebirth</button>
        <button class="nav-btn" data-tab="stats">üìä Stats</button>
        <button class="nav-btn" data-tab="options">‚öôÔ∏è Options</button>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main">
        <!-- SHOP TAB -->
        <div id="tab-shop" class="tab-content active">
            <div class="click-section">
                <button class="click-btn" id="click-btn">
                    üí∞<br>CLICK
                </button>
                <div class="click-info">
                    Par clic: <strong id="per-click">1</strong>
                </div>
            </div>

            <div class="section-header">‚ö° Click Multiplier (Infini)</div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Click Power</div>
                    <div class="card-count">Lvl <span id="click-inf-level">0</span></div>
                </div>
                <div class="card-info">
                    Multiplicateur: x<span id="click-inf-mult">1.00</span>
                </div>
                <button class="btn btn-primary" id="buy-click-inf">
                    Am√©liorer - <span id="click-inf-cost">50</span>
                </button>
            </div>

            <div class="section-header">üè≠ G√©n√©rateurs</div>
            <div id="generators-list"></div>

            <div class="section-header">üîß Upgrades G√©n√©rateurs</div>
            <div id="upgrades-list"></div>

            <div class="section-header">üåê Upgrade Global</div>
            <div class="card" id="global-upgrade-card">
                <div class="card-header">
                    <div class="card-title">Boost Global x2</div>
                </div>
                <div class="card-info">
                    Double tous les gains (clic + g√©n√©rateurs)
                </div>
                <button class="btn btn-success" id="buy-global-upgrade">
                    Acheter - <span id="global-upgrade-cost">10.00M</span>
                </button>
            </div>
        </div>

        <!-- PRESTIGE TAB -->
        <div id="tab-prestige" class="tab-content">
            <div class="prestige-box">
                <h2 class="green">‚ú® PRESTIGE</h2>
                <p style="color: #94a3b8; margin: 10px 0;">
                    Reset tout sauf Rebirth, PT, et achats Prestige Shop
                </p>
                <p style="color: #94a3b8; font-size: 13px;">
                    Co√ªt: <strong class="yellow" id="prestige-cost">10.00K</strong> Coins
                </p>
                <div class="big-number green">
                    +<span id="prestige-gain">0</span> PT
                </div>
                <button class="btn btn-success" id="prestige-btn" style="max-width: 300px; margin: 10px auto;">
                    PRESTIGE
                </button>
                <div style="margin-top: 15px; font-size: 13px; color: #94a3b8;">
                    PT Total: <strong class="green" id="pt-total">0</strong> |
                    PT Dispo: <strong class="yellow" id="pt-available">0</strong>
                </div>
                <div style="margin-top: 5px; font-size: 13px; color: #94a3b8;">
                    Multiplicateur Global: <strong class="green" id="prestige-global-mult">x1.00</strong>
                </div>
            </div>

            <div class="section-header">üõçÔ∏è Prestige Shop (Permanent)</div>
            <div class="upgrade-grid">
                <div class="upgrade-card">
                    <h4>Prestige Click Boost</h4>
                    <p>+25% par niveau (max 20)</p>
                    <p>Niveau: <span id="pshop-click-level">0</span>/20</p>
                    <p>Mult: x<span id="pshop-click-mult">1.00</span></p>
                    <button class="btn btn-small btn-primary" id="buy-pshop-click">
                        <span id="pshop-click-cost">2</span> PT
                    </button>
                </div>
                <div class="upgrade-card">
                    <h4>Prestige Gen Boost</h4>
                    <p>+20% par niveau (max 25)</p>
                    <p>Niveau: <span id="pshop-gen-level">0</span>/25</p>
                    <p>Mult: x<span id="pshop-gen-mult">1.00</span></p>
                    <button class="btn btn-small btn-primary" id="buy-pshop-gen">
                        <span id="pshop-gen-cost">3</span> PT
                    </button>
                </div>
            </div>
        </div>

        <!-- REBIRTH TAB -->
        <div id="tab-rebirth" class="tab-content">
            <div class="rebirth-box">
                <h2 class="purple">üåü REBIRTH</h2>
                <p style="color: #94a3b8; margin: 10px 0;">
                    Reset TOUT (m√™me Prestige) mais x2 multiplicateur permanent
                </p>
                <div class="big-number purple">
                    Multiplicateur: x<span id="rebirth-current-mult">1</span>
                </div>
                <div style="margin: 15px 0; font-size: 14px; color: #94a3b8;">
                    Prestiges depuis Rebirth: <strong class="purple" id="prestiges-since-rebirth">0</strong> / <strong id="prestiges-required">10</strong>
                </div>
                <button class="btn btn-warning" id="rebirth-btn" style="max-width: 300px; margin: 10px auto;">
                    REBIRTH (+x2)
                </button>
                <div style="margin-top: 15px; font-size: 13px; color: #94a3b8;">
                    Rebirth Count: <strong class="purple" id="rebirth-count">0</strong>
                </div>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 10px;">‚ÑπÔ∏è Comment fonctionne le Rebirth ?</h3>
                <ul style="font-size: 13px; color: #94a3b8; line-height: 1.8; padding-left: 20px;">
                    <li>Chaque Rebirth multiplie tous les gains par 2 (permanent)</li>
                    <li>Chaque Rebirth ajoute +15min de gains hors ligne (15min ‚Üí 30min ‚Üí 45min...)</li>
                    <li>Gains offline √† 15% du CPS normal</li>
                    <li>N√©cessite 10 prestiges pour le 1er, puis double √† chaque fois (20, 40, 80...)</li>
                    <li>Reset TOUT: Coins, G√©n√©rateurs, Upgrades, PT, Shop Prestige, Prestiges</li>
                    <li>Conserve uniquement: Rebirth Count et Multiplicateur Rebirth</li>
                </ul>
            </div>
        </div>

        <!-- STATS TAB -->
        <div id="tab-stats" class="tab-content">
            <div class="section-header">üìä Statistiques</div>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-label">Coins Lifetime</div>
                    <div class="stat-card-value" id="stat-lifetime">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Total Prestiges</div>
                    <div class="stat-card-value" id="stat-prestiges">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Rebirth Count</div>
                    <div class="stat-card-value" id="stat-rebirths">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">Temps Jou√©</div>
                    <div class="stat-card-value" id="stat-playtime">0s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-label">üåô Gains Offline Max</div>
                    <div class="stat-card-value" id="stat-offline-time">1h</div>
                </div>
            </div>
        </div>

        <!-- OPTIONS TAB -->
        <div id="tab-options" class="tab-content">
            <div class="section-header">‚öôÔ∏è Options</div>
            <div class="card">
                <h3 style="margin-bottom: 15px;">üíæ Sauvegarde</h3>
                <div class="btn-group">
                    <button class="btn btn-primary" id="export-btn">üì§ Exporter</button>
                    <button class="btn btn-primary" id="import-btn">üì• Importer</button>
                </div>
                <div class="btn-group" style="margin-top: 10px;">
                    <button class="btn btn-danger" id="hard-reset-btn">üóëÔ∏è Hard Reset</button>
                </div>
                <p style="margin-top: 15px; font-size: 12px; color: #94a3b8;">
                    Sauvegarde automatique toutes les 10 secondes
                </p>
            </div>

            <div class="card">
                <h3 style="margin-bottom: 10px;">‚ÑπÔ∏è √Ä propos</h3>
                <p style="font-size: 13px; color: #94a3b8; line-height: 1.6;">
                    <strong>Infinite Clicker</strong> v1.0<br>
                    Un jeu clicker avec 15 g√©n√©rateurs, prestige et rebirth.<br>
                    Con√ßu pour mobile et GitHub Pages.
                </p>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        /* ==========================================
           CONSTANTS - GENERATORS & UPGRADES DATA
        ========================================== */
        const GENERATORS = [
            { id: 0, name: 'Curseur Bot', baseCost: 15, baseCPS: 0.1, unlock: 0 },
            { id: 1, name: 'Mine', baseCost: 100, baseCPS: 1, unlock: 0 },
            { id: 2, name: 'Usine', baseCost: 1100, baseCPS: 5, unlock: 1 },
            { id: 3, name: 'Laboratoire', baseCost: 12000, baseCPS: 47, unlock: 2 },
            { id: 4, name: 'Portail', baseCost: 130000, baseCPS: 260, unlock: 3 },
            { id: 5, name: 'R√©acteur', baseCost: 1400000, baseCPS: 1400, unlock: 4 },
            { id: 6, name: 'Plan√®te IA', baseCost: 20000000, baseCPS: 7800, unlock: 5 },
            { id: 7, name: 'Dyson Swarm', baseCost: 330000000, baseCPS: 44000, unlock: 6 },
            // G9-G15 invent√©s pour late game
            { id: 8, name: 'Matrice Quantique', baseCost: 5.1e9, baseCPS: 260000, unlock: 7 },
            { id: 9, name: 'Anneau Stellaire', baseCost: 7.5e10, baseCPS: 1600000, unlock: 8 },
            { id: 10, name: 'Nexus Temporel', baseCost: 1e12, baseCPS: 10000000, unlock: 9 },
            { id: 11, name: 'Forge Cosmique', baseCost: 1.4e13, baseCPS: 65000000, unlock: 10 },
            { id: 12, name: 'Singularit√© Noire', baseCost: 1.7e14, baseCPS: 430000000, unlock: 11 },
            { id: 13, name: 'Multivers Engine', baseCost: 2.1e15, baseCPS: 2900000000, unlock: 12 },
            { id: 14, name: 'Infinity Core', baseCost: 2.6e16, baseCPS: 21000000000, unlock: 13 }
        ];

        // Upgrades par g√©n√©rateur (3 upgrades chacun : x2, x3, x5)
        const GENERATOR_UPGRADES = [];
        GENERATORS.forEach((gen, i) => {
            // Prix custom pour certains upgrades x3
            let costX3 = 250 * gen.baseCost;
            if (i === 1) costX3 = 60000;  // Mine x3: 60k au lieu de 25k
            if (i === 2) costX3 = 425000; // Usine x3: 425k au lieu de 275k

            GENERATOR_UPGRADES.push(
                { id: `g${i}_u1`, genId: i, mult: 2, cost: 25 * gen.baseCost, name: `${gen.name} x2` },
                { id: `g${i}_u2`, genId: i, mult: 3, cost: costX3, name: `${gen.name} x3` },
                { id: `g${i}_u3`, genId: i, mult: 5, cost: 2500 * gen.baseCost, name: `${gen.name} x5` }
            );
        });

        const GLOBAL_UPGRADE_COST = 1e7;

        /* ==========================================
           GAME STATE
        ========================================== */
        let state = {
            coins: 0,
            lifetimeCoins: 0,
            playtime: 0,
            lastTick: Date.now(),

            // Click
            clickInfLevel: 0,

            // Generators
            generators: GENERATORS.map(() => 0), // owned count

            // Upgrades
            boughtUpgrades: [], // list of upgrade IDs
            boughtGlobalUpgrade: false,

            // Prestige
            totalPrestiges: 0,
            prestigesSinceRebirth: 0,
            ptTotal: 0,
            ptAvailable: 0,
            pShopClickLevel: 0,
            pShopGenLevel: 0,

            // Rebirth
            rebirthCount: 0
        };

        /* ==========================================
           ECONOMY FUNCTIONS (PURE)
        ========================================== */

        // Format grands nombres
        function formatNumber(num) {
            if (num === Infinity || isNaN(num)) return '‚àû';
            if (num < 1000) return num.toFixed(0);
            if (num < 1e6) return (num / 1e3).toFixed(2) + 'K';
            if (num < 1e9) return (num / 1e6).toFixed(2) + 'M';
            if (num < 1e12) return (num / 1e9).toFixed(2) + 'B';
            if (num < 1e15) return (num / 1e12).toFixed(2) + 'T';
            if (num < 1e18) return (num / 1e15).toFixed(2) + 'Qa';
            if (num < 1e21) return (num / 1e18).toFixed(2) + 'Qi';
            if (num < 1e24) return (num / 1e21).toFixed(2) + 'Sx';
            if (num < 1e27) return (num / 1e24).toFixed(2) + 'Sp';
            if (num < 1e30) return (num / 1e27).toFixed(2) + 'Oc';
            if (num < 1e33) return (num / 1e30).toFixed(2) + 'No';
            if (num < 1e36) return (num / 1e33).toFixed(2) + 'Dc';
            return num.toExponential(2);
        }

        function formatTime(seconds) {
            const h = Math.floor(seconds / 3600);
            const m = Math.floor((seconds % 3600) / 60);
            const s = Math.floor(seconds % 60);
            if (h > 0) return `${h}h ${m}m`;
            if (m > 0) return `${m}m ${s}s`;
            return `${s}s`;
        }

        // Click multipliers
        function getClickInfMult() {
            return Math.pow(1.15, state.clickInfLevel);
        }

        function getClickInfCost() {
            return Math.floor(25 * Math.pow(1.30, state.clickInfLevel));
        }

        function getPShopClickMult() {
            return Math.pow(1.25, state.pShopClickLevel);
        }

        function getPShopGenMult() {
            return Math.pow(1.20, state.pShopGenLevel);
        }

        function getPrestigeGlobalMult() {
            return 1 + (state.ptTotal * 0.05);
        }

        function getRebirthMult() {
            return Math.pow(2, state.rebirthCount);
        }

        function getGlobalUpgradeMult() {
            return state.boughtGlobalUpgrade ? 2 : 1;
        }

        function getClickGain() {
            const base = 1;
            const clickInf = getClickInfMult();
            const pShopClick = getPShopClickMult();
            const prestigeGlobal = getPrestigeGlobalMult();
            const rebirth = getRebirthMult();
            const global = getGlobalUpgradeMult();
            return base * clickInf * pShopClick * prestigeGlobal * rebirth * global;
        }

        // Generator economy
        function getGenCost(genId) {
            const gen = GENERATORS[genId];
            const owned = state.generators[genId];
            return Math.floor(gen.baseCost * Math.pow(1.15, owned));
        }

        function getGenTypeMult(genId) {
            let mult = 1;
            GENERATOR_UPGRADES.forEach(upg => {
                if (upg.genId === genId && state.boughtUpgrades.includes(upg.id)) {
                    mult *= upg.mult;
                }
            });
            return mult;
        }

        function getGenCPS(genId) {
            const gen = GENERATORS[genId];
            const owned = state.generators[genId];
            if (owned === 0) return 0;

            const typeMult = getGenTypeMult(genId);
            const pShopGen = getPShopGenMult();
            const prestigeGlobal = getPrestigeGlobalMult();
            const rebirth = getRebirthMult();
            const global = getGlobalUpgradeMult();

            return owned * gen.baseCPS * typeMult * pShopGen * prestigeGlobal * rebirth * global;
        }

        function getTotalCPS() {
            let total = 0;
            for (let i = 0; i < GENERATORS.length; i++) {
                total += getGenCPS(i);
            }
            return total;
        }

        function isGenUnlocked(genId) {
            const gen = GENERATORS[genId];
            // G7+ (Plan√®te IA et suivants) n√©cessitent au moins 1 rebirth
            if (genId >= 6 && state.rebirthCount === 0) {
                return false;
            }
            return state.totalPrestiges >= gen.unlock;
        }

        // Prestige
        function getPrestigeBaseCost() {
            if (state.rebirthCount === 0) return 10000;
            if (state.rebirthCount === 1) return 100000;
            return 1000000; // rebirth 2+
        }

        function getPrestigeCost() {
            const base = getPrestigeBaseCost();
            return base * Math.pow(2, state.prestigesSinceRebirth);
        }

        function canPrestige() {
            return state.coins >= getPrestigeCost();
        }

        function calculatePrestigeGain() {
            if (!canPrestige()) return 0;
            // Gain de PT bas√© sur le rebirth: 1 PT au rebirth 0, 2 PT au rebirth 1, 5 PT au rebirth 2+
            const base = state.rebirthCount === 0 ? 1 : state.rebirthCount === 1 ? 2 : 5;
            return base;
        }

        function getPShopClickCost() {
            return Math.floor(2 * Math.pow(1.6, state.pShopClickLevel));
        }

        function getPShopGenCost() {
            return Math.floor(3 * Math.pow(1.65, state.pShopGenLevel));
        }

        // Rebirth
        function getRequiredPrestiges() {
            return 10 * Math.pow(2, state.rebirthCount);
        }

        function canRebirth() {
            return state.prestigesSinceRebirth >= getRequiredPrestiges();
        }

        /* ==========================================
           GAME ACTIONS
        ========================================== */
        function doClick() {
            const gain = getClickGain();
            state.coins += gain;
            state.lifetimeCoins += gain;
            updateUI();
        }

        function buyClickInf() {
            const cost = getClickInfCost();
            if (state.coins >= cost) {
                state.coins -= cost;
                state.clickInfLevel++;
                updateUI();
                saveGame();
            }
        }

        function buyGenerator(genId, amount = 1) {
            if (!isGenUnlocked(genId)) return;

            let totalCost = 0;
            for (let i = 0; i < amount; i++) {
                totalCost += getGenCost(genId) * Math.pow(1.15, i);
            }

            if (state.coins >= totalCost) {
                state.coins -= totalCost;
                state.generators[genId] += amount;
                updateUI();
                saveGame();
            }
        }

        function buyGeneratorMax(genId) {
            if (!isGenUnlocked(genId)) return;

            let amount = 0;
            let cost = 0;
            let testCoins = state.coins;

            while (amount < 100) {
                const nextCost = getGenCost(genId) * Math.pow(1.15, amount);
                if (testCoins >= nextCost) {
                    testCoins -= nextCost;
                    cost += nextCost;
                    amount++;
                } else {
                    break;
                }
            }

            if (amount > 0) {
                state.coins -= cost;
                state.generators[genId] += amount;
                updateUI();
                saveGame();
            }
        }

        function buyUpgrade(upgradeId) {
            const upg = GENERATOR_UPGRADES.find(u => u.id === upgradeId);
            if (!upg || state.boughtUpgrades.includes(upgradeId)) return;

            if (state.coins >= upg.cost) {
                state.coins -= upg.cost;
                state.boughtUpgrades.push(upgradeId);
                updateUI();
                saveGame();
            }
        }

        function buyGlobalUpgrade() {
            if (state.boughtGlobalUpgrade) return;

            if (state.coins >= GLOBAL_UPGRADE_COST) {
                state.coins -= GLOBAL_UPGRADE_COST;
                state.boughtGlobalUpgrade = true;
                updateUI();
                saveGame();
            }
        }

        function doPrestige() {
            if (!canPrestige()) return;

            if (!confirm('Prestige? Cela va reset vos Coins, G√©n√©rateurs et Upgrades normaux.')) return;

            const gain = calculatePrestigeGain();
            state.ptTotal += gain;
            state.ptAvailable += gain;
            state.totalPrestiges++;
            state.prestigesSinceRebirth++;

            // Reset
            state.coins = 0;
            state.generators = GENERATORS.map(() => 0);
            state.boughtUpgrades = [];
            state.boughtGlobalUpgrade = false;
            state.clickInfLevel = 0;

            updateUI();
            saveGame();
        }

        function buyPShopClick() {
            if (state.pShopClickLevel >= 20) return;

            const cost = getPShopClickCost();
            if (state.ptAvailable >= cost) {
                state.ptAvailable -= cost;
                state.pShopClickLevel++;
                updateUI();
                saveGame();
            }
        }

        function buyPShopGen() {
            if (state.pShopGenLevel >= 25) return;

            const cost = getPShopGenCost();
            if (state.ptAvailable >= cost) {
                state.ptAvailable -= cost;
                state.pShopGenLevel++;
                updateUI();
                saveGame();
            }
        }

        function doRebirth() {
            if (!canRebirth()) return;

            if (!confirm('REBIRTH? Cela va reset TOUT (m√™me Prestige) mais vous gagnez x2 multiplicateur permanent!')) return;

            state.rebirthCount++;

            // Reset TOUT sauf rebirth
            state.coins = 0;
            state.lifetimeCoins = 0;
            state.generators = GENERATORS.map(() => 0);
            state.boughtUpgrades = [];
            state.boughtGlobalUpgrade = false;
            state.clickInfLevel = 0;
            state.totalPrestiges = 0;
            state.prestigesSinceRebirth = 0;
            state.ptTotal = 0;
            state.ptAvailable = 0;
            state.pShopClickLevel = 0;
            state.pShopGenLevel = 0;

            updateUI();
            saveGame();
        }

        /* ==========================================
           UI RENDERING
        ========================================== */
        function updateUI() {
            // Header
            document.getElementById('coins-display').textContent = formatNumber(state.coins) + ' Coins';
            document.getElementById('cps-display').textContent = formatNumber(getTotalCPS());
            document.getElementById('click-mult-display').textContent = 'x' + formatNumber(getClickGain());
            document.getElementById('prestige-mult-display').textContent = 'x' + getPrestigeGlobalMult().toFixed(2);
            document.getElementById('rebirth-mult-display').textContent = 'x' + formatNumber(getRebirthMult());

            // Click section
            document.getElementById('per-click').textContent = formatNumber(getClickGain());
            document.getElementById('click-inf-level').textContent = state.clickInfLevel;
            document.getElementById('click-inf-mult').textContent = getClickInfMult().toFixed(2);
            document.getElementById('click-inf-cost').textContent = formatNumber(getClickInfCost());
            document.getElementById('buy-click-inf').disabled = state.coins < getClickInfCost();

            // Generators
            renderGenerators();

            // Upgrades
            renderUpgrades();

            // Global upgrade
            if (state.boughtGlobalUpgrade) {
                document.getElementById('global-upgrade-card').style.display = 'none';
            } else {
                document.getElementById('global-upgrade-card').style.display = 'block';
                document.getElementById('buy-global-upgrade').disabled = state.coins < GLOBAL_UPGRADE_COST;
            }

            // Prestige
            document.getElementById('prestige-cost').textContent = formatNumber(getPrestigeCost());
            document.getElementById('prestige-gain').textContent = formatNumber(calculatePrestigeGain());
            document.getElementById('pt-total').textContent = formatNumber(state.ptTotal);
            document.getElementById('pt-available').textContent = formatNumber(state.ptAvailable);
            document.getElementById('prestige-global-mult').textContent = 'x' + getPrestigeGlobalMult().toFixed(2);
            document.getElementById('prestige-btn').disabled = !canPrestige();

            // Prestige Shop
            document.getElementById('pshop-click-level').textContent = state.pShopClickLevel;
            document.getElementById('pshop-click-mult').textContent = getPShopClickMult().toFixed(2);
            document.getElementById('pshop-click-cost').textContent = getPShopClickCost();
            document.getElementById('buy-pshop-click').disabled = state.ptAvailable < getPShopClickCost() || state.pShopClickLevel >= 20;

            document.getElementById('pshop-gen-level').textContent = state.pShopGenLevel;
            document.getElementById('pshop-gen-mult').textContent = getPShopGenMult().toFixed(2);
            document.getElementById('pshop-gen-cost').textContent = getPShopGenCost();
            document.getElementById('buy-pshop-gen').disabled = state.ptAvailable < getPShopGenCost() || state.pShopGenLevel >= 25;

            // Rebirth
            document.getElementById('rebirth-current-mult').textContent = formatNumber(getRebirthMult());
            document.getElementById('prestiges-since-rebirth').textContent = state.prestigesSinceRebirth;
            document.getElementById('prestiges-required').textContent = getRequiredPrestiges();
            document.getElementById('rebirth-count').textContent = state.rebirthCount;
            document.getElementById('rebirth-btn').disabled = !canRebirth();

            // Stats
            document.getElementById('stat-lifetime').textContent = formatNumber(state.lifetimeCoins);
            document.getElementById('stat-prestiges').textContent = state.totalPrestiges;
            document.getElementById('stat-rebirths').textContent = state.rebirthCount;
            document.getElementById('stat-playtime').textContent = formatTime(state.playtime);
            document.getElementById('stat-offline-time').textContent = formatTime(getMaxOfflineTime());
        }

        function renderGenerators() {
            const container = document.getElementById('generators-list');
            container.innerHTML = '';

            GENERATORS.forEach(gen => {
                const unlocked = isGenUnlocked(gen.id);
                const owned = state.generators[gen.id];
                const cost = getGenCost(gen.id);
                const cps = getGenCPS(gen.id);

                const card = document.createElement('div');
                card.className = 'card';

                if (!unlocked) {
                    // Message diff√©rent selon la raison du blocage
                    let lockMsg = '';
                    if (gen.id >= 6 && state.rebirthCount === 0) {
                        lockMsg = 'üåü N√©cessite 1 Rebirth pour d√©bloquer';
                    } else {
                        lockMsg = `N√©cessite ${gen.unlock} prestige${gen.unlock > 1 ? 's' : ''}`;
                    }

                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-title">${gen.name}</div>
                            <div class="card-count">üîí</div>
                        </div>
                        <div class="locked-msg">${lockMsg}</div>
                    `;
                } else {
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="card-title">${gen.name}</div>
                            <div class="card-count">${owned}</div>
                        </div>
                        <div class="card-info">
                            Production: ${formatNumber(cps)}/s | Co√ªt: ${formatNumber(cost)}
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-small btn-primary buy-gen-1" data-gen="${gen.id}">
                                Acheter x1
                            </button>
                            <button class="btn btn-small btn-primary buy-gen-10" data-gen="${gen.id}">
                                x10
                            </button>
                            <button class="btn btn-small btn-primary buy-gen-max" data-gen="${gen.id}">
                                MAX
                            </button>
                        </div>
                    `;

                    const canAfford = state.coins >= cost;
                    card.querySelector('.buy-gen-1').disabled = !canAfford;
                    card.querySelector('.buy-gen-10').disabled = !canAfford;
                    card.querySelector('.buy-gen-max').disabled = !canAfford;
                }

                container.appendChild(card);
            });
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades-list');
            container.innerHTML = '';

            const availableUpgrades = GENERATOR_UPGRADES.filter(upg => {
                return !state.boughtUpgrades.includes(upg.id) && isGenUnlocked(upg.genId);
            });

            if (availableUpgrades.length === 0) {
                container.innerHTML = '<p style="color: #94a3b8; text-align: center;">Tous les upgrades achet√©s ou verrouill√©s</p>';
                return;
            }

            availableUpgrades.forEach(upg => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="card-header">
                        <div class="card-title">${upg.name}</div>
                    </div>
                    <div class="card-info">
                        Multiplicateur: x${upg.mult}
                    </div>
                    <button class="btn btn-success buy-upgrade" data-upgrade="${upg.id}">
                        Acheter - ${formatNumber(upg.cost)}
                    </button>
                `;

                const canAfford = state.coins >= upg.cost;
                card.querySelector('.buy-upgrade').disabled = !canAfford;

                container.appendChild(card);
            });
        }

        /* ==========================================
           SAVE/LOAD SYSTEM
        ========================================== */
        function saveGame() {
            localStorage.setItem('infiniteClickerSave', JSON.stringify(state));
        }

        function getMaxOfflineTime() {
            // 15min de base + 15min par rebirth
            return 900 * (1 + state.rebirthCount);
        }

        function loadGame() {
            const saved = localStorage.getItem('infiniteClickerSave');
            if (saved) {
                try {
                    const loaded = JSON.parse(saved);
                    // Merge loaded state with defaults (in case new properties added)
                    state = { ...state, ...loaded };

                    // Calcul des gains offline
                    const now = Date.now();
                    const offlineTime = Math.floor((now - state.lastTick) / 1000); // en secondes

                    if (offlineTime > 10) { // Si absent plus de 10 secondes
                        const maxOfflineTime = getMaxOfflineTime();
                        const actualOfflineTime = Math.min(offlineTime, maxOfflineTime);
                        const cps = getTotalCPS();
                        const offlineGain = (cps * actualOfflineTime) * 0.15; // 15% des gains

                        if (offlineGain > 0) {
                            state.coins += offlineGain;
                            state.lifetimeCoins += offlineGain;

                            // Message de bienvenue
                            const timeStr = formatTime(actualOfflineTime);
                            const cappedMsg = offlineTime > maxOfflineTime ? ` (limit√© √† ${formatTime(maxOfflineTime)})` : '';
                            setTimeout(() => {
                                alert(`üåô Gains hors ligne!\n\nTemps: ${timeStr}${cappedMsg}\nGains: ${formatNumber(offlineGain)} coins\n\n15% du CPS pendant votre absence`);
                            }, 500);
                        }
                    }

                    state.lastTick = Date.now();
                } catch (e) {
                    console.error('Failed to load save:', e);
                }
            }
        }

        function exportSave() {
            const exported = JSON.stringify(state);
            navigator.clipboard.writeText(exported).then(() => {
                alert('Sauvegarde copi√©e dans le presse-papiers!');
            }).catch(() => {
                prompt('Copier cette sauvegarde:', exported);
            });
        }

        function importSave() {
            const imported = prompt('Coller votre sauvegarde:');
            if (imported) {
                try {
                    state = JSON.parse(imported);
                    state.lastTick = Date.now();
                    saveGame();
                    updateUI();
                    alert('Sauvegarde import√©e!');
                } catch (e) {
                    alert('Sauvegarde invalide!');
                }
            }
        }

        function hardReset() {
            if (confirm('ATTENTION: Cela va TOUT effacer! Confirmer?')) {
                if (confirm('Vraiment s√ªr? Pas de retour en arri√®re possible!')) {
                    localStorage.removeItem('infiniteClickerSave');
                    location.reload();
                }
            }
        }

        /* ==========================================
           GAME LOOP
        ========================================== */
        function gameLoop() {
            const now = Date.now();
            const delta = (now - state.lastTick) / 1000;
            state.lastTick = now;

            // Production
            const cps = getTotalCPS();
            const gain = cps * delta;
            state.coins += gain;
            state.lifetimeCoins += gain;

            // Playtime
            state.playtime += delta;

            updateUI();

            requestAnimationFrame(gameLoop);
        }

        // Auto-save every 10 seconds
        setInterval(saveGame, 10000);

        /* ==========================================
           EVENT HANDLERS
        ========================================== */
        document.getElementById('click-btn').addEventListener('click', doClick);
        document.getElementById('buy-click-inf').addEventListener('click', buyClickInf);
        document.getElementById('buy-global-upgrade').addEventListener('click', buyGlobalUpgrade);
        document.getElementById('prestige-btn').addEventListener('click', doPrestige);
        document.getElementById('buy-pshop-click').addEventListener('click', buyPShopClick);
        document.getElementById('buy-pshop-gen').addEventListener('click', buyPShopGen);
        document.getElementById('rebirth-btn').addEventListener('click', doRebirth);
        document.getElementById('export-btn').addEventListener('click', exportSave);
        document.getElementById('import-btn').addEventListener('click', importSave);
        document.getElementById('hard-reset-btn').addEventListener('click', hardReset);

        // Prevent double-tap zoom on click button
        document.getElementById('click-btn').addEventListener('touchend', (e) => {
            e.preventDefault();
            doClick();
        });

        // Generator buy buttons (delegated)
        document.getElementById('generators-list').addEventListener('click', (e) => {
            if (e.target.classList.contains('buy-gen-1')) {
                const genId = parseInt(e.target.dataset.gen);
                buyGenerator(genId, 1);
            } else if (e.target.classList.contains('buy-gen-10')) {
                const genId = parseInt(e.target.dataset.gen);
                buyGenerator(genId, 10);
            } else if (e.target.classList.contains('buy-gen-max')) {
                const genId = parseInt(e.target.dataset.gen);
                buyGeneratorMax(genId);
            }
        });

        // Upgrade buy buttons (delegated)
        document.getElementById('upgrades-list').addEventListener('click', (e) => {
            if (e.target.classList.contains('buy-upgrade')) {
                const upgradeId = e.target.dataset.upgrade;
                buyUpgrade(upgradeId);
            }
        });

        // Tab navigation
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;

                // Update buttons
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Update content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById('tab-' + tab).classList.add('active');
            });
        });

        /* ==========================================
           INITIALIZATION
        ========================================== */
        loadGame();
        updateUI();
        gameLoop();
    </script>
</body>
</html>
