<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üç™ Cookie Clicker Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        .score-display {
            font-size: 2.5em;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .per-second {
            font-size: 1.2em;
            color: #4ade80;
            margin-top: 10px;
        }

        .per-click-display {
            font-size: 1em;
            color: #fbbf24;
            margin-top: 5px;
        }

        .main-container {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            gap: 20px;
            padding: 30px 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            max-height: calc(100vh - 250px);
            overflow-y: auto;
        }

        .section-title {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .clicker-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .click-button {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: radial-gradient(circle, #ffd700, #ff8c00);
            border: 8px solid #fff;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            font-size: 8em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
            user-select: none;
            position: relative;
        }

        .click-button:hover {
            transform: scale(1.05);
            box-shadow: 0 25px 70px rgba(255, 215, 0, 0.6);
        }

        .click-button:active {
            transform: scale(0.95);
        }

        .click-effect {
            position: fixed;
            font-size: 2.5em;
            font-weight: 900;
            color: #ffd700;
            text-shadow:
                0 0 10px rgba(255, 215, 0, 1),
                0 0 20px rgba(255, 215, 0, 0.8),
                2px 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            animation: floatUp 1.5s ease-out forwards;
            z-index: 9999;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            50% {
                opacity: 1;
                transform: translateY(-50px) scale(1.3);
            }
            100% {
                opacity: 0;
                transform: translateY(-120px) scale(1.5);
            }
        }

        .upgrade-item, .generator-item {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upgrade-item:hover, .generator-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
            border-color: #ffd700;
        }

        .upgrade-item.locked, .generator-item.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .item-name {
            font-size: 1.1em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .item-count {
            background: rgba(255, 215, 0, 0.3);
            padding: 4px 12px;
            border-radius: 15px;
            font-weight: 700;
        }

        .item-description {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }

        .item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .item-cost {
            font-size: 1.1em;
            font-weight: 700;
            color: #ffd700;
        }

        .item-production {
            font-size: 0.9em;
            color: #4ade80;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 20px;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: 700;
            color: #ffd700;
        }

        .btn-reset {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #f87171, #ef4444);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            font-size: 1em;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .btn-reset:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(248, 113, 113, 0.4);
        }

        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }

            .click-button {
                width: 250px;
                height: 250px;
                font-size: 6em;
            }
        }

        /* Scrollbar custom */
        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.5);
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.8);
        }
    </style>
</head>
<body>
    <!-- Modal Shop Prestige -->
    <div id="prestigeShopModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 800px; margin: 50px auto; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 20px; padding: 30px; border: 3px solid #ffd700;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #ffd700; font-size: 2em; margin: 0;">‚ú® Shop Prestige ‚ú®</h2>
                <button id="closePrestigeShop" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255, 215, 0, 0.2); border-radius: 10px;">
                <span style="color: #fbbf24; font-weight: 700; font-size: 1.2em;">Points de Prestige: </span>
                <span id="prestigePointsModal" style="color: #ffd700; font-weight: 900; font-size: 1.5em;">0</span>
            </div>

            <div id="prestigeUpgradesList"></div>
        </div>
    </div>

    <!-- Modal Shop Ascension -->
    <div id="ascensionShopModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 800px; margin: 50px auto; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 20px; padding: 30px; border: 3px solid #a78bfa;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #c4b5fd; font-size: 2em; margin: 0;">üåü Shop Ascension üåü</h2>
                <button id="closeAscensionShop" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(167, 139, 250, 0.2); border-radius: 10px;">
                <span style="color: #c4b5fd; font-weight: 700; font-size: 1.2em;">Jetons d'Ascension: </span>
                <span id="ascensionTokensModal" style="color: #a78bfa; font-weight: 900; font-size: 1.5em;">0</span>
            </div>

            <div id="ascensionUpgradesList"></div>
        </div>
    </div>

    <!-- Modal Pantheon -->
    <div id="pantheonModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 900px; margin: 50px auto; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 20px; padding: 30px; border: 3px solid #ffd700;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #fff; font-size: 2em; margin: 0;">‚ö° Panth√©on ‚ö°</h2>
                <button id="closePantheon" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.2); border-radius: 10px;">
                <p style="margin: 0; color: #fff;">Choisis 3 dieux pour b√©n√©ficier de leurs bonus</p>
            </div>

            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px;">
                <div id="godSlot0" style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; min-height: 80px; cursor: pointer; border: 2px dashed rgba(255,255,255,0.5);">
                    <div style="color: #fff; font-size: 0.9em;">Slot 1: Vide</div>
                </div>
                <div id="godSlot1" style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; min-height: 80px; cursor: pointer; border: 2px dashed rgba(255,255,255,0.5);">
                    <div style="color: #fff; font-size: 0.9em;">Slot 2: Vide</div>
                </div>
                <div id="godSlot2" style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; text-align: center; min-height: 80px; cursor: pointer; border: 2px dashed rgba(255,255,255,0.5);">
                    <div style="color: #fff; font-size: 0.9em;">Slot 3: Vide</div>
                </div>
            </div>

            <div id="godsList" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;"></div>
        </div>
    </div>

    <!-- Modal Garden -->
    <div id="gardenModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 1000px; margin: 50px auto; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 20px; padding: 30px; border: 3px solid #34d399;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #fff; font-size: 2em; margin: 0;">üå± Jardin üå±</h2>
                <button id="closeGarden" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div style="display: flex; gap: 20px;">
                <div style="flex: 1;">
                    <div id="gardenGrid" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 5px; margin-bottom: 20px;"></div>
                </div>
                <div style="width: 300px;">
                    <h3 style="color: #fff; margin-bottom: 10px;">Graines</h3>
                    <div id="seedsList" style="max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Stock Market -->
    <div id="stockMarketModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 1000px; margin: 50px auto; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 20px; padding: 30px; border: 3px solid #60a5fa;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #fff; font-size: 2em; margin: 0;">üìà Stock Market üìà</h2>
                <button id="closeStockMarket" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div style="text-align: center; margin-bottom: 20px; padding: 15px; background: rgba(255, 255, 255, 0.2); border-radius: 10px;">
                <span style="color: #fff; font-weight: 700; font-size: 1.2em;">Cash: </span>
                <span id="stockCashDisplay" style="color: #ffd700; font-weight: 900; font-size: 1.5em;">0</span>
            </div>

            <div id="stocksList" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;"></div>
        </div>
    </div>

    <!-- Modal Minions -->
    <div id="minionsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10000; overflow-y: auto; padding: 20px;">
        <div style="max-width: 800px; margin: 50px auto; background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border-radius: 20px; padding: 30px; border: 3px solid #818cf8;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: #fff; font-size: 2em; margin: 0;">üë∑ Minions üë∑</h2>
                <button id="closeMinions" style="background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 1.1em;">‚úï</button>
            </div>

            <div id="minionsList"></div>
        </div>
    </div>

    <!-- Modal Offline Earnings -->
    <div id="offlineEarningsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 20000; padding: 20px;">
        <div style="max-width: 600px; margin: 100px auto; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 20px; padding: 40px; border: 3px solid #ffd700; text-align: center; box-shadow: 0 0 50px rgba(251, 191, 36, 0.5);">
            <div style="font-size: 4em; margin-bottom: 20px;">üí∞</div>
            <h2 style="color: #fff; font-size: 2.5em; margin: 0 0 20px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">GAINS HORS LIGNE!</h2>

            <div style="background: rgba(255, 255, 255, 0.2); border-radius: 15px; padding: 25px; margin-bottom: 25px;">
                <div style="color: #fff; font-size: 1.2em; margin-bottom: 15px;">
                    <span style="opacity: 0.9;">Tu √©tais absent pendant:</span>
                    <div id="offlineTimeAway" style="font-size: 1.5em; font-weight: 900; color: #ffd700; margin-top: 5px;">-</div>
                </div>

                <div style="border-top: 2px solid rgba(255, 255, 255, 0.3); padding-top: 15px; margin-top: 15px;">
                    <div style="color: #fff; font-size: 1.1em; margin-bottom: 10px;">
                        <span style="opacity: 0.9;">Production pendant:</span>
                        <div id="offlineTimeUsed" style="font-size: 1.3em; font-weight: 700; color: #4ade80; margin-top: 5px;">-</div>
                    </div>
                </div>

                <div style="border-top: 2px solid rgba(255, 255, 255, 0.3); padding-top: 15px; margin-top: 15px;">
                    <div style="color: #fff; font-size: 1.3em; margin-bottom: 10px;">
                        <span style="opacity: 0.9;">Tu as gagn√©:</span>
                        <div id="offlineCookiesEarned" style="font-size: 2em; font-weight: 900; color: #ffd700; margin-top: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">-</div>
                    </div>
                </div>

                <div id="offlineCapWarning" style="display: none; margin-top: 15px; padding: 10px; background: rgba(239, 68, 68, 0.3); border-radius: 8px; color: #fff; font-size: 0.9em;">
                    ‚ö†Ô∏è Limite atteinte! Am√©liore ton temps hors ligne dans le Shop Prestige.
                </div>
            </div>

            <button id="collectOfflineEarnings" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 12px; color: white; font-weight: 700; font-size: 1.3em; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);">
                üç™ COLLECTER LES COOKIES! üç™
            </button>
        </div>
    </div>

    <div class="header">
        <div class="title">üç™ Cookie Clicker Pro</div>
        <div class="score-display" id="scoreDisplay">0</div>
        <div class="per-second" id="perSecond">+0/sec</div>
        <div class="per-click-display" id="perClickDisplay">Par clic: +1</div>

        <!-- Dragon section -->
        <div id="dragonSection" style="display: none; margin-top: 15px; padding: 10px; background: rgba(255, 100, 0, 0.2); border-radius: 10px; border: 2px solid rgba(255, 100, 0, 0.5);">
            <div style="display: flex; align-items: center; justify-content: center; gap: 15px; font-size: 0.9em;">
                <span id="dragonIcon" style="font-size: 2em;">ü•ö</span>
                <div style="text-align: left;">
                    <div id="dragonName" style="font-weight: 700; color: #fbbf24;">≈íuf Myst√©rieux</div>
                    <div id="dragonBonus" style="font-size: 0.85em; color: #4ade80;">Bonus: x1.0</div>
                </div>
                <button id="feedDragonBtn" style="padding: 8px 15px; background: linear-gradient(135deg, #ff6b35, #f7931e); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer;">
                    üç™ Nourrir (1%)
                </button>
            </div>
        </div>

        <!-- Minion section -->
        <div id="minionSection" style="display: none; margin-top: 10px; padding: 8px; background: rgba(100, 100, 255, 0.2); border-radius: 10px;">
            <button id="buyAutoClickerBtn" style="padding: 8px 15px; background: linear-gradient(135deg, #6366f1, #4f46e5); border: none; border-radius: 8px; color: white; font-weight: 700; cursor: pointer; font-size: 0.85em;">
                üë∑ Auto-Clicker (Level: <span id="autoClickerLevel">0</span>) - Cost: <span id="autoClickerCost">1M</span>
            </button>
        </div>
    </div>

    <div class="main-container">
        <!-- Left Sidebar: Upgrades -->
        <div class="sidebar">
            <div class="section-title">‚¨ÜÔ∏è Am√©liorations</div>
            <div id="upgradesList"></div>
        </div>

        <!-- Center: Clicker -->
        <div class="clicker-section">
            <div class="click-button" id="clickButton">
                üç™
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Clics Totaux</div>
                    <div class="stat-value" id="totalClicks">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Par Clic</div>
                    <div class="stat-value" id="perClick">1</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Par Seconde</div>
                    <div class="stat-value" id="perSecStats">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">G√©n√©rateurs</div>
                    <div class="stat-value" id="totalGenerators">0</div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar: Auto-Clickers -->
        <div class="sidebar">
            <div class="section-title">ü§ñ G√©n√©rateurs Auto</div>
            <div id="generatorsList"></div>

            <!-- Prestige Section -->
            <div style="margin-top: 30px; padding: 20px; background: rgba(255, 215, 0, 0.1); border-radius: 15px; border: 2px solid rgba(255, 215, 0, 0.3);">
                <div style="font-size: 1.3em; font-weight: 700; margin-bottom: 15px; text-align: center; color: #ffd700;">
                    ‚ú® PRESTIGE ‚ú®
                </div>

                <div id="prestigeInfo" style="text-align: center; margin-bottom: 15px; font-size: 0.9em;">
                    <div style="margin-bottom: 8px;">
                        <span style="color: #fbbf24; font-weight: 700;">Points:</span>
                        <span id="prestigePointsDisplay" style="color: #ffd700; font-weight: 900; font-size: 1.2em;">0</span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <span style="color: #4ade80; font-weight: 700;">Multiplicateur:</span>
                        <span id="prestigeMultiDisplay" style="color: #4ade80; font-weight: 900; font-size: 1.2em;">x1.0</span>
                    </div>
                    <div style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em;">
                        Depuis ascension: <span id="lifetimeCookies">0</span>
                    </div>
                    <div id="nextPrestigeInfo" style="color: rgba(255, 215, 0, 0.8); font-size: 0.85em; margin-top: 5px;">
                        Prochain: 20.00M
                    </div>
                </div>

                <button id="prestigeButton" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 1em; cursor: pointer; transition: all 0.3s; margin-bottom: 10px;">
                    üåü PRESTIGE üåü
                </button>

                <button id="prestigeShopButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s;">
                    üõí Shop Prestige
                </button>
            </div>

            <!-- Ascension Section -->
            <div id="ascensionSection" style="display: none; margin-top: 20px; padding: 20px; background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.2)); border-radius: 15px; border: 2px solid rgba(139, 92, 246, 0.5);">
                <div style="font-size: 1.3em; font-weight: 700; margin-bottom: 15px; text-align: center; color: #a78bfa;">
                    üåü ASCENSION üåü
                </div>

                <div style="text-align: center; margin-bottom: 15px; font-size: 0.9em;">
                    <div style="margin-bottom: 8px;">
                        <span style="color: #c4b5fd; font-weight: 700;">Jetons:</span>
                        <span id="ascensionTokensDisplay" style="color: #a78bfa; font-weight: 900; font-size: 1.2em;">0</span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <span style="color: #4ade80; font-weight: 700;">Multiplicateur:</span>
                        <span id="ascensionMultiDisplay" style="color: #4ade80; font-weight: 900; font-size: 1.2em;">x1</span>
                    </div>
                    <div id="ascensionRequirement" style="color: rgba(255, 255, 255, 0.7); font-size: 0.85em; margin-top: 5px;">
                        Requis: 20 points prestige + 100B lifetime
                    </div>
                </div>

                <button id="ascensionButton" style="width: 100%; padding: 12px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 1em; cursor: pointer; transition: all 0.3s; margin-bottom: 10px;">
                    üåü ASCENSION üåü
                </button>

                <button id="ascensionShopButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #6366f1, #4f46e5); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s;">
                    üõí Shop Ascension
                </button>
            </div>

            <!-- Advanced Systems -->
            <div style="margin-top: 20px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 15px;">
                <div style="font-size: 1.3em; font-weight: 700; margin-bottom: 15px; text-align: center; color: #fff;">
                    üéÆ SYST√àMES AVANC√âS
                </div>

                <button id="pantheonButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s; margin-bottom: 8px;">
                    ‚ö° Panth√©on
                </button>

                <button id="gardenButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s; margin-bottom: 8px;">
                    üå± Jardin
                </button>

                <button id="stockMarketButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #3b82f6, #2563eb); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s; margin-bottom: 8px;">
                    üìà Stock Market
                </button>

                <button id="minionsButton" style="width: 100%; padding: 10px; background: linear-gradient(135deg, #6366f1, #4f46e5); border: none; border-radius: 10px; color: white; font-weight: 700; font-size: 0.9em; cursor: pointer; transition: all 0.3s;">
                    üë∑ Minions
                </button>
            </div>

            <button class="btn-reset" id="resetButton">üîÑ Reset Progression</button>
        </div>
    </div>

    <script>
        // ==================== GAME STATE ====================
        const gameState = {
            cookies: 0,
            totalClicks: 0,
            clickPower: 1,
            cookiesPerSecond: 0,

            upgrades: {},
            generators: {},

            // Prestige system
            prestigePoints: 0,
            prestigeUpgrades: {},
            totalPrestiges: 0,
            totalPrestigePointsEarned: 0, // Total points gagn√©s (jamais diminue)

            // Ascension system
            ascensionTokens: 0,
            ascensionUpgrades: {},
            totalAscensions: 0,
            lifetimeCookiesAtAscension: 0, // Cookies lifetime au moment de la derni√®re ascension

            // Dragon system
            dragonLevel: 0, // 0=locked, 1=egg, 2-7=evolutions
            dragonFed: 0,

            // Minions system
            autoClickerLevel: 0,
            cookieBakerLevel: 0,
            luckyFinderLevel: 0,
            generatorBoosterLevel: 0,
            timeBenderLevel: 0,

            // Pantheon system
            pantheonSlots: [null, null, null], // 3 slots pour les dieux
            pantheonUnlocked: false,

            // Garden system
            gardenUnlocked: false,
            gardenPlots: Array(36).fill(null), // 6x6 grid
            gardenTicks: 0,

            // Stock Market system
            stockMarketUnlocked: false,
            stocks: {
                cookies: { shares: 0, history: [100] },
                chocolate: { shares: 0, history: [50] },
                sugar: { shares: 0, history: [25] },
                butter: { shares: 0, history: [75] },
                flour: { shares: 0, history: [30] },
                vanilla: { shares: 0, history: [120] },
                gold: { shares: 0, history: [200] }
            },
            stockCash: 10000, // Cash pour acheter des actions

            // Offline earnings system
            lastPlayTime: Date.now(),
            maxOfflineTime: 7200, // 2 heures en secondes (2 * 60 * 60)
            offlineTimeUpgrades: {}, // Upgrades pour augmenter le temps max

            stats: {
                totalCookies: 0,
                totalClicks: 0
            }
        };

        // ==================== UPGRADES ====================
        const upgradeDefinitions = {
            click_2x: {
                name: 'Double Clic',
                icon: 'üëÜ',
                description: 'Double la puissance de clic',
                baseCost: 100,
                effect: () => gameState.clickPower *= 2,
                level: 0,
                maxLevel: 1
            },
            click_5x: {
                name: 'Super Clic',
                icon: '‚úã',
                description: 'x3.5 la puissance de clic',
                baseCost: 1000,
                effect: () => gameState.clickPower *= 3.5,
                level: 0,
                maxLevel: 1,
                requires: ['click_2x']
            },
            click_10x: {
                name: 'M√©ga Clic',
                icon: 'üëä',
                description: 'x7 la puissance de clic',
                baseCost: 10000,
                effect: () => gameState.clickPower *= 7,
                level: 0,
                maxLevel: 1,
                requires: ['click_5x']
            },
            click_100x: {
                name: 'Ultra Clic',
                icon: 'üí•',
                description: 'x25 la puissance de clic !',
                baseCost: 100000,
                effect: () => gameState.clickPower *= 25,
                level: 0,
                maxLevel: 1,
                requires: ['click_10x']
            },
            auto_boost: {
                name: 'Boost Auto',
                icon: '‚ö°',
                description: 'G√©n√©rateurs +50%',
                baseCost: 5000,
                effect: () => {},
                multiplier: 1.5,
                level: 0,
                maxLevel: 1
            },
            auto_boost_2: {
                name: 'Mega Boost',
                icon: '‚ö°',
                description: 'G√©n√©rateurs x2',
                baseCost: 50000,
                effect: () => {},
                multiplier: 2,
                level: 0,
                maxLevel: 1,
                requires: ['auto_boost']
            },
            multi_click: {
                name: 'Multi-Clic',
                icon: 'üñ±Ô∏è',
                description: 'Chaque clic compte x1.5',
                baseCost: 2500,
                effect: () => {},
                clickMultiplier: 1.5,
                level: 0,
                maxLevel: 1
            },
            multi_click_2: {
                name: 'Super Multi-Clic',
                icon: 'üñ±Ô∏è',
                description: 'Chaque clic compte x2.5',
                baseCost: 25000,
                effect: () => {},
                clickMultiplier: 2.5,
                level: 0,
                maxLevel: 1,
                requires: ['multi_click']
            }
        };

        // ==================== ASCENSION UPGRADES ====================
        const ascensionUpgradeDefinitions = {
            prod_divine: {
                name: 'Production Divine',
                icon: '‚ö°',
                description: 'x3 production g√©n√©rateurs',
                cost: 1,
                multiplier: 3
            },
            prod_cosmic: {
                name: 'Production Cosmique',
                icon: '‚ö°',
                description: 'x5 production g√©n√©rateurs',
                cost: 3,
                multiplier: 5,
                requires: ['prod_divine']
            },
            click_divine: {
                name: 'Clic Divin',
                icon: 'üëÜ',
                description: 'x5 puissance de clic',
                cost: 2,
                clickMultiplier: 5
            },
            click_cosmic: {
                name: 'Clic Cosmique',
                icon: 'üëÜ',
                description: 'x10 puissance de clic',
                cost: 5,
                clickMultiplier: 10,
                requires: ['click_divine']
            },
            cheaper_divine: {
                name: 'G√©n√©rateurs Gratuits',
                icon: 'üí∞',
                description: '-25% co√ªt g√©n√©rateurs',
                cost: 4,
                costReduction: 0.75
            },
            prestige_boost: {
                name: 'Prestige Boost√©',
                icon: 'üåü',
                description: 'Points prestige x2 plus rapides (1pt/10M)',
                cost: 3,
                prestigeBoost: true
            },
            legendary_start: {
                name: 'D√©part L√©gendaire',
                icon: 'üöÄ',
                description: 'Commence avec 1M cookies apr√®s prestige',
                cost: 6,
                startingCookies: 1000000
            }
        };

        // ==================== OFFLINE TIME UPGRADES ====================
        const offlineTimeUpgradeDefinitions = {
            offline_4h: {
                name: 'Temps Hors Ligne I',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 4h',
                cost: 3,
                maxTime: 14400, // 4h en secondes
                unlockCondition: () => gameState.totalPrestiges >= 3
            },
            offline_8h: {
                name: 'Temps Hors Ligne II',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 8h',
                cost: 5,
                maxTime: 28800, // 8h
                requires: ['offline_4h'],
                unlockCondition: () => gameState.totalPrestiges >= 3
            },
            offline_12h: {
                name: 'Temps Hors Ligne III',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 12h',
                cost: 8,
                maxTime: 43200, // 12h
                requires: ['offline_8h'],
                unlockCondition: () => gameState.totalPrestiges >= 3
            },
            offline_24h: {
                name: 'Temps Hors Ligne IV',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 24h (1 jour)',
                cost: 12,
                maxTime: 86400, // 24h
                requires: ['offline_12h'],
                unlockCondition: () => gameState.totalPrestiges >= 5
            },
            offline_36h: {
                name: 'Temps Hors Ligne V',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 36h',
                cost: 18,
                maxTime: 129600, // 36h
                requires: ['offline_24h'],
                unlockCondition: () => gameState.totalPrestiges >= 7
            },
            offline_50h: {
                name: 'Temps Hors Ligne MAX',
                icon: '‚è∞',
                description: 'Augmente le temps hors ligne √† 50h (MAX)',
                cost: 25,
                maxTime: 180000, // 50h
                requires: ['offline_36h'],
                unlockCondition: () => gameState.totalPrestiges >= 10
            }
        };

        // ==================== PRESTIGE UPGRADES ====================
        const prestigeUpgradeDefinitions = {
            prod_boost_1: {
                name: 'Boost Production I',
                icon: '‚≠ê',
                description: '+50% production g√©n√©rateurs',
                cost: 1,
                multiplier: 1.5
            },
            prod_boost_2: {
                name: 'Boost Production II',
                icon: '‚≠ê',
                description: '+100% production g√©n√©rateurs',
                cost: 3,
                multiplier: 2,
                requires: ['prod_boost_1']
            },
            prod_boost_3: {
                name: 'Boost Production III',
                icon: '‚≠ê',
                description: '+200% production g√©n√©rateurs',
                cost: 7,
                multiplier: 3,
                requires: ['prod_boost_2']
            },
            click_boost_1: {
                name: 'Boost Clic I',
                icon: 'üëÜ',
                description: '+100% puissance de clic',
                cost: 2,
                clickMultiplier: 2
            },
            click_boost_2: {
                name: 'Boost Clic II',
                icon: 'üëÜ',
                description: '+300% puissance de clic',
                cost: 5,
                clickMultiplier: 4,
                requires: ['click_boost_1']
            },
            cheaper_gens: {
                name: 'G√©n√©rateurs moins chers',
                icon: 'üí∞',
                description: '-10% co√ªt g√©n√©rateurs',
                cost: 4,
                costReduction: 0.9
            },
            starting_boost: {
                name: 'D√©part boost√©',
                icon: 'üöÄ',
                description: 'Commence avec 1000 cookies',
                cost: 2,
                startingCookies: 1000
            },
            // Prestige++ upgrades (unlocked after 10 prestiges)
            cookie_titan: {
                name: 'Cookie Titan',
                icon: 'üíé',
                description: 'x5 production globale',
                cost: 15,
                multiplier: 5,
                unlockCondition: () => gameState.totalPrestiges >= 10
            },
            eternal_clicker: {
                name: 'Eternal Clicker',
                icon: 'üíé',
                description: 'x10 puissance de clic',
                cost: 20,
                clickMultiplier: 10,
                unlockCondition: () => gameState.totalPrestiges >= 10
            },
            cookie_god: {
                name: 'Cookie God',
                icon: 'üíé',
                description: 'x10 TOUT (production ET clics)',
                cost: 50,
                godMultiplier: 10,
                unlockCondition: () => gameState.totalPrestiges >= 10
            }
        };

        // ==================== GENERATORS ====================
        const generatorDefinitions = {
            cursor: {
                name: 'Curseur',
                icon: '‚òùÔ∏è',
                description: 'Clique automatiquement',
                baseCost: 15,
                baseProduction: 1,
                costMultiplier: 1.15,
                count: 0
            },
            grandma: {
                name: 'Grand-m√®re',
                icon: 'üëµ',
                description: 'Une gentille grand-m√®re qui fait des cookies',
                baseCost: 100,
                baseProduction: 3,
                costMultiplier: 1.15,
                count: 0
            },
            farm: {
                name: 'Ferme',
                icon: 'üåæ',
                description: 'Cultive des ingr√©dients',
                baseCost: 1100,
                baseProduction: 12,
                costMultiplier: 1.15,
                count: 0
            },
            factory: {
                name: 'Usine',
                icon: 'üè≠',
                description: 'Production de masse',
                baseCost: 12000,
                baseProduction: 47,
                costMultiplier: 1.15,
                count: 0
            },
            mine: {
                name: 'Mine',
                icon: '‚õèÔ∏è',
                description: 'Extrait du chocolat pur',
                baseCost: 130000,
                baseProduction: 260,
                costMultiplier: 1.15,
                count: 0
            },
            spaceship: {
                name: 'Vaisseau Spatial',
                icon: 'üöÄ',
                description: 'Cookies depuis l\'espace',
                baseCost: 1400000,
                baseProduction: 1400,
                costMultiplier: 1.15,
                count: 0
            },
            portal: {
                name: 'Portail Dimensionnel',
                icon: 'üåÄ',
                description: 'Importe des cookies d\'autres dimensions',
                baseCost: 20000000,
                baseProduction: 7800,
                costMultiplier: 1.15,
                count: 0
            },
            alchemist: {
                name: 'Alchimiste',
                icon: 'üíº',
                description: 'Transforme le plomb en cookies d\'or',
                baseCost: 100000000,
                baseProduction: 40000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.stats.totalCookies >= 100000000
            },
            bank: {
                name: 'Banque',
                icon: 'üè¶',
                description: 'Les int√©r√™ts font des cookies',
                baseCost: 500000000,
                baseProduction: 200000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.totalPrestiges >= 3
            },
            laboratory: {
                name: 'Laboratoire',
                icon: 'üî¨',
                description: 'Science des cookies quantiques',
                baseCost: 3000000000,
                baseProduction: 1000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.stats.totalCookies >= 500000000
            },
            timeMachine: {
                name: 'Machine Temporelle',
                icon: '‚è∞',
                description: 'Importe des cookies du futur',
                baseCost: 20000000000,
                baseProduction: 6000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.totalPrestiges >= 5
            },
            multiverse: {
                name: 'Portail Multiversel',
                icon: 'üåå',
                description: 'Cookies de dimensions parall√®les',
                baseCost: 150000000000,
                baseProduction: 35000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.stats.totalCookies >= 10000000000
            },
            alienShip: {
                name: 'Vaisseau Alien',
                icon: 'üëΩ',
                description: 'Technologie extraterrestre',
                baseCost: 1000000000000,
                baseProduction: 200000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.totalPrestiges >= 10
            },
            blackHole: {
                name: 'Trou Noir',
                icon: 'üåü',
                description: 'Absorbe l\'univers en cookies',
                baseCost: 10000000000000,
                baseProduction: 1200000000,
                costMultiplier: 1.15,
                count: 0,
                unlockCondition: () => gameState.totalPrestiges >= 10
            }
        };

        // ==================== PANTHEON DEFINITIONS ====================
        const pantheonGods = {
            chronos: {
                name: 'Chronos',
                icon: '‚è∞',
                description: 'Dieu du Temps - Production +15%',
                productionBonus: 1.15
            },
            plutus: {
                name: 'Plutus',
                icon: 'üí∞',
                description: 'Dieu de la Richesse - Cookies par clic +20%',
                clickBonus: 1.20
            },
            demeter: {
                name: 'D√©m√©ter',
                icon: 'üåæ',
                description: 'D√©esse de la R√©colte - G√©n√©rateurs +25%',
                generatorBonus: 1.25
            },
            fortuna: {
                name: 'Fortuna',
                icon: 'üçÄ',
                description: 'D√©esse de la Chance - Cookies dor√©s +50%',
                luckyBonus: 1.50
            },
            hephaestus: {
                name: 'H√©pha√Østos',
                icon: 'üî®',
                description: 'Dieu de la Forge - Co√ªts -15%',
                costReduction: 0.85
            },
            athena: {
                name: 'Ath√©na',
                icon: 'ü¶â',
                description: 'D√©esse de la Sagesse - Tous bonus +10%',
                globalBonus: 1.10
            }
        };

        // ==================== GARDEN DEFINITIONS ====================
        const gardenPlants = {
            wheat: {
                name: 'Bl√©',
                icon: 'üåæ',
                description: '+1% production',
                cost: 100,
                growTime: 30, // ticks (30 = 30 secondes)
                productionBonus: 1.01,
                mutations: []
            },
            clover: {
                name: 'Tr√®fle',
                icon: 'üçÄ',
                description: 'Cookie dor√© chance +2%',
                cost: 500,
                growTime: 60,
                luckyBonus: 1.02,
                mutations: []
            },
            cookie_plant: {
                name: 'Cookie Plant',
                icon: 'üç™',
                description: '+5 cookies/sec',
                cost: 1000,
                growTime: 90,
                cookiesPerSecond: 5,
                mutations: []
            },
            golden_clover: {
                name: 'Tr√®fle Dor√©',
                icon: '‚ú®',
                description: '+5% production',
                cost: 5000,
                growTime: 120,
                productionBonus: 1.05,
                mutations: [['clover', 'wheat']]
            },
            bakeberry: {
                name: 'Baie Cookie',
                icon: 'ü´ê',
                description: '+10 cookies/sec',
                cost: 10000,
                growTime: 150,
                cookiesPerSecond: 10,
                mutations: [['cookie_plant', 'wheat']]
            },
            chocoroot: {
                name: 'Racine Choco',
                icon: 'üç´',
                description: '+3% production',
                cost: 25000,
                growTime: 180,
                productionBonus: 1.03,
                mutations: []
            },
            sugar_lotus: {
                name: 'Lotus Sucr√©',
                icon: 'ü™∑',
                description: 'Multiplicateur +2%',
                cost: 50000,
                growTime: 240,
                globalBonus: 1.02,
                mutations: [['bakeberry', 'golden_clover']]
            },
            dragon_fruit: {
                name: 'Fruit Dragon',
                icon: 'üêâ',
                description: 'Dragon bonus +10%',
                cost: 100000,
                growTime: 300,
                dragonBonus: 1.10,
                mutations: [['sugar_lotus', 'chocoroot']]
            },
            eternal_seed: {
                name: 'Graine √âternelle',
                icon: 'üí´',
                description: '+10% TOUT',
                cost: 500000,
                growTime: 600,
                godBonus: 1.10,
                mutations: [['dragon_fruit', 'sugar_lotus', 'golden_clover']]
            }
        };

        // ==================== MINION DEFINITIONS ====================
        const minionDefinitions = {
            autoClicker: {
                name: 'Auto-Clicker',
                icon: 'üë∑',
                description: '+0.1 clic/sec par niveau',
                baseCost: 1000000,
                costMultiplier: 2
            },
            cookieBaker: {
                name: 'Cookie Baker',
                icon: 'üë®‚Äçüç≥',
                description: '+1% production par niveau',
                baseCost: 5000000,
                costMultiplier: 2.5,
                productionBonus: 0.01
            },
            luckyFinder: {
                name: 'Lucky Finder',
                icon: 'üîç',
                description: 'Trouve des cookies dor√©s',
                baseCost: 10000000,
                costMultiplier: 3,
                goldenCookieChance: 0.001
            },
            generatorBooster: {
                name: 'Generator Booster',
                icon: '‚ö°',
                description: '+2% efficacit√© g√©n√©rateurs/niveau',
                baseCost: 50000000,
                costMultiplier: 3,
                generatorBonus: 0.02
            },
            timeBender: {
                name: 'Time Bender',
                icon: '‚åõ',
                description: 'Acc√©l√®re le jeu +5%/niveau',
                baseCost: 100000000,
                costMultiplier: 4,
                timeBonus: 0.05
            }
        };

        // ==================== ASCENSION FUNCTIONS ====================
        function getAscensionMultiplier() {
            // Chaque ascension donne x2 (100%)
            return Math.pow(2, gameState.totalAscensions);
        }

        function canAscend() {
            return gameState.prestigePoints >= 20 && gameState.stats.totalCookies >= 100000000000;
        }

        function calculateAscensionTokens() {
            return Math.floor(gameState.prestigePoints / 20);
        }

        function doAscension() {
            if (!canAscend()) {
                alert('Conditions pour Ascension:\n- Au moins 20 points de prestige\n- Au moins 100B cookies lifetime');
                return;
            }

            const tokensToGain = calculateAscensionTokens();

            if (confirm(`üåü ASCENSION üåü\n\nTu vas gagner ${tokensToGain} jeton${tokensToGain > 1 ? 's' : ''} d'Ascension!\nMultiplicateur: x${getAscensionMultiplier()} ‚Üí x${getAscensionMultiplier() * 2}\n\n‚ö†Ô∏è RESET TOTAL:\n- Cookies\n- G√©n√©rateurs\n- Upgrades\n- Points de Prestige\n- Prestiges effectu√©s\n\n‚úÖ TU GARDES:\n- Upgrades Ascension\n- Stats lifetime\n\nContinuer?`)) {
                gameState.ascensionTokens += tokensToGain;
                gameState.totalAscensions++;

                // Sauvegarder les cookies lifetime au moment de l'ascension
                gameState.lifetimeCookiesAtAscension = gameState.stats.totalCookies;

                // RESET TOTAL
                gameState.cookies = 0;
                gameState.totalClicks = 0;
                gameState.clickPower = 1;
                gameState.cookiesPerSecond = 0;
                gameState.upgrades = {};
                gameState.generators = {};
                gameState.prestigePoints = 0;
                gameState.prestigeUpgrades = {};
                gameState.totalPrestiges = 0;
                gameState.totalPrestigePointsEarned = 0;

                // Stats lifetime reste

                updateProduction();
                updateUI();
                saveGame();

                alert(`‚ú® ASCENSION R√âUSSIE! ‚ú®\n\n+${tokensToGain} Jeton${tokensToGain > 1 ? 's' : ''}\nMultiplicateur: x${getAscensionMultiplier()}\n\nTu es maintenant transcendant!`);
            }
        }

        function buyAscensionUpgrade(id) {
            const upgrade = ascensionUpgradeDefinitions[id];

            if (gameState.ascensionUpgrades[id]) return;

            if (upgrade.requires) {
                const hasRequirements = upgrade.requires.every(req => gameState.ascensionUpgrades[req]);
                if (!hasRequirements) {
                    alert('Tu dois acheter les upgrades pr√©c√©dents!');
                    return;
                }
            }

            if (gameState.ascensionTokens >= upgrade.cost) {
                gameState.ascensionTokens -= upgrade.cost;
                gameState.ascensionUpgrades[id] = true;

                updateProduction();
                updateUI();
                saveGame();
            } else {
                alert('Pas assez de jetons d\'ascension!');
            }
        }

        // ==================== OFFLINE EARNINGS FUNCTIONS ====================
        function getMaxOfflineTime() {
            let maxTime = 7200; // 2h de base

            // Check all offline time upgrades
            Object.entries(offlineTimeUpgradeDefinitions).forEach(([id, upgrade]) => {
                if (gameState.offlineTimeUpgrades[id]) {
                    maxTime = upgrade.maxTime;
                }
            });

            return maxTime;
        }

        function buyOfflineTimeUpgrade(id) {
            const upgrade = offlineTimeUpgradeDefinitions[id];

            // Check if already bought
            if (gameState.offlineTimeUpgrades[id]) return;

            // Check requirements
            if (upgrade.requires) {
                const hasRequirements = upgrade.requires.every(req => gameState.offlineTimeUpgrades[req]);
                if (!hasRequirements) {
                    alert('Tu dois acheter les upgrades pr√©c√©dents!');
                    return;
                }
            }

            // Check unlock condition
            if (upgrade.unlockCondition && !upgrade.unlockCondition()) {
                alert('Upgrade pas encore d√©bloqu√©!');
                return;
            }

            if (gameState.prestigePoints >= upgrade.cost) {
                gameState.prestigePoints -= upgrade.cost;
                gameState.offlineTimeUpgrades[id] = true;
                gameState.maxOfflineTime = upgrade.maxTime;

                updateUI();
                saveGame();

                // Re-render prestige shop to update
                if (document.getElementById('prestigeShopModal').style.display === 'block') {
                    renderPrestigeUpgrades();
                }
            } else {
                alert('Pas assez de points de prestige!');
            }
        }

        function calculateOfflineEarnings() {
            const now = Date.now();
            const timeDiff = (now - gameState.lastPlayTime) / 1000; // en secondes

            // Minimum 10 secondes pour √©viter les micro-absences
            if (timeDiff < 10) return null;

            const maxTime = getMaxOfflineTime();
            const effectiveTime = Math.min(timeDiff, maxTime);
            const cookiesEarned = gameState.cookiesPerSecond * effectiveTime;

            return {
                timeAway: timeDiff,
                timeUsed: effectiveTime,
                maxTime: maxTime,
                cookiesEarned: cookiesEarned,
                wasCapped: timeDiff > maxTime
            };
        }

        // ==================== PRESTIGE FUNCTIONS ====================
        function calculatePrestigePoints() {
            // 1 point par 20M ou 10M si prestige boost
            // Utilise seulement les cookies depuis la derni√®re ascension
            const cookiesSinceAscension = gameState.stats.totalCookies - gameState.lifetimeCookiesAtAscension;
            const divider = gameState.ascensionUpgrades.prestige_boost ? 10000000 : 20000000;
            return Math.floor(cookiesSinceAscension / divider);
        }

        function getPrestigeMultiplier() {
            // Chaque prestige donne +50% (x0.5)
            return 1 + (gameState.totalPrestiges * 0.5);
        }

        function canPrestige() {
            // On peut prestige si on peut gagner de nouveaux points
            const pointsToGain = calculatePrestigePoints() - gameState.totalPrestigePointsEarned;
            return pointsToGain > 0;
        }

        function doPrestige() {
            const pointsToGain = calculatePrestigePoints() - gameState.totalPrestigePointsEarned;

            if (pointsToGain <= 0) {
                alert('Tu ne gagnerais pas de nouveaux points de prestige!\n\nIl te faut 20M cookies lifetime de plus pour gagner 1 point.');
                return;
            }

            if (confirm(`Faire un Prestige?\n\n+${pointsToGain} Point${pointsToGain > 1 ? 's' : ''} de Prestige\nMultiplicateur: x${getPrestigeMultiplier().toFixed(1)} ‚Üí x${(getPrestigeMultiplier() + 0.5).toFixed(1)}\n\nTu vas perdre tous tes cookies, g√©n√©rateurs et upgrades!`)) {
                // Ajouter les nouveaux points
                gameState.prestigePoints += pointsToGain;
                gameState.totalPrestigePointsEarned += pointsToGain;
                gameState.totalPrestiges++;

                // Reset tout sauf prestige
                gameState.cookies = 0;
                gameState.totalClicks = 0;
                gameState.clickPower = 1;
                gameState.cookiesPerSecond = 0;
                gameState.upgrades = {};
                gameState.generators = {};

                // Garde les stats
                // gameState.stats reste

                // Appliquer starting boost si achet√©
                if (gameState.prestigeUpgrades.starting_boost) {
                    gameState.cookies = prestigeUpgradeDefinitions.starting_boost.startingCookies;
                }

                // Appliquer legendary start si achet√©
                if (gameState.ascensionUpgrades.legendary_start) {
                    gameState.cookies = ascensionUpgradeDefinitions.legendary_start.startingCookies;
                }

                // Unlock dragon au 1er prestige
                if (gameState.totalPrestiges === 1 && gameState.dragonLevel === 0) {
                    gameState.dragonLevel = 1; // Egg
                    setTimeout(() => {
                        alert(`üêâ UN ≈íUF MYST√âRIEUX EST APPARU!\n\nNourris-le avec des cookies pour le faire √©clore!`);
                    }, 500);
                }

                updateProduction();
                updateUI();
                saveGame();

                alert(`Prestige effectu√©!\n\n+${pointsToGain} Point${pointsToGain > 1 ? 's' : ''} de Prestige\nTotal dispo: ${gameState.prestigePoints} points\nMultiplicateur: x${getPrestigeMultiplier().toFixed(1)}`);
            }
        }

        function buyPrestigeUpgrade(id) {
            const upgrade = prestigeUpgradeDefinitions[id];

            // Check if already bought
            if (gameState.prestigeUpgrades[id]) return;

            // Check requirements
            if (upgrade.requires) {
                const hasRequirements = upgrade.requires.every(req => gameState.prestigeUpgrades[req]);
                if (!hasRequirements) {
                    alert('Tu dois acheter les upgrades pr√©c√©dents!');
                    return;
                }
            }

            if (gameState.prestigePoints >= upgrade.cost) {
                gameState.prestigePoints -= upgrade.cost;
                gameState.prestigeUpgrades[id] = true;

                updateProduction();
                updateUI();
                saveGame();
            } else {
                alert('Pas assez de points de prestige!');
            }
        }

        // ==================== FUNCTIONS ====================
        function formatNumber(num) {
            if (num < 1000) return Math.floor(num);
            if (num < 1000000) return (num / 1000).toFixed(2) + 'K';
            if (num < 1000000000) return (num / 1000000).toFixed(2) + 'M';
            if (num < 1000000000000) return (num / 1000000000).toFixed(2) + 'B';
            return (num / 1000000000000).toFixed(2) + 'T';
        }

        function handleClick(event) {
            console.log('Click d√©tect√©!', event);

            let clicks = 1;
            let effectiveClickPower = gameState.clickPower;

            // Multi-click upgrades
            if (gameState.upgrades.multi_click) clicks *= upgradeDefinitions.multi_click.clickMultiplier;
            if (gameState.upgrades.multi_click_2) clicks *= upgradeDefinitions.multi_click_2.clickMultiplier;

            // Apply prestige click multipliers
            if (gameState.prestigeUpgrades.click_boost_1) {
                effectiveClickPower *= prestigeUpgradeDefinitions.click_boost_1.clickMultiplier;
            }
            if (gameState.prestigeUpgrades.click_boost_2) {
                effectiveClickPower *= prestigeUpgradeDefinitions.click_boost_2.clickMultiplier;
            }

            // Apply global prestige multiplier
            effectiveClickPower *= getPrestigeMultiplier();

            // Apply ascension click multipliers
            if (gameState.ascensionUpgrades.click_divine) {
                effectiveClickPower *= ascensionUpgradeDefinitions.click_divine.clickMultiplier;
            }
            if (gameState.ascensionUpgrades.click_cosmic) {
                effectiveClickPower *= ascensionUpgradeDefinitions.click_cosmic.clickMultiplier;
            }

            // Apply global ascension multiplier
            effectiveClickPower *= getAscensionMultiplier();

            // Apply prestige++ click upgrades
            if (gameState.prestigeUpgrades.eternal_clicker) {
                effectiveClickPower *= prestigeUpgradeDefinitions.eternal_clicker.clickMultiplier;
            }
            if (gameState.prestigeUpgrades.cookie_god) {
                effectiveClickPower *= prestigeUpgradeDefinitions.cookie_god.godMultiplier;
            }

            const cookiesGained = effectiveClickPower * clicks;
            gameState.cookies += cookiesGained;
            gameState.totalClicks += clicks;
            gameState.stats.totalClicks += clicks;
            gameState.stats.totalCookies += cookiesGained;

            console.log('Cookies gagn√©s:', cookiesGained, 'Total:', gameState.cookies);

            // Visual effect - seulement si event a les coordonn√©es
            if (event && event.clientX !== undefined && event.clientY !== undefined) {
                createClickEffect(event.clientX, event.clientY, cookiesGained);
            }

            updateUI();
        }

        function createClickEffect(x, y, value) {
            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = '+' + formatNumber(value) + ' üç™';

            // Position avec un peu de variation al√©atoire
            const offsetX = (Math.random() - 0.5) * 40;
            const offsetY = (Math.random() - 0.5) * 40;

            effect.style.left = (x + offsetX) + 'px';
            effect.style.top = (y + offsetY) + 'px';

            document.body.appendChild(effect);

            setTimeout(() => effect.remove(), 1500);
        }

        function getGeneratorCost(type) {
            const def = generatorDefinitions[type];
            const count = gameState.generators[type] || 0;
            let cost = def.baseCost * Math.pow(def.costMultiplier, count);

            // Apply prestige cost reduction
            if (gameState.prestigeUpgrades.cheaper_gens) {
                cost *= prestigeUpgradeDefinitions.cheaper_gens.costReduction;
            }

            // Apply ascension cost reduction
            if (gameState.ascensionUpgrades.cheaper_divine) {
                cost *= ascensionUpgradeDefinitions.cheaper_divine.costReduction;
            }

            return Math.floor(cost);
        }

        function buyGenerator(type) {
            const cost = getGeneratorCost(type);

            if (gameState.cookies >= cost) {
                gameState.cookies -= cost;
                gameState.generators[type] = (gameState.generators[type] || 0) + 1;

                console.log('G√©n√©rateur achet√©:', type, 'Count:', gameState.generators[type]);

                updateProduction();
                console.log('Production par seconde:', gameState.cookiesPerSecond);

                updateUI();
                saveGame();
            }
        }

        function buyUpgrade(id) {
            const upgrade = upgradeDefinitions[id];

            // Check if already bought
            if (gameState.upgrades[id]) return;

            // Check requirements
            if (upgrade.requires) {
                const hasRequirements = upgrade.requires.every(req => gameState.upgrades[req]);
                if (!hasRequirements) return;
            }

            if (gameState.cookies >= upgrade.baseCost) {
                gameState.cookies -= upgrade.baseCost;
                gameState.upgrades[id] = true;

                if (upgrade.effect) upgrade.effect();

                updateProduction();
                updateUI();
                saveGame();
            }
        }

        function updateProduction() {
            let total = 0;

            console.log('=== CALCUL PRODUCTION ===');

            // Calculate base production from generators
            Object.entries(gameState.generators).forEach(([type, count]) => {
                const def = generatorDefinitions[type];
                const production = def.baseProduction * count;
                console.log(`${type}: ${count} x ${def.baseProduction} = ${production}`);
                total += production;
            });

            console.log('Total AVANT boosts:', total);

            // Apply upgrade multipliers
            if (gameState.upgrades.auto_boost) {
                total *= upgradeDefinitions.auto_boost.multiplier;
                console.log('Boost x1.5 appliqu√©');
            }
            if (gameState.upgrades.auto_boost_2) {
                total *= upgradeDefinitions.auto_boost_2.multiplier;
                console.log('Boost x2 appliqu√©');
            }

            // Apply prestige multiplier (global)
            const prestigeMulti = getPrestigeMultiplier();
            if (prestigeMulti > 1) {
                total *= prestigeMulti;
                console.log(`Prestige multiplier x${prestigeMulti.toFixed(1)} appliqu√©`);
            }

            // Apply prestige production upgrades
            if (gameState.prestigeUpgrades.prod_boost_1) {
                total *= prestigeUpgradeDefinitions.prod_boost_1.multiplier;
                console.log('Prestige Boost Prod I x1.5 appliqu√©');
            }
            if (gameState.prestigeUpgrades.prod_boost_2) {
                total *= prestigeUpgradeDefinitions.prod_boost_2.multiplier;
                console.log('Prestige Boost Prod II x2 appliqu√©');
            }
            if (gameState.prestigeUpgrades.prod_boost_3) {
                total *= prestigeUpgradeDefinitions.prod_boost_3.multiplier;
                console.log('Prestige Boost Prod III x3 appliqu√©');
            }

            // Apply ascension multiplier (global)
            const ascensionMulti = getAscensionMultiplier();
            if (ascensionMulti > 1) {
                total *= ascensionMulti;
                console.log(`Ascension multiplier x${ascensionMulti} appliqu√©`);
            }

            // Apply ascension production upgrades
            if (gameState.ascensionUpgrades.prod_divine) {
                total *= ascensionUpgradeDefinitions.prod_divine.multiplier;
                console.log('Ascension Prod Divine x3 appliqu√©');
            }
            if (gameState.ascensionUpgrades.prod_cosmic) {
                total *= ascensionUpgradeDefinitions.prod_cosmic.multiplier;
                console.log('Ascension Prod Cosmic x5 appliqu√©');
            }

            // Apply prestige++ upgrades
            if (gameState.prestigeUpgrades.cookie_titan) {
                total *= prestigeUpgradeDefinitions.cookie_titan.multiplier;
                console.log('Cookie Titan x5 appliqu√©');
            }
            if (gameState.prestigeUpgrades.cookie_god) {
                total *= prestigeUpgradeDefinitions.cookie_god.godMultiplier;
                console.log('Cookie God x10 appliqu√©');
            }

            // Apply dragon bonus
            const dragonBonus = getDragonBonus();
            if (dragonBonus > 1) {
                total *= dragonBonus;
                console.log(`Dragon bonus x${dragonBonus.toFixed(2)} appliqu√©`);
            }

            // Apply Pantheon bonuses
            const pantheonProdBonus = getPantheonBonus('production');
            if (pantheonProdBonus > 1) {
                total *= pantheonProdBonus;
                console.log(`Pantheon production bonus x${pantheonProdBonus.toFixed(2)} appliqu√©`);
            }
            const pantheonGenBonus = getPantheonBonus('generator');
            if (pantheonGenBonus > 1) {
                total *= pantheonGenBonus;
                console.log(`Pantheon generator bonus x${pantheonGenBonus.toFixed(2)} appliqu√©`);
            }

            // Apply Minion bonuses
            const minionProdBonus = getMinionBonus('production');
            if (minionProdBonus > 1) {
                total *= minionProdBonus;
                console.log(`Minion production bonus x${minionProdBonus.toFixed(2)} appliqu√©`);
            }
            const minionGenBonus = getMinionBonus('generator');
            if (minionGenBonus > 1) {
                total *= minionGenBonus;
                console.log(`Minion generator bonus x${minionGenBonus.toFixed(2)} appliqu√©`);
            }

            // Apply Garden bonuses
            const gardenData = getGardenBonus('production');
            if (gardenData.bonus > 1) {
                total *= gardenData.bonus;
                console.log(`Garden production bonus x${gardenData.bonus.toFixed(2)} appliqu√©`);
            }
            if (gardenData.cookiesPerSec > 0) {
                total += gardenData.cookiesPerSec;
                console.log(`Garden cookies/sec +${gardenData.cookiesPerSec} appliqu√©`);
            }

            // Apply time acceleration from Time Bender minion
            const timeBonus = getMinionBonus('time');
            if (timeBonus > 1) {
                total *= timeBonus;
                console.log(`Time Bender bonus x${timeBonus.toFixed(2)} appliqu√©`);
            }

            gameState.cookiesPerSecond = total;
            console.log('Production FINALE par seconde:', total);
            console.log('=========================');
        }

        function updateUI() {
            // Update header
            const scoreEl = document.getElementById('scoreDisplay');
            if (scoreEl) {
                scoreEl.textContent = formatNumber(gameState.cookies);
            }

            const perSecondEl = document.getElementById('perSecond');
            if (perSecondEl) {
                perSecondEl.textContent = '+' + formatNumber(gameState.cookiesPerSecond) + '/sec';
            }

            // Calculate effective click power (same calculation as in handleClick)
            let clicks = 1;
            let effectiveClickPower = gameState.clickPower;

            // Multi-click upgrades
            if (gameState.upgrades.multi_click) clicks *= upgradeDefinitions.multi_click.clickMultiplier;
            if (gameState.upgrades.multi_click_2) clicks *= upgradeDefinitions.multi_click_2.clickMultiplier;

            // Apply prestige click multipliers
            if (gameState.prestigeUpgrades.click_boost_1) {
                effectiveClickPower *= prestigeUpgradeDefinitions.click_boost_1.clickMultiplier;
            }
            if (gameState.prestigeUpgrades.click_boost_2) {
                effectiveClickPower *= prestigeUpgradeDefinitions.click_boost_2.clickMultiplier;
            }

            // Apply global prestige multiplier
            effectiveClickPower *= getPrestigeMultiplier();

            const totalClickPower = effectiveClickPower * clicks;

            const perClickDisplayEl = document.getElementById('perClickDisplay');
            if (perClickDisplayEl) {
                perClickDisplayEl.textContent = 'Par clic: +' + formatNumber(totalClickPower) + ' üç™';
            }

            // Update stats
            const totalClicksEl = document.getElementById('totalClicks');
            if (totalClicksEl) {
                totalClicksEl.textContent = formatNumber(gameState.stats.totalClicks);
            }

            const perClickEl = document.getElementById('perClick');
            if (perClickEl) {
                perClickEl.textContent = formatNumber(gameState.clickPower);
            }

            const perSecStatsEl = document.getElementById('perSecStats');
            if (perSecStatsEl) {
                perSecStatsEl.textContent = formatNumber(gameState.cookiesPerSecond);
            }

            const totalGens = Object.values(gameState.generators).reduce((a, b) => a + b, 0);
            const totalGensEl = document.getElementById('totalGenerators');
            if (totalGensEl) {
                totalGensEl.textContent = totalGens;
            }

            // Update upgrades list
            renderUpgrades();

            // Update generators list
            renderGenerators();

            // Update prestige info
            const prestigePointsEl = document.getElementById('prestigePointsDisplay');
            if (prestigePointsEl) {
                prestigePointsEl.textContent = gameState.prestigePoints;
            }

            const prestigeMultiEl = document.getElementById('prestigeMultiDisplay');
            if (prestigeMultiEl) {
                prestigeMultiEl.textContent = 'x' + getPrestigeMultiplier().toFixed(1);
            }

            const lifetimeCookiesEl = document.getElementById('lifetimeCookies');
            if (lifetimeCookiesEl) {
                // Afficher les cookies depuis l'ascension pour le syst√®me de prestige
                const cookiesSinceAscension = gameState.stats.totalCookies - gameState.lifetimeCookiesAtAscension;
                lifetimeCookiesEl.textContent = formatNumber(cookiesSinceAscension);
            }

            const nextPrestigeEl = document.getElementById('nextPrestigeInfo');
            if (nextPrestigeEl) {
                if (canPrestige()) {
                    const newPoints = calculatePrestigePoints() - gameState.totalPrestigePointsEarned;
                    nextPrestigeEl.textContent = `‚ú® +${newPoints} point${newPoints > 1 ? 's' : ''} disponible${newPoints > 1 ? 's' : ''}!`;
                    nextPrestigeEl.style.color = '#4ade80';
                } else {
                    const cookiesSinceAscension = gameState.stats.totalCookies - gameState.lifetimeCookiesAtAscension;
                    const divider = gameState.ascensionUpgrades.prestige_boost ? 10000000 : 20000000;
                    const nextMilestone = (gameState.totalPrestigePointsEarned + 1) * divider;
                    const remaining = nextMilestone - cookiesSinceAscension;
                    nextPrestigeEl.textContent = `Prochain: ${formatNumber(remaining)} restants`;
                    nextPrestigeEl.style.color = 'rgba(255, 215, 0, 0.8)';
                }
            }

            const prestigeButtonEl = document.getElementById('prestigeButton');
            if (prestigeButtonEl) {
                if (canPrestige()) {
                    prestigeButtonEl.style.opacity = '1';
                    prestigeButtonEl.style.cursor = 'pointer';
                } else {
                    prestigeButtonEl.style.opacity = '0.5';
                    prestigeButtonEl.style.cursor = 'not-allowed';
                }
            }

            // Update ascension info
            const ascensionSection = document.getElementById('ascensionSection');
            if (ascensionSection) {
                // Show/hide ascension section - Afficher d√®s qu'on a 5+ prestiges ou des ascensions
                if (gameState.totalPrestiges >= 5 || gameState.totalAscensions > 0 || canAscend()) {
                    ascensionSection.style.display = 'block';
                } else {
                    ascensionSection.style.display = 'none';
                }

                const ascensionTokensEl = document.getElementById('ascensionTokensDisplay');
                if (ascensionTokensEl) {
                    ascensionTokensEl.textContent = gameState.ascensionTokens;
                }

                const ascensionMultiEl = document.getElementById('ascensionMultiDisplay');
                if (ascensionMultiEl) {
                    ascensionMultiEl.textContent = 'x' + getAscensionMultiplier();
                }

                const ascensionButtonEl = document.getElementById('ascensionButton');
                if (ascensionButtonEl) {
                    if (canAscend()) {
                        ascensionButtonEl.style.opacity = '1';
                        ascensionButtonEl.style.cursor = 'pointer';
                    } else {
                        ascensionButtonEl.style.opacity = '0.5';
                        ascensionButtonEl.style.cursor = 'not-allowed';
                    }
                }
            }

            // Update dragon & minions UI
            updateDragonUI();
            updateMinionUI();

            // Update advanced systems buttons visibility
            const pantheonBtn = document.getElementById('pantheonButton');
            if (pantheonBtn) {
                pantheonBtn.style.display = (gameState.totalAscensions >= 1) ? 'block' : 'none';
            }

            const gardenBtn = document.getElementById('gardenButton');
            if (gardenBtn) {
                gardenBtn.style.display = (gameState.totalPrestiges >= 5) ? 'block' : 'none';
            }

            const stockMarketBtn = document.getElementById('stockMarketButton');
            if (stockMarketBtn) {
                stockMarketBtn.style.display = (gameState.totalPrestiges >= 7) ? 'block' : 'none';
            }

            const minionsBtn = document.getElementById('minionsButton');
            if (minionsBtn) {
                minionsBtn.style.display = (gameState.totalPrestiges >= 3) ? 'block' : 'none';
            }
        }

        function renderUpgrades() {
            const container = document.getElementById('upgradesList');
            let html = '';

            Object.entries(upgradeDefinitions).forEach(([id, upgrade]) => {
                // Check unlock condition for prestige++ upgrades
                if (upgrade.unlockCondition && !upgrade.unlockCondition()) {
                    return; // Skip locked upgrades
                }

                const owned = gameState.upgrades[id];
                const canAfford = gameState.cookies >= upgrade.baseCost;
                const hasRequirements = !upgrade.requires || upgrade.requires.every(req => gameState.upgrades[req]);

                if (owned || hasRequirements) {
                    html += `
                        <div class="upgrade-item ${owned ? 'locked' : (!canAfford ? 'locked' : '')}"
                             data-upgrade-id="${id}" ${!owned ? 'data-can-buy="true"' : ''}>
                            <div class="item-header">
                                <div class="item-name">${upgrade.icon} ${upgrade.name}</div>
                            </div>
                            <div class="item-description">${upgrade.description}</div>
                            <div class="item-footer">
                                ${owned ?
                                    '<span style="color: #4ade80; font-weight: 700;">‚úÖ ACHET√â</span>' :
                                    `<span class="item-cost">üç™ ${formatNumber(upgrade.baseCost)}</span>`
                                }
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html || '<div style="text-align: center; opacity: 0.5;">Aucune am√©lioration disponible</div>';

            // Add click listeners to upgrades
            container.querySelectorAll('.upgrade-item[data-can-buy="true"]').forEach(item => {
                item.addEventListener('click', () => {
                    buyUpgrade(item.dataset.upgradeId);
                });
            });
        }

        function renderGenerators() {
            const container = document.getElementById('generatorsList');
            let html = '';

            Object.entries(generatorDefinitions).forEach(([type, def]) => {
                // Check unlock condition
                if (def.unlockCondition && !def.unlockCondition()) {
                    return; // Skip locked generators
                }

                const count = gameState.generators[type] || 0;
                const cost = getGeneratorCost(type);
                const canAfford = gameState.cookies >= cost;

                // Production par unit√© et production totale
                let productionPerUnit = def.baseProduction;

                // Appliquer les boosts aux g√©n√©rateurs
                if (gameState.upgrades.auto_boost) {
                    productionPerUnit *= upgradeDefinitions.auto_boost.multiplier;
                }
                if (gameState.upgrades.auto_boost_2) {
                    productionPerUnit *= upgradeDefinitions.auto_boost_2.multiplier;
                }

                const totalProduction = productionPerUnit * count;

                html += `
                    <div class="generator-item ${!canAfford ? 'locked' : ''}" data-generator-type="${type}">
                        <div class="item-header">
                            <div class="item-name">${def.icon} ${def.name}</div>
                            <div class="item-count">${count}</div>
                        </div>
                        <div class="item-description">${def.description}</div>
                        <div class="item-footer">
                            <span class="item-cost">üç™ ${formatNumber(cost)}</span>
                            <span class="item-production" style="display: flex; flex-direction: column; align-items: flex-end; gap: 2px;">
                                <span style="color: #4ade80;">Chaque: +${formatNumber(productionPerUnit)}/s</span>
                                ${count > 0 ? `<span style="color: #fbbf24; font-size: 0.85em;">Total: +${formatNumber(totalProduction)}/s</span>` : ''}
                            </span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Add click listeners to generators
            container.querySelectorAll('.generator-item').forEach(item => {
                item.addEventListener('click', () => {
                    buyGenerator(item.dataset.generatorType);
                });
            });
        }

        // ==================== DRAGON & MINIONS ====================
        function getDragonBonus() {
            const bonuses = [1, 1, 1.1, 1.25, 1.5, 2, 2.5, 3];
            return bonuses[gameState.dragonLevel] || 1;
        }

        function feedDragon() {
            const cost = Math.floor(gameState.cookies * 0.01); // 1% of current cookies
            if (cost > 0 && gameState.cookies >= cost) {
                gameState.cookies -= cost;
                gameState.dragonFed += cost;

                // Check for level up
                const thresholds = [0, 0, 10000000, 50000000, 200000000, 1000000000, 5000000000, 20000000000];
                for (let i = thresholds.length - 1; i >= 0; i--) {
                    if (gameState.dragonFed >= thresholds[i]) {
                        if (gameState.dragonLevel < i) {
                            gameState.dragonLevel = i;
                            const names = ['', '≈íuf', 'B√©b√© Dragon', 'Jeune Dragon', 'Dragon Ado', 'Dragon Adulte', 'Dragon Ancien', 'Dragon L√©gendaire'];
                            alert(`üêâ Ton dragon a √©volu√©!\n\n${names[i]}\nBonus: x${getDragonBonus().toFixed(2)}`);
                        }
                        break;
                    }
                }

                updateProduction();
                updateUI();
                saveGame();
            }
        }

        function getAutoClickerCost() {
            return Math.floor(1000000 * Math.pow(2, gameState.autoClickerLevel));
        }

        function buyAutoClicker() {
            const cost = getAutoClickerCost();
            if (gameState.cookies >= cost) {
                gameState.cookies -= cost;
                gameState.autoClickerLevel++;
                updateUI();
                saveGame();
            }
        }

        function updateDragonUI() {
            const dragonSection = document.getElementById('dragonSection');
            if (!dragonSection) return;

            if (gameState.dragonLevel > 0) {
                dragonSection.style.display = 'block';

                const icons = ['', 'ü•ö', 'üê£', 'üêâ', 'üê≤', 'üî•', '‚ö°', 'üåü'];
                const names = ['', '≈íuf Myst√©rieux', 'B√©b√© Dragon', 'Jeune Dragon', 'Dragon Ado', 'Dragon Adulte', 'Dragon Ancien', 'Dragon L√©gendaire'];

                const iconEl = document.getElementById('dragonIcon');
                const nameEl = document.getElementById('dragonName');
                const bonusEl = document.getElementById('dragonBonus');

                if (iconEl) iconEl.textContent = icons[gameState.dragonLevel] || 'ü•ö';
                if (nameEl) nameEl.textContent = names[gameState.dragonLevel] || 'Dragon';
                if (bonusEl) bonusEl.textContent = `Bonus: x${getDragonBonus().toFixed(2)}`;
            } else {
                dragonSection.style.display = 'none';
            }
        }

        function updateMinionUI() {
            const minionSection = document.getElementById('minionSection');
            if (!minionSection) return;

            // Unlock minions after 3 prestiges
            if (gameState.totalPrestiges >= 3) {
                minionSection.style.display = 'block';

                const levelEl = document.getElementById('autoClickerLevel');
                const costEl = document.getElementById('autoClickerCost');

                if (levelEl) levelEl.textContent = gameState.autoClickerLevel;
                if (costEl) costEl.textContent = formatNumber(getAutoClickerCost());
            } else {
                minionSection.style.display = 'none';
            }
        }

        // ==================== PANTHEON FUNCTIONS ====================
        function unlockPantheon() {
            if (gameState.totalAscensions >= 1) {
                gameState.pantheonUnlocked = true;
                return true;
            }
            return false;
        }

        function assignGodToSlot(godId, slotIndex) {
            if (!gameState.pantheonUnlocked) return;
            if (slotIndex < 0 || slotIndex > 2) return;

            // Check if god is already in another slot
            const currentSlot = gameState.pantheonSlots.indexOf(godId);
            if (currentSlot !== -1) {
                gameState.pantheonSlots[currentSlot] = null;
            }

            gameState.pantheonSlots[slotIndex] = godId;
            updateProduction();
            updateUI();
            saveGame();
        }

        function removeGodFromSlot(slotIndex) {
            if (slotIndex >= 0 && slotIndex <= 2) {
                gameState.pantheonSlots[slotIndex] = null;
                updateProduction();
                updateUI();
                saveGame();
            }
        }

        function getPantheonBonus(type) {
            let bonus = 1;
            gameState.pantheonSlots.forEach(godId => {
                if (godId && pantheonGods[godId]) {
                    const god = pantheonGods[godId];
                    if (type === 'production' && god.productionBonus) bonus *= god.productionBonus;
                    if (type === 'click' && god.clickBonus) bonus *= god.clickBonus;
                    if (type === 'generator' && god.generatorBonus) bonus *= god.generatorBonus;
                    if (type === 'cost' && god.costReduction) bonus *= god.costReduction;
                    if (god.globalBonus) bonus *= god.globalBonus;
                }
            });
            return bonus;
        }

        // ==================== GARDEN FUNCTIONS ====================
        function unlockGarden() {
            if (gameState.totalPrestiges >= 5) {
                gameState.gardenUnlocked = true;
                return true;
            }
            return false;
        }

        function plantSeed(plotIndex, plantId) {
            if (!gameState.gardenUnlocked) return;
            if (plotIndex < 0 || plotIndex >= 36) return;
            if (gameState.gardenPlots[plotIndex] !== null) return;

            const plant = gardenPlants[plantId];
            if (!plant) return;
            if (gameState.cookies < plant.cost) return;

            gameState.cookies -= plant.cost;
            gameState.gardenPlots[plotIndex] = {
                id: plantId,
                age: 0,
                mature: false
            };

            updateUI();
            saveGame();
        }

        function harvestPlot(plotIndex) {
            if (plotIndex < 0 || plotIndex >= 36) return;
            const plot = gameState.gardenPlots[plotIndex];
            if (!plot || !plot.mature) return;

            const plant = gardenPlants[plot.id];
            // Give some reward
            gameState.cookies += plant.cost * 2;
            gameState.gardenPlots[plotIndex] = null;

            updateUI();
            saveGame();
        }

        function tickGarden() {
            if (!gameState.gardenUnlocked) return;

            gameState.gardenTicks++;

            gameState.gardenPlots.forEach((plot, index) => {
                if (plot && !plot.mature) {
                    plot.age++;
                    const plant = gardenPlants[plot.id];
                    if (plot.age >= plant.growTime) {
                        plot.mature = true;
                    }
                }
            });

            // Check for mutations every 10 ticks
            if (gameState.gardenTicks % 10 === 0) {
                checkGardenMutations();
            }
        }

        function checkGardenMutations() {
            // Simple mutation check
            for (let i = 0; i < 36; i++) {
                if (gameState.gardenPlots[i] === null) {
                    // Check adjacent plots for mutation combos
                    const adjacentPlants = getAdjacentPlants(i);
                    Object.entries(gardenPlants).forEach(([plantId, plant]) => {
                        if (plant.mutations && plant.mutations.length > 0) {
                            plant.mutations.forEach(combo => {
                                if (combo.every(reqPlant => adjacentPlants.includes(reqPlant))) {
                                    if (Math.random() < 0.01) { // 1% chance
                                        gameState.gardenPlots[i] = {
                                            id: plantId,
                                            age: 0,
                                            mature: false
                                        };
                                    }
                                }
                            });
                        }
                    });
                }
            }
        }

        function getAdjacentPlants(index) {
            const row = Math.floor(index / 6);
            const col = index % 6;
            const adjacent = [];

            // Check all 8 directions
            for (let dr = -1; dr <= 1; dr++) {
                for (let dc = -1; dc <= 1; dc++) {
                    if (dr === 0 && dc === 0) continue;
                    const newRow = row + dr;
                    const newCol = col + dc;
                    if (newRow >= 0 && newRow < 6 && newCol >= 0 && newCol < 6) {
                        const adjIndex = newRow * 6 + newCol;
                        const plot = gameState.gardenPlots[adjIndex];
                        if (plot && plot.mature) {
                            adjacent.push(plot.id);
                        }
                    }
                }
            }

            return adjacent;
        }

        function getGardenBonus(type) {
            let bonus = 1;
            let cookiesPerSec = 0;

            gameState.gardenPlots.forEach(plot => {
                if (plot && plot.mature) {
                    const plant = gardenPlants[plot.id];
                    if (plant.productionBonus && type === 'production') bonus *= plant.productionBonus;
                    if (plant.cookiesPerSecond) cookiesPerSec += plant.cookiesPerSecond;
                    if (plant.globalBonus) bonus *= plant.globalBonus;
                    if (plant.godBonus) bonus *= plant.godBonus;
                }
            });

            return { bonus, cookiesPerSec };
        }

        // ==================== STOCK MARKET FUNCTIONS ====================
        function unlockStockMarket() {
            if (gameState.totalPrestiges >= 7) {
                gameState.stockMarketUnlocked = true;
                return true;
            }
            return false;
        }

        function buyStock(stockId, amount = 1) {
            if (!gameState.stockMarketUnlocked) return;
            const stock = gameState.stocks[stockId];
            if (!stock) return;

            const currentPrice = stock.history[stock.history.length - 1];
            const totalCost = currentPrice * amount;

            if (gameState.stockCash >= totalCost) {
                gameState.stockCash -= totalCost;
                stock.shares += amount;
                updateUI();
                saveGame();
            }
        }

        function sellStock(stockId, amount = 1) {
            if (!gameState.stockMarketUnlocked) return;
            const stock = gameState.stocks[stockId];
            if (!stock || stock.shares < amount) return;

            const currentPrice = stock.history[stock.history.length - 1];
            const totalValue = currentPrice * amount;

            gameState.stockCash += totalValue;
            stock.shares -= amount;
            updateUI();
            saveGame();
        }

        function tickStockMarket() {
            if (!gameState.stockMarketUnlocked) return;

            Object.entries(gameState.stocks).forEach(([id, stock]) => {
                const lastPrice = stock.history[stock.history.length - 1];
                // Random walk with slight upward bias
                const change = (Math.random() - 0.48) * lastPrice * 0.1;
                const newPrice = Math.max(1, lastPrice + change);

                stock.history.push(newPrice);
                if (stock.history.length > 50) {
                    stock.history.shift(); // Keep only last 50 prices
                }
            });
        }

        // ==================== EXTENDED MINIONS ====================
        function getMinionCost(minionType) {
            const def = minionDefinitions[minionType];
            let level = 0;
            if (minionType === 'autoClicker') level = gameState.autoClickerLevel;
            else if (minionType === 'cookieBaker') level = gameState.cookieBakerLevel;
            else if (minionType === 'luckyFinder') level = gameState.luckyFinderLevel;
            else if (minionType === 'generatorBooster') level = gameState.generatorBoosterLevel;
            else if (minionType === 'timeBender') level = gameState.timeBenderLevel;

            return Math.floor(def.baseCost * Math.pow(def.costMultiplier, level));
        }

        function buyMinion(minionType) {
            const cost = getMinionCost(minionType);
            if (gameState.cookies < cost) return;

            gameState.cookies -= cost;

            if (minionType === 'autoClicker') gameState.autoClickerLevel++;
            else if (minionType === 'cookieBaker') gameState.cookieBakerLevel++;
            else if (minionType === 'luckyFinder') gameState.luckyFinderLevel++;
            else if (minionType === 'generatorBooster') gameState.generatorBoosterLevel++;
            else if (minionType === 'timeBender') gameState.timeBenderLevel++;

            updateProduction();
            updateUI();
            saveGame();
        }

        function getMinionBonus(type) {
            let bonus = 1;

            if (type === 'production' && gameState.cookieBakerLevel > 0) {
                bonus *= (1 + gameState.cookieBakerLevel * minionDefinitions.cookieBaker.productionBonus);
            }
            if (type === 'generator' && gameState.generatorBoosterLevel > 0) {
                bonus *= (1 + gameState.generatorBoosterLevel * minionDefinitions.generatorBooster.generatorBonus);
            }
            if (type === 'time' && gameState.timeBenderLevel > 0) {
                bonus *= (1 + gameState.timeBenderLevel * minionDefinitions.timeBender.timeBonus);
            }

            return bonus;
        }

        let gameLoopCounter = 0;
        function gameLoop() {
            // Unlock systems automatically
            unlockPantheon();
            unlockGarden();
            unlockStockMarket();

            // Auto-clicker
            if (gameState.autoClickerLevel > 0) {
                const clicks = gameState.autoClickerLevel * 0.1; // 0.1 click per second per level
                if (Math.random() < clicks / 10) { // Probabilistic clicking
                    handleClick({clientX: 0, clientY: 0}); // Silent click
                }
            }

            // Tick garden every second
            gameLoopCounter++;
            if (gameLoopCounter % 10 === 0) {
                tickGarden();
            }

            // Tick stock market every 10 seconds
            if (gameLoopCounter % 100 === 0) {
                tickStockMarket();
            }

            if (gameState.cookiesPerSecond > 0) {
                const oldCookies = gameState.cookies;
                gameState.cookies += gameState.cookiesPerSecond / 10; // Update 10 times per second
                gameState.stats.totalCookies += gameState.cookiesPerSecond / 10;

                // Log tous les 10 ticks (1 seconde)
                gameLoopCounter++;
                if (gameLoopCounter % 10 === 0) {
                    console.log(`[GameLoop] Cookies: ${oldCookies.toFixed(2)} -> ${gameState.cookies.toFixed(2)} (+${(gameState.cookies - oldCookies).toFixed(2)}) | Production: ${gameState.cookiesPerSecond}/sec | Lifetime: ${gameState.stats.totalCookies.toFixed(2)}`);
                }

                // Update display
                const scoreEl = document.getElementById('scoreDisplay');
                if (scoreEl) {
                    scoreEl.textContent = formatNumber(gameState.cookies);
                }

                const perSecondEl = document.getElementById('perSecond');
                if (perSecondEl) {
                    perSecondEl.textContent = '+' + formatNumber(gameState.cookiesPerSecond) + '/sec';
                }

                // Update lifetime cookies display
                const lifetimeCookiesEl = document.getElementById('lifetimeCookies');
                if (lifetimeCookiesEl) {
                    const cookiesSinceAscension = gameState.stats.totalCookies - gameState.lifetimeCookiesAtAscension;
                    lifetimeCookiesEl.textContent = formatNumber(cookiesSinceAscension);
                }

                // Update prestige info
                const nextPrestigeEl = document.getElementById('nextPrestigeInfo');
                if (nextPrestigeEl) {
                    if (canPrestige()) {
                        const newPoints = calculatePrestigePoints() - gameState.totalPrestigePointsEarned;
                        nextPrestigeEl.textContent = `‚ú® +${newPoints} point${newPoints > 1 ? 's' : ''} disponible${newPoints > 1 ? 's' : ''}!`;
                        nextPrestigeEl.style.color = '#4ade80';
                    } else {
                        const cookiesSinceAscension = gameState.stats.totalCookies - gameState.lifetimeCookiesAtAscension;
                        const divider = gameState.ascensionUpgrades.prestige_boost ? 10000000 : 20000000;
                        const nextMilestone = (gameState.totalPrestigePointsEarned + 1) * divider;
                        const remaining = nextMilestone - cookiesSinceAscension;
                        nextPrestigeEl.textContent = `Prochain: ${formatNumber(remaining)} restants`;
                        nextPrestigeEl.style.color = 'rgba(255, 215, 0, 0.8)';
                    }
                }

                // Update prestige button state
                const prestigeButtonEl = document.getElementById('prestigeButton');
                if (prestigeButtonEl) {
                    if (canPrestige()) {
                        prestigeButtonEl.style.opacity = '1';
                        prestigeButtonEl.style.cursor = 'pointer';
                    } else {
                        prestigeButtonEl.style.opacity = '0.5';
                        prestigeButtonEl.style.cursor = 'not-allowed';
                    }
                }
            }
        }

        function saveGame() {
            gameState.lastPlayTime = Date.now(); // Update last play time
            localStorage.setItem('cookieClickerSave', JSON.stringify(gameState));
        }

        function loadGame() {
            const save = localStorage.getItem('cookieClickerSave');
            if (save) {
                try {
                    Object.assign(gameState, JSON.parse(save));

                    // Migration de save pour les nouvelles features
                    // Ascension tracking
                    if (gameState.lifetimeCookiesAtAscension === undefined) {
                        gameState.lifetimeCookiesAtAscension = 0;
                    }

                    // Dragon
                    if (gameState.dragonLevel === undefined) {
                        gameState.dragonLevel = 0;
                        // Unlock dragon r√©troactivement si on a d√©j√† fait au moins 1 prestige
                        if (gameState.totalPrestiges >= 1) {
                            gameState.dragonLevel = 1;
                            console.log('üêâ Dragon d√©bloqu√© r√©troactivement!');
                        }
                    }
                    if (gameState.dragonFed === undefined) gameState.dragonFed = 0;

                    // Minions
                    if (gameState.cookieBakerLevel === undefined) gameState.cookieBakerLevel = 0;
                    if (gameState.luckyFinderLevel === undefined) gameState.luckyFinderLevel = 0;
                    if (gameState.generatorBoosterLevel === undefined) gameState.generatorBoosterLevel = 0;
                    if (gameState.timeBenderLevel === undefined) gameState.timeBenderLevel = 0;

                    // Pantheon
                    if (gameState.pantheonSlots === undefined) gameState.pantheonSlots = [null, null, null];
                    if (gameState.pantheonUnlocked === undefined) gameState.pantheonUnlocked = false;

                    // Garden
                    if (gameState.gardenUnlocked === undefined) gameState.gardenUnlocked = false;
                    if (gameState.gardenPlots === undefined) gameState.gardenPlots = Array(36).fill(null);
                    if (gameState.gardenTicks === undefined) gameState.gardenTicks = 0;

                    // Stock Market
                    if (gameState.stockMarketUnlocked === undefined) gameState.stockMarketUnlocked = false;
                    if (gameState.stocks === undefined) {
                        gameState.stocks = {
                            cookies: { shares: 0, history: [100] },
                            chocolate: { shares: 0, history: [50] },
                            sugar: { shares: 0, history: [25] },
                            butter: { shares: 0, history: [75] },
                            flour: { shares: 0, history: [30] },
                            vanilla: { shares: 0, history: [120] },
                            gold: { shares: 0, history: [200] }
                        };
                    }
                    if (gameState.stockCash === undefined) gameState.stockCash = 10000;

                    // Offline earnings
                    if (gameState.lastPlayTime === undefined) gameState.lastPlayTime = Date.now();
                    if (gameState.maxOfflineTime === undefined) gameState.maxOfflineTime = 7200;
                    if (gameState.offlineTimeUpgrades === undefined) gameState.offlineTimeUpgrades = {};

                    updateProduction();

                    // Calculate offline earnings AFTER updateProduction()
                    const offlineData = calculateOfflineEarnings();
                    if (offlineData && offlineData.cookiesEarned > 0) {
                        // Store offline data globally for the modal
                        window.offlineEarningsData = offlineData;

                        // Show modal after a short delay to let UI load
                        setTimeout(() => {
                            showOfflineEarningsModal(offlineData);
                        }, 500);
                    }
                } catch (e) {
                    console.error('Failed to load save:', e);
                }
            }
        }

        function resetGame() {
            if (confirm('√ätes-vous s√ªr de vouloir reset ? Toute progression sera perdue !')) {
                localStorage.removeItem('cookieClickerSave');
                location.reload();
            }
        }

        // ==================== PRESTIGE UI ====================
        function openPrestigeShop() {
            document.getElementById('prestigeShopModal').style.display = 'block';
            renderPrestigeUpgrades();
        }

        function closePrestigeShop() {
            document.getElementById('prestigeShopModal').style.display = 'none';
        }

        function renderPrestigeUpgrades() {
            const container = document.getElementById('prestigeUpgradesList');
            const modalPoints = document.getElementById('prestigePointsModal');

            if (modalPoints) {
                modalPoints.textContent = gameState.prestigePoints;
            }

            let html = '';

            Object.entries(prestigeUpgradeDefinitions).forEach(([id, upgrade]) => {
                // Check unlock for prestige++
                if (upgrade.unlockCondition && !upgrade.unlockCondition()) {
                    return;
                }

                const owned = gameState.prestigeUpgrades[id];
                const canAfford = gameState.prestigePoints >= upgrade.cost;
                const hasRequirements = !upgrade.requires || upgrade.requires.every(req => gameState.prestigeUpgrades[req]);

                if (owned || hasRequirements) {
                    html += `
                        <div class="upgrade-item ${owned ? 'locked' : (!canAfford ? 'locked' : '')}"
                             data-prestige-upgrade-id="${id}" ${!owned ? 'data-can-buy-prestige="true"' : ''} style="margin-bottom: 15px;">
                            <div class="item-header">
                                <div class="item-name">${upgrade.icon} ${upgrade.name}</div>
                            </div>
                            <div class="item-description">${upgrade.description}</div>
                            <div class="item-footer">
                                ${owned ?
                                    '<span style="color: #4ade80; font-weight: 700;">‚úÖ ACHET√â</span>' :
                                    `<span class="item-cost" style="color: #ffd700;">‚≠ê ${upgrade.cost} Points</span>`
                                }
                            </div>
                        </div>
                    `;
                }
            });

            // Add offline time upgrades section if unlocked
            if (gameState.totalPrestiges >= 3) {
                html += '<div style="margin: 30px 0; padding: 15px; background: rgba(251, 191, 36, 0.2); border-radius: 10px; text-align: center;"><h3 style="color: #fbbf24; margin: 0;">‚è∞ TEMPS HORS LIGNE</h3><p style="color: rgba(255,255,255,0.8); font-size: 0.9em; margin: 5px 0 0 0;">Actuellement: ' + formatTime(getMaxOfflineTime()) + '</p></div>';

                Object.entries(offlineTimeUpgradeDefinitions).forEach(([id, upgrade]) => {
                    // Check unlock condition
                    if (upgrade.unlockCondition && !upgrade.unlockCondition()) {
                        return; // Skip if not unlocked yet
                    }

                    const owned = gameState.offlineTimeUpgrades[id];
                    const canAfford = gameState.prestigePoints >= upgrade.cost;
                    const hasRequirements = !upgrade.requires || upgrade.requires.every(req => gameState.offlineTimeUpgrades[req]);

                    if (owned || hasRequirements) {
                        const hoursMax = upgrade.maxTime / 3600;
                        html += `
                            <div class="upgrade-item ${owned ? 'locked' : (!canAfford ? 'locked' : '')}"
                                 data-offline-upgrade-id="${id}" ${!owned ? 'data-can-buy-offline="true"' : ''} style="margin-bottom: 15px;">
                                <div class="item-header">
                                    <div class="item-name">${upgrade.icon} ${upgrade.name}</div>
                                </div>
                                <div class="item-description">${upgrade.description} (${hoursMax}h max)</div>
                                <div class="item-footer">
                                    ${owned ?
                                        '<span style="color: #4ade80; font-weight: 700;">‚úÖ ACHET√â</span>' :
                                        `<span class="item-cost" style="color: #ffd700;">‚≠ê ${upgrade.cost} Points</span>`
                                    }
                                </div>
                            </div>
                        `;
                    }
                });
            }

            container.innerHTML = html || '<div style="text-align: center; opacity: 0.5; padding: 20px;">Aucune am√©lioration disponible</div>';

            // Add click listeners for prestige upgrades
            container.querySelectorAll('.upgrade-item[data-can-buy-prestige="true"]').forEach(item => {
                item.addEventListener('click', () => {
                    buyPrestigeUpgrade(item.dataset.prestigeUpgradeId);
                    renderPrestigeUpgrades();
                });
            });

            // Add click listeners for offline upgrades
            container.querySelectorAll('.upgrade-item[data-can-buy-offline="true"]').forEach(item => {
                item.addEventListener('click', () => {
                    buyOfflineTimeUpgrade(item.dataset.offlineUpgradeId);
                    renderPrestigeUpgrades();
                });
            });
        }

        // ==================== ASCENSION UI ====================
        function openAscensionShop() {
            document.getElementById('ascensionShopModal').style.display = 'block';
            renderAscensionUpgrades();
        }

        function closeAscensionShop() {
            document.getElementById('ascensionShopModal').style.display = 'none';
        }

        function renderAscensionUpgrades() {
            const container = document.getElementById('ascensionUpgradesList');
            const modalTokens = document.getElementById('ascensionTokensModal');

            if (modalTokens) {
                modalTokens.textContent = gameState.ascensionTokens;
            }

            let html = '';

            Object.entries(ascensionUpgradeDefinitions).forEach(([id, upgrade]) => {
                const owned = gameState.ascensionUpgrades[id];
                const canAfford = gameState.ascensionTokens >= upgrade.cost;
                const hasRequirements = !upgrade.requires || upgrade.requires.every(req => gameState.ascensionUpgrades[req]);

                if (owned || hasRequirements) {
                    html += `
                        <div class="upgrade-item ${owned ? 'locked' : (!canAfford ? 'locked' : '')}"
                             data-ascension-upgrade-id="${id}" ${!owned ? 'data-can-buy-ascension="true"' : ''} style="margin-bottom: 15px;">
                            <div class="item-header">
                                <div class="item-name">${upgrade.icon} ${upgrade.name}</div>
                            </div>
                            <div class="item-description">${upgrade.description}</div>
                            <div class="item-footer">
                                ${owned ?
                                    '<span style="color: #4ade80; font-weight: 700;">‚úÖ ACHET√â</span>' :
                                    `<span class="item-cost" style="color: #a78bfa;">üåü ${upgrade.cost} Jetons</span>`
                                }
                            </div>
                        </div>
                    `;
                }
            });

            container.innerHTML = html || '<div style="text-align: center; opacity: 0.5; padding: 20px;">Aucune am√©lioration disponible</div>';

            // Add click listeners
            container.querySelectorAll('.upgrade-item[data-can-buy-ascension="true"]').forEach(item => {
                item.addEventListener('click', () => {
                    buyAscensionUpgrade(item.dataset.ascensionUpgradeId);
                    renderAscensionUpgrades();
                });
            });
        }

        // ==================== PANTHEON UI ====================
        function openPantheon() {
            if (!gameState.pantheonUnlocked) {
                alert('üîí Panth√©on d√©bloqu√© apr√®s la 1√®re Ascension!');
                return;
            }
            document.getElementById('pantheonModal').style.display = 'block';
            renderPantheon();
        }

        function closePantheon() {
            document.getElementById('pantheonModal').style.display = 'none';
        }

        function renderPantheon() {
            // Render slots
            for (let i = 0; i < 3; i++) {
                const slot = document.getElementById(`godSlot${i}`);
                const godId = gameState.pantheonSlots[i];
                if (godId) {
                    const god = pantheonGods[godId];
                    slot.innerHTML = `
                        <div style="font-size: 2em;">${god.icon}</div>
                        <div style="color: #fff; font-weight: 700; margin-top: 5px;">${god.name}</div>
                        <div style="color: rgba(255,255,255,0.8); font-size: 0.8em; margin-top: 3px;">${god.description}</div>
                        <button style="margin-top: 8px; padding: 4px 8px; background: #ef4444; border: none; border-radius: 5px; color: #fff; cursor: pointer;">Retirer</button>
                    `;
                    slot.querySelector('button').addEventListener('click', () => {
                        removeGodFromSlot(i);
                        renderPantheon();
                    });
                } else {
                    slot.innerHTML = `<div style="color: #fff; font-size: 0.9em;">Slot ${i+1}: Vide</div>`;
                }
            }

            // Render gods list
            const container = document.getElementById('godsList');
            let html = '';
            Object.entries(pantheonGods).forEach(([id, god]) => {
                const isAssigned = gameState.pantheonSlots.includes(id);
                html += `
                    <div class="upgrade-item" data-god-id="${id}" style="cursor: pointer; opacity: ${isAssigned ? '0.5' : '1'};">
                        <div class="item-header">
                            <div class="item-name" style="font-size: 1.5em;">${god.icon}</div>
                            <div style="font-weight: 700; color: #fff;">${god.name}</div>
                        </div>
                        <div class="item-description" style="color: rgba(255,255,255,0.9);">${god.description}</div>
                        ${isAssigned ? '<div style="color: #4ade80; font-weight: 700; margin-top: 5px;">‚úÖ ASSIGN√â</div>' : ''}
                    </div>
                `;
            });
            container.innerHTML = html;

            // Add click listeners
            container.querySelectorAll('.upgrade-item').forEach(item => {
                item.addEventListener('click', () => {
                    const godId = item.dataset.godId;
                    const emptySlot = gameState.pantheonSlots.indexOf(null);
                    if (emptySlot !== -1) {
                        assignGodToSlot(godId, emptySlot);
                        renderPantheon();
                    } else {
                        alert('Tous les slots sont pleins! Retire un dieu d\'abord.');
                    }
                });
            });
        }

        // ==================== GARDEN UI ====================
        function openGarden() {
            if (!gameState.gardenUnlocked) {
                alert('üîí Jardin d√©bloqu√© apr√®s 5 prestiges!');
                return;
            }
            document.getElementById('gardenModal').style.display = 'block';
            renderGarden();
        }

        function closeGarden() {
            document.getElementById('gardenModal').style.display = 'none';
        }

        let selectedPlant = null;

        function renderGarden() {
            // Render grid
            const grid = document.getElementById('gardenGrid');
            let gridHtml = '';
            for (let i = 0; i < 36; i++) {
                const plot = gameState.gardenPlots[i];
                let content = '';
                let bgColor = 'rgba(139, 69, 19, 0.3)';
                if (plot) {
                    const plant = gardenPlants[plot.id];
                    content = `<div style="font-size: 2em;">${plant.icon}</div>`;
                    bgColor = plot.mature ? 'rgba(34, 197, 94, 0.3)' : 'rgba(251, 191, 36, 0.3)';
                }
                gridHtml += `
                    <div data-plot-index="${i}" style="
                        aspect-ratio: 1;
                        background: ${bgColor};
                        border: 2px solid rgba(255,255,255,0.3);
                        border-radius: 8px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        cursor: pointer;
                        transition: all 0.2s;
                    ">${content}</div>
                `;
            }
            grid.innerHTML = gridHtml;

            // Add click listeners to plots
            grid.querySelectorAll('[data-plot-index]').forEach(plotDiv => {
                const index = parseInt(plotDiv.dataset.plotIndex);
                plotDiv.addEventListener('click', () => {
                    const plot = gameState.gardenPlots[index];
                    if (plot && plot.mature) {
                        harvestPlot(index);
                        renderGarden();
                    } else if (!plot && selectedPlant) {
                        plantSeed(index, selectedPlant);
                        renderGarden();
                    }
                });
            });

            // Render seeds list
            const seedsList = document.getElementById('seedsList');
            let seedsHtml = '';
            Object.entries(gardenPlants).forEach(([id, plant]) => {
                const isSelected = selectedPlant === id;
                seedsHtml += `
                    <div class="upgrade-item" data-plant-id="${id}" style="margin-bottom: 10px; cursor: pointer; border: ${isSelected ? '2px solid #ffd700' : '2px solid transparent'};">
                        <div class="item-header">
                            <div class="item-name" style="font-size: 1.2em;">${plant.icon} ${plant.name}</div>
                        </div>
                        <div class="item-description" style="font-size: 0.8em; color: rgba(255,255,255,0.8);">${plant.description}</div>
                        <div class="item-footer">
                            <span style="color: #ffd700; font-weight: 700;">üç™ ${formatNumber(plant.cost)}</span>
                            <span style="color: #4ade80; font-size: 0.8em;">${plant.growTime}s</span>
                        </div>
                    </div>
                `;
            });
            seedsList.innerHTML = seedsHtml;

            // Add click listeners to seeds
            seedsList.querySelectorAll('[data-plant-id]').forEach(seedDiv => {
                seedDiv.addEventListener('click', () => {
                    selectedPlant = seedDiv.dataset.plantId;
                    renderGarden();
                });
            });
        }

        // ==================== STOCK MARKET UI ====================
        function openStockMarket() {
            if (!gameState.stockMarketUnlocked) {
                alert('üîí Stock Market d√©bloqu√© apr√®s 7 prestiges!');
                return;
            }
            document.getElementById('stockMarketModal').style.display = 'block';
            renderStockMarket();
        }

        function closeStockMarket() {
            document.getElementById('stockMarketModal').style.display = 'none';
        }

        function renderStockMarket() {
            const cashDisplay = document.getElementById('stockCashDisplay');
            if (cashDisplay) {
                cashDisplay.textContent = formatNumber(gameState.stockCash);
            }

            const container = document.getElementById('stocksList');
            let html = '';

            const stockNames = {
                cookies: 'Cookie Corp',
                chocolate: 'Choco Industries',
                sugar: 'Sugar Inc',
                butter: 'Butter Co',
                flour: 'Flour Corp',
                vanilla: 'Vanilla Ltd',
                gold: 'Golden Cookies'
            };

            Object.entries(gameState.stocks).forEach(([id, stock]) => {
                const currentPrice = stock.history[stock.history.length - 1];
                const prevPrice = stock.history[stock.history.length - 2] || currentPrice;
                const change = ((currentPrice - prevPrice) / prevPrice * 100).toFixed(2);
                const changeColor = change >= 0 ? '#4ade80' : '#ef4444';

                html += `
                    <div class="upgrade-item" style="margin-bottom: 15px;">
                        <div class="item-header">
                            <div class="item-name">${stockNames[id]}</div>
                            <div style="color: ${changeColor}; font-weight: 700;">${change >= 0 ? '+' : ''}${change}%</div>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                            <span style="color: #ffd700; font-weight: 700;">Prix: $${currentPrice.toFixed(2)}</span>
                            <span style="color: #4ade80; font-weight: 700;">D√©tenu: ${stock.shares}</span>
                        </div>
                        <div style="display: flex; gap: 8px; margin-top: 10px;">
                            <button data-stock-id="${id}" data-action="buy" style="flex: 1; padding: 8px; background: #10b981; border: none; border-radius: 6px; color: white; font-weight: 700; cursor: pointer;">Acheter</button>
                            <button data-stock-id="${id}" data-action="sell" style="flex: 1; padding: 8px; background: #ef4444; border: none; border-radius: 6px; color: white; font-weight: 700; cursor: pointer;">Vendre</button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Add click listeners
            container.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const stockId = btn.dataset.stockId;
                    const action = btn.dataset.action;
                    if (action === 'buy') {
                        buyStock(stockId, 1);
                    } else {
                        sellStock(stockId, 1);
                    }
                    renderStockMarket();
                });
            });
        }

        // ==================== OFFLINE EARNINGS UI ====================
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);

            if (hours > 0) {
                return `${hours}h ${minutes}m ${secs}s`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        function showOfflineEarningsModal(data) {
            // Populate modal with data
            document.getElementById('offlineTimeAway').textContent = formatTime(data.timeAway);
            document.getElementById('offlineTimeUsed').textContent = formatTime(data.timeUsed);
            document.getElementById('offlineCookiesEarned').textContent = formatNumber(data.cookiesEarned) + ' üç™';

            // Show warning if capped
            const warningEl = document.getElementById('offlineCapWarning');
            if (data.wasCapped) {
                warningEl.style.display = 'block';
                const hoursMax = data.maxTime / 3600;
                warningEl.innerHTML = `‚ö†Ô∏è Limite de ${hoursMax}h atteinte! Am√©liore ton temps hors ligne dans le Shop Prestige.`;
            } else {
                warningEl.style.display = 'none';
            }

            // Show modal
            document.getElementById('offlineEarningsModal').style.display = 'block';
        }

        function collectOfflineEarnings() {
            if (window.offlineEarningsData) {
                gameState.cookies += window.offlineEarningsData.cookiesEarned;
                gameState.stats.totalCookies += window.offlineEarningsData.cookiesEarned;
                window.offlineEarningsData = null;

                updateUI();
                saveGame();

                document.getElementById('offlineEarningsModal').style.display = 'none';
            }
        }

        // ==================== MINIONS UI ====================
        function openMinions() {
            if (gameState.totalPrestiges < 3) {
                alert('üîí Minions d√©bloqu√©s apr√®s 3 prestiges!');
                return;
            }
            document.getElementById('minionsModal').style.display = 'block';
            renderMinions();
        }

        function closeMinions() {
            document.getElementById('minionsModal').style.display = 'none';
        }

        function renderMinions() {
            const container = document.getElementById('minionsList');
            let html = '';

            const minionLevels = {
                autoClicker: gameState.autoClickerLevel,
                cookieBaker: gameState.cookieBakerLevel,
                luckyFinder: gameState.luckyFinderLevel,
                generatorBooster: gameState.generatorBoosterLevel,
                timeBender: gameState.timeBenderLevel
            };

            Object.entries(minionDefinitions).forEach(([id, minion]) => {
                const level = minionLevels[id];
                const cost = getMinionCost(id);
                const canAfford = gameState.cookies >= cost;

                html += `
                    <div class="upgrade-item ${!canAfford ? 'locked' : ''}" data-minion-id="${id}" style="margin-bottom: 15px; cursor: pointer;">
                        <div class="item-header">
                            <div class="item-name">${minion.icon} ${minion.name}</div>
                            <div class="item-count">Lvl ${level}</div>
                        </div>
                        <div class="item-description">${minion.description}</div>
                        <div class="item-footer">
                            <span class="item-cost">üç™ ${formatNumber(cost)}</span>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;

            // Add click listeners
            container.querySelectorAll('[data-minion-id]').forEach(item => {
                item.addEventListener('click', () => {
                    buyMinion(item.dataset.minionId);
                    renderMinions();
                });
            });
        }

        // ==================== INIT ====================
        // Add event listeners
        document.getElementById('clickButton').addEventListener('click', handleClick);
        document.getElementById('resetButton').addEventListener('click', resetGame);
        document.getElementById('prestigeButton').addEventListener('click', doPrestige);
        document.getElementById('prestigeShopButton').addEventListener('click', openPrestigeShop);
        document.getElementById('closePrestigeShop').addEventListener('click', closePrestigeShop);
        document.getElementById('ascensionButton').addEventListener('click', doAscension);
        document.getElementById('ascensionShopButton').addEventListener('click', openAscensionShop);
        document.getElementById('closeAscensionShop').addEventListener('click', closeAscensionShop);
        document.getElementById('feedDragonBtn').addEventListener('click', feedDragon);
        document.getElementById('buyAutoClickerBtn').addEventListener('click', buyAutoClicker);
        document.getElementById('pantheonButton').addEventListener('click', openPantheon);
        document.getElementById('closePantheon').addEventListener('click', closePantheon);
        document.getElementById('gardenButton').addEventListener('click', openGarden);
        document.getElementById('closeGarden').addEventListener('click', closeGarden);
        document.getElementById('stockMarketButton').addEventListener('click', openStockMarket);
        document.getElementById('closeStockMarket').addEventListener('click', closeStockMarket);
        document.getElementById('minionsButton').addEventListener('click', openMinions);
        document.getElementById('closeMinions').addEventListener('click', closeMinions);
        document.getElementById('collectOfflineEarnings').addEventListener('click', collectOfflineEarnings);

        loadGame();
        updateProduction();
        updateUI();

        console.log('%cüç™ Cookie Clicker Pro loaded!', 'color: #ffd700; font-size: 20px; font-weight: bold;');
        console.log('%c VERSION 1.1 - Grand-m√®re=3/sec, Ferme=12/sec', 'color: #4ade80; font-weight: bold;');
        console.log('D√©finitions g√©n√©rateurs:');
        console.log('- Curseur:', generatorDefinitions.cursor.baseProduction, '/sec');
        console.log('- Grand-m√®re:', generatorDefinitions.grandma.baseProduction, '/sec');
        console.log('- Ferme:', generatorDefinitions.farm.baseProduction, '/sec');
        console.log('√âtat initial:');
        console.log('- Cookies:', gameState.cookies);
        console.log('- G√©n√©rateurs:', gameState.generators);
        console.log('- Production/sec:', gameState.cookiesPerSecond);

        // Game loop - 10 times per second for smooth production
        setInterval(gameLoop, 100);

        // Auto-save every 5 seconds
        setInterval(saveGame, 5000);
    </script>
</body>
</html>
